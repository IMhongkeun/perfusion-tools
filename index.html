<!doctype html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
  
  <!-- SEO & Meta -->
  <title>Perfusion Calculator — DO₂i & Predicted Hct | Perfusion Tools</title>
  <meta name="description" content="Professional perfusion calculators for CPB. Calculate DO₂i (Oxygen Delivery Index) and Predicted Hematocrit with hemodilution logic. Essential tools for perfusionists and ECMO specialists." />
  <meta name="keywords" content="perfusion calculator, DO2i calculator, predicted Hct, CPB hemodilution, ECMO calculator, cardiac surgery tools, perfusionist, BSA calculator" />
  <meta name="theme-color" content="#0f172a" />
  
  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Perfusion Calculator — DO₂i & Predicted Hct" />
  <meta property="og:description" content="Clinical tools for calculating Oxygen Delivery Index and Predicted Hematocrit on Bypass. Features Dark Mode and mobile-friendly design." />
  <meta property="og:url" content="https://perfusion.pro/" />
  <meta property="og:image" content="https://perfusion.pro/og-image.png" /> <!-- Placeholder for future use -->

  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            // Deep Navy Theme
            primary: {
              50: '#f0f4f8',
              100: '#d9e2ec',
              200: '#bcccdc',
              300: '#9fb3c8',
              400: '#829ab1',
              500: '#627d98',
              600: '#486581',
              700: '#334e68',
              800: '#243b53',
              900: '#0f172a', // Main Deep Navy
              950: '#020617',
            },
            // Aqua / Teal Accent
            accent: {
              400: '#22d3ee', // Cyan-400
              500: '#06b6d4', // Cyan-500
              600: '#0891b2',
            }
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
          },
          boxShadow: {
            card: '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
            glow: '0 0 15px rgba(34, 211, 238, 0.3)',
          }
        }
      }
    };
  </script>
  
  <style>
    /* Custom Base Styles */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    
    :root {
      --header-height: 60px;
      --bottom-nav-height: 64px;
    }

    body {
      font-family: 'Inter', sans-serif;
      -webkit-tap-highlight-color: transparent;
    }

    /* Hide number input arrows */
    input[type=number] { appearance: textfield; }
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

    /* Range Slider Styling */
    input[type=range] {
      -webkit-appearance: none; 
      background: transparent;
    }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
    }

    /* Custom Scrollbar for desktop */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    .dark ::-webkit-scrollbar-thumb { background: #334155; }

    /* Logo Animation */
    @keyframes pulse-flow {
      0% { opacity: 0.6; transform: scale(0.95); }
      50% { opacity: 1; transform: scale(1.05); }
      100% { opacity: 0.6; transform: scale(0.95); }
    }
    .animate-pulse-flow {
      animation: pulse-flow 3s infinite ease-in-out;
    }
  </style>
</head>
<body class="bg-slate-50 text-slate-900 antialiased transition-colors duration-200 dark:bg-primary-950 dark:text-slate-100 pb-[var(--bottom-nav-height)] md:pb-0">

  <!-- App Shell -->
  <header class="fixed top-0 w-full z-40 bg-primary-900/95 backdrop-blur border-b border-primary-800 text-white shadow-md">
    <div class="max-w-7xl mx-auto px-4 h-[var(--header-height)] flex items-center justify-between">
      
      <!-- Branding / Logo -->
      <div class="flex items-center gap-3 select-none">
        <!-- Pure CSS Logo: Perfusion Circuit/Heart Motif -->
        <div class="relative w-8 h-8 flex items-center justify-center">
          <!-- Outer circuit ring -->
          <div class="absolute inset-0 rounded-full border-2 border-accent-500 opacity-80"></div>
          <!-- Inner flow path -->
          <div class="w-4 h-4 rounded-full bg-gradient-to-br from-accent-400 to-blue-600 shadow-glow animate-pulse-flow"></div>
          <!-- Flow accent -->
          <div class="absolute -top-0.5 -right-0.5 w-2 h-2 bg-accent-400 rounded-full animate-ping opacity-75" style="animation-duration: 2s;"></div>
        </div>
        
        <h1 class="text-lg font-bold tracking-tight">
          Perfusion <span class="text-accent-400">Tools</span>
        </h1>
      </div>

      <!-- Desktop Nav -->
      <nav class="hidden md:flex items-center gap-1 text-sm font-medium">
        <a href="#/do2i" id="nav-do2i" class="nav-link px-4 py-2 rounded-full hover:bg-primary-800 transition-colors text-slate-300 hover:text-accent-400">DO₂i</a>
        <a href="#/predicted-hct" id="nav-hct" class="nav-link px-4 py-2 rounded-full hover:bg-primary-800 transition-colors text-slate-300 hover:text-accent-400">Predicted Hct</a>
        <a href="#/faq" id="nav-faq" class="nav-link px-4 py-2 rounded-full hover:bg-primary-800 transition-colors text-slate-300 hover:text-accent-400">FAQ</a>
      </nav>

      <!-- Theme Toggle -->
      <button id="theme-toggle" class="p-2 rounded-full hover:bg-primary-800 transition-colors text-slate-300 hover:text-accent-400 focus:outline-none focus:ring-2 focus:ring-accent-500" aria-label="Toggle Dark Mode">
        <!-- Sun Icon -->
        <svg id="icon-sun" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
        </svg>
        <!-- Moon Icon -->
        <svg id="icon-moon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 24.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
        </svg>
      </button>
    </div>
  </header>

  <div class="pt-[var(--header-height)] max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-[260px_1fr] gap-0 min-h-screen">
    
    <!-- Sidebar (Desktop Only) -->
    <aside class="hidden md:block border-r border-slate-200 dark:border-primary-800 bg-white dark:bg-primary-900/50 sticky top-[var(--header-height)] h-[calc(100vh-var(--header-height))] p-4 overflow-y-auto">
      <div class="mb-6">
        <div class="relative">
          <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
          <input placeholder="Search..." class="w-full rounded-lg border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 pl-10 px-3 py-2 text-sm focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none transition-all dark:text-white placeholder-slate-500" />
        </div>
      </div>
      
      <div class="space-y-1">
        <div class="text-xs font-semibold text-slate-400 dark:text-slate-500 uppercase tracking-wider mb-2 px-3">Calculators</div>
        <a href="#/do2i" id="side-do2i" class="sidebar-link block px-3 py-2.5 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-primary-800 hover:text-primary-900 dark:hover:text-accent-400 transition-all">
          DO₂ Index (DO₂i)
        </a>
        <a href="#/predicted-hct" id="side-hct" class="sidebar-link block px-3 py-2.5 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-primary-800 hover:text-primary-900 dark:hover:text-accent-400 transition-all">
          Predicted Hematocrit
        </a>
      </div>

      <div class="mt-8 space-y-1">
        <div class="text-xs font-semibold text-slate-400 dark:text-slate-500 uppercase tracking-wider mb-2 px-3">Info</div>
        <a href="#/faq" id="side-faq" class="sidebar-link block px-3 py-2.5 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-primary-800 transition-all">FAQ</a>
      </div>
    </aside>

    <!-- Main content -->
    <main class="p-4 md:p-8 max-w-3xl mx-auto w-full space-y-8">
      
      <!-- DO2i Calculator -->
      <section id="view-do2i" class="hidden animate-in fade-in duration-300">
        <div class="bg-white dark:bg-primary-900 rounded-2xl shadow-card dark:shadow-none border border-slate-200 dark:border-primary-800 overflow-hidden">
          <!-- Header -->
          <div class="p-6 border-b border-slate-100 dark:border-primary-800 flex flex-wrap items-center justify-between gap-4 bg-slate-50/50 dark:bg-primary-800/30">
            <div>
              <h2 class="text-xl font-bold text-primary-900 dark:text-white flex items-center gap-2">
                DO₂ Index 
                <span class="px-2 py-0.5 rounded text-xs font-bold bg-accent-500/10 text-accent-600 dark:text-accent-400">DO₂i</span>
              </h2>
              <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Oxygen Delivery Index (mL O₂/min/m²)</p>
            </div>
            
            <div class="flex items-center gap-3">
              <div class="inline-flex rounded-lg border border-slate-200 dark:border-primary-700 bg-white dark:bg-primary-800 p-1">
                <button id="mode-adult" class="px-3 py-1.5 text-xs font-medium rounded-md transition-colors">Adult</button>
                <button id="mode-infant" class="px-3 py-1.5 text-xs font-medium rounded-md transition-colors text-slate-500 dark:text-slate-400 hover:text-primary-900 dark:hover:text-white">Infant</button>
              </div>
              <button id="do2i-reset" class="p-2 text-slate-400 hover:text-primary-900 dark:hover:text-accent-400 transition-colors" title="Reset Inputs">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
              </button>
            </div>
          </div>

          <!-- Inputs -->
          <div class="p-6 grid sm:grid-cols-2 gap-6">
            <div class="space-y-1">
              <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide">Height (cm)</label>
              <input id="h_cm" type="number" step="0.1" placeholder="170" class="w-full bg-slate-50 dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none transition-all dark:text-white" />
            </div>
            <div class="space-y-1">
              <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide">Weight (kg)</label>
              <input id="w_kg" type="number" step="0.1" placeholder="70" class="w-full bg-slate-50 dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none transition-all dark:text-white" />
            </div>

            <div class="sm:col-span-2 grid grid-cols-[1fr_140px] gap-4 items-end bg-slate-50 dark:bg-primary-800/50 p-4 rounded-xl border border-slate-100 dark:border-primary-700/50">
              <div class="space-y-1">
                <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide flex justify-between">
                  BSA (m²)
                  <span id="bsa-hint" class="text-[10px] font-normal text-slate-400 lowercase">auto-calc</span>
                </label>
                <input id="bsa" type="number" step="0.01" placeholder="—" class="w-full bg-white dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 outline-none dark:text-white" />
              </div>
              <div class="space-y-1">
                <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide">Formula</label>
                <select id="bsa-method" class="w-full bg-white dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-3 py-2.5 text-sm focus:ring-2 focus:ring-accent-500 outline-none dark:text-white cursor-pointer">
                  <option value="Mosteller">Mosteller</option>
                  <option value="DuBois">DuBois</option>
                  <option value="Haycock">Haycock</option>
                  <option value="GehanGeorge">Gehan</option>
                </select>
              </div>
            </div>

            <div class="space-y-1">
              <label class="text-xs font-semibold text-primary-700 dark:text-accent-400 uppercase tracking-wide">Pump Flow (L/min)</label>
              <input id="flow" type="number" step="0.01" placeholder="4.6" class="w-full bg-slate-50 dark:bg-primary-800 border-2 border-accent-500/20 focus:border-accent-500 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 outline-none transition-all dark:text-white font-medium" />
            </div>
            <div class="space-y-1">
              <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide">Hemoglobin (g/dL)</label>
              <input id="hb" type="number" step="0.1" placeholder="10" class="w-full bg-slate-50 dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none transition-all dark:text-white" />
            </div>
            <div class="space-y-1">
              <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide">SaO₂ (%)</label>
              <input id="sao2" type="number" step="0.1" placeholder="100" class="w-full bg-slate-50 dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none transition-all dark:text-white" />
            </div>
            <div class="space-y-1">
              <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide">PaO₂ (mmHg)</label>
              <input id="pao2" type="number" step="1" placeholder="150" class="w-full bg-slate-50 dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none transition-all dark:text-white" />
            </div>
            <!-- Read only output -->
            <div class="sm:col-span-2 space-y-1 opacity-75">
              <label class="text-xs font-semibold text-slate-400 dark:text-slate-500 uppercase tracking-wide">Calculated CaO₂ (mL/dL)</label>
              <input id="cao2" disabled class="w-full bg-slate-100 dark:bg-primary-950 border-0 rounded-xl px-4 py-2.5 text-slate-600 dark:text-slate-400 font-mono text-sm" />
            </div>
          </div>

          <!-- Results Block -->
          <div class="bg-primary-900 dark:bg-black/20 p-6 text-white relative overflow-hidden">
             <div class="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-accent-500 rounded-full opacity-10 blur-3xl"></div>
             
             <div class="relative z-10 flex items-end justify-between mb-4">
               <div class="text-slate-300 text-sm font-medium">DO₂i Result</div>
               <div id="do2i" class="text-4xl font-bold tracking-tight text-white">0 <span class="text-lg font-normal text-slate-400">mL/min/m²</span></div>
             </div>

             <!-- Gauge -->
             <div class="relative h-3 bg-primary-800/50 dark:bg-white/10 rounded-full overflow-hidden backdrop-blur-sm">
               <div id="do2i-gauge" class="h-full bg-gradient-to-r from-accent-600 to-accent-400 transition-all duration-700 ease-out shadow-[0_0_10px_rgba(34,211,238,0.5)]" style="width:0%"></div>
             </div>
             
             <div class="mt-3 flex justify-between items-center">
               <div id="do2i-msg" class="text-sm font-bold text-accent-400">Waiting for input...</div>
               <div id="do2i-legend" class="text-[10px] text-slate-400">Target > 280</div>
             </div>
          </div>

          <!-- Clinical Notes / Ref -->
          <div class="bg-slate-50 dark:bg-primary-800/30 border-t border-slate-100 dark:border-primary-700/50 p-4">
            <h4 class="text-xs font-bold text-primary-900 dark:text-slate-200 uppercase tracking-wider mb-2 flex items-center gap-2">
              <svg class="w-4 h-4 text-accent-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
              Clinical Notes
            </h4>
            <div id="clinical-note-adult" class="text-xs text-slate-600 dark:text-slate-400 space-y-1">
              <p>• <strong>Target:</strong> Typically ≥ 280–300 mL O₂/min/m² during normothermic CPB.</p>
              <p>• <strong>Low DO₂i:</strong> Associated with AKI and elevated lactate. Consider increasing flow or Hct.</p>
              <p>• <strong>High DO₂i:</strong> Excess delivery usually benign but may indicate luxury perfusion.</p>
            </div>
            <div id="clinical-note-infant" class="hidden text-xs text-slate-600 dark:text-slate-400 space-y-1">
              <p>• <strong>Target:</strong> Infants typically require higher flows (≥ 2.4–3.0 L/min/m² CI) and DO₂i ≥ 350–380.</p>
              <p>• <strong>Metabolic Rate:</strong> Higher O₂ consumption necessitates higher delivery thresholds than adults.</p>
            </div>
            <p class="mt-3 text-[10px] text-slate-400 italic">For educational use only. Not medical advice.</p>
          </div>
        </div>

        <!-- Methodology Toggle -->
        <details class="mt-4 group">
          <summary class="cursor-pointer text-xs font-semibold text-slate-500 dark:text-slate-400 hover:text-accent-500 transition-colors list-none flex items-center gap-2">
            <span class="transform transition-transform group-open:rotate-90">▶</span> Methodology
          </summary>
          <div class="mt-2 p-4 rounded-xl bg-white dark:bg-primary-900 border border-slate-100 dark:border-primary-800 text-xs text-slate-600 dark:text-slate-400 leading-relaxed shadow-sm">
             <p><strong>CaO₂ (mL/dL)</strong> = 1.34 × Hb × (SaO₂/100) + 0.0031 × PaO₂</p>
             <p class="mt-1"><strong>DO₂i (mL/min/m²)</strong> = (Pump Flow ÷ BSA) × CaO₂ × 10</p>
             <p class="mt-2 text-slate-400">Constants: Hüfner factor 1.34; Dissolved O₂ coefficient 0.0031.</p>
          </div>
        </details>
      </section>

      <!-- Predicted Hct Calculator -->
      <section id="view-hct" class="hidden animate-in fade-in duration-300">
        <div class="bg-white dark:bg-primary-900 rounded-2xl shadow-card dark:shadow-none border border-slate-200 dark:border-primary-800 overflow-hidden">
          
          <div class="p-6 border-b border-slate-100 dark:border-primary-800 bg-slate-50/50 dark:bg-primary-800/30">
            <h2 class="text-xl font-bold text-primary-900 dark:text-white">Predicted Hct <span class="text-slate-400 font-normal text-base">on CPB</span></h2>
            <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Dilutional hematocrit calculator</p>
          </div>

          <div class="p-6 grid sm:grid-cols-2 gap-6">
            <div class="sm:col-span-2">
              <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide">Patient Type (EBV Coef)</label>
              <select id="pttype" class="mt-1 w-full bg-white dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 outline-none transition-all dark:text-white cursor-pointer">
                <option value="adult_m">Adult — Male (70 mL/kg)</option>
                <option value="adult_f">Adult — Female (65 mL/kg)</option>
                <option value="child">Child (75 mL/kg)</option>
                <option value="infant">Infant (80 mL/kg)</option>
                <option value="neonate">Neonate (90 mL/kg)</option>
              </select>
            </div>

            <div class="space-y-1">
              <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide">Weight (kg)</label>
              <input id="wt_hct" type="number" step="0.1" placeholder="70" class="w-full bg-slate-50 dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none transition-all dark:text-white" />
            </div>
            <div class="space-y-1">
              <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide">Pre-CPB Hct (%)</label>
              <input id="pre_hct" type="number" step="0.1" placeholder="40" class="w-full bg-slate-50 dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none transition-all dark:text-white" />
            </div>

            <div class="bg-slate-50 dark:bg-primary-800/50 p-4 rounded-xl border border-slate-100 dark:border-primary-700/50 sm:col-span-2 grid sm:grid-cols-2 gap-4">
               <div class="sm:col-span-2 text-xs font-bold text-primary-900 dark:text-accent-400 uppercase tracking-wide mb-1">Circuit Volumes</div>
               <div class="space-y-1">
                 <label class="text-xs text-slate-500 dark:text-slate-400">Prime Volume (mL)</label>
                 <input id="prime" type="number" step="1" placeholder="1200" class="w-full bg-white dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-lg px-3 py-2 focus:ring-2 focus:ring-accent-500 outline-none dark:text-white" />
               </div>
               <div class="space-y-1">
                 <label class="text-xs text-slate-500 dark:text-slate-400">Addl. Crystalloid (mL)</label>
                 <input id="fluids" type="number" step="1" value="0" class="w-full bg-white dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-lg px-3 py-2 focus:ring-2 focus:ring-accent-500 outline-none dark:text-white" />
               </div>
               <div class="space-y-1">
                 <label class="text-xs text-slate-500 dark:text-slate-400">Ultrafiltration Removed (mL)</label>
                 <input id="removed" type="number" step="1" value="0" class="w-full bg-white dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-lg px-3 py-2 focus:ring-2 focus:ring-accent-500 outline-none dark:text-white" />
               </div>
            </div>

            <div class="bg-red-50 dark:bg-red-900/10 p-4 rounded-xl border border-red-100 dark:border-red-900/20 sm:col-span-2 grid sm:grid-cols-3 gap-4">
              <div class="sm:col-span-3 text-xs font-bold text-red-800 dark:text-red-400 uppercase tracking-wide mb-1">Blood Products</div>
              <div class="space-y-1">
                 <label class="text-xs text-slate-500 dark:text-slate-400">RBC Units</label>
                 <input id="rbc_units" type="number" step="1" value="0" class="w-full bg-white dark:bg-primary-800 border border-red-200 dark:border-red-900/30 rounded-lg px-3 py-2 focus:ring-2 focus:ring-red-500 outline-none dark:text-white" />
              </div>
              <div class="space-y-1">
                 <label class="text-xs text-slate-500 dark:text-slate-400">Vol/Unit (mL)</label>
                 <input id="rbc_unit_vol" type="number" step="1" value="300" class="w-full bg-white dark:bg-primary-800 border border-red-200 dark:border-red-900/30 rounded-lg px-3 py-2 focus:ring-2 focus:ring-red-500 outline-none dark:text-white" />
              </div>
              <div class="space-y-1">
                 <label class="text-xs text-slate-500 dark:text-slate-400">Unit Hct (%)</label>
                 <input id="rbc_hct" type="number" step="1" value="60" class="w-full bg-white dark:bg-primary-800 border border-red-200 dark:border-red-900/30 rounded-lg px-3 py-2 focus:ring-2 focus:ring-red-500 outline-none dark:text-white" />
              </div>
            </div>
          </div>

          <!-- Hct Result -->
          <div class="bg-primary-900 dark:bg-black/20 p-6 text-white grid grid-cols-3 gap-4 divide-x divide-primary-800 dark:divide-white/10 text-center">
            <div>
              <div class="text-[10px] uppercase tracking-wider text-slate-400 mb-1">EBV</div>
              <div id="ebv" class="text-lg font-mono font-medium">0</div>
              <div class="text-[10px] text-slate-500">mL</div>
            </div>
            <div>
              <div class="text-[10px] uppercase tracking-wider text-slate-400 mb-1">Total Vol</div>
              <div id="total_vol" class="text-lg font-mono font-medium">0</div>
              <div class="text-[10px] text-slate-500">mL</div>
            </div>
            <div class="relative">
              <div class="text-[10px] uppercase tracking-wider text-accent-400 mb-1 font-bold">Result Hct</div>
              <div id="pred_hct" class="text-2xl font-bold text-white">0%</div>
            </div>
          </div>

           <!-- Clinical Notes -->
           <div class="bg-slate-50 dark:bg-primary-800/30 border-t border-slate-100 dark:border-primary-700/50 p-4">
            <h4 class="text-xs font-bold text-primary-900 dark:text-slate-200 uppercase tracking-wider mb-2 flex items-center gap-2">
              <svg class="w-4 h-4 text-accent-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
              Clinical Context
            </h4>
            <div class="text-xs text-slate-600 dark:text-slate-400 space-y-1">
              <p>• <strong>Target Hct:</strong> Often 21–25% on bypass. Lower Hct reduces viscosity but also oxygen carrying capacity.</p>
              <p>• <strong>Adjustments:</strong> Reducing prime volume (RAP/VAP) or adding RBCs increases Hct. Adding crystalloid decreases Hct.</p>
              <p>• <strong>Hemoconcentration:</strong> Use Ultrafiltration (UF) to remove plasma water and increase Hct.</p>
            </div>
            <p class="mt-3 text-[10px] text-slate-400 italic">For educational use only.</p>
          </div>
        </div>
      </section>

      <section id="faq" class="hidden animate-in fade-in duration-300">
        <h2 class="text-2xl font-bold text-primary-900 dark:text-white mb-6">Frequently Asked Questions</h2>
        <div class="space-y-4">
          <details class="group bg-white dark:bg-primary-900 rounded-xl shadow-sm border border-slate-200 dark:border-primary-800 p-4">
            <summary class="font-medium cursor-pointer text-primary-900 dark:text-white flex items-center justify-between">
              What DO₂i target should I use?
              <span class="text-accent-500 transform group-open:rotate-180 transition-transform">▼</span>
            </summary>
            <p class="mt-3 text-slate-600 dark:text-slate-300 text-sm leading-relaxed">Targets vary by institution and temperature. Common targets for normothermic CPB are ≥280–300 mL/min/m² to prevent anaerobic metabolism. Infants may require higher indices (350+).</p>
          </details>
           <details class="group bg-white dark:bg-primary-900 rounded-xl shadow-sm border border-slate-200 dark:border-primary-800 p-4">
            <summary class="font-medium cursor-pointer text-primary-900 dark:text-white flex items-center justify-between">
              Does this save patient data?
              <span class="text-accent-500 transform group-open:rotate-180 transition-transform">▼</span>
            </summary>
            <p class="mt-3 text-slate-600 dark:text-slate-300 text-sm leading-relaxed">No. All calculations happen instantly in your browser. No patient health information (PHI) is sent to any server.</p>
          </details>
        </div>
      </section>

      <!-- Privacy / Terms / Contact placeholders (simplified styling) -->
      <section id="view-privacy" class="hidden p-6 bg-white dark:bg-primary-900 rounded-2xl shadow-card border border-slate-200 dark:border-primary-800 text-slate-700 dark:text-slate-300">
        <h2 class="text-2xl font-bold text-primary-900 dark:text-white mb-4">Privacy Policy</h2>
        <p class="text-sm mb-4">Last updated: <span id="privacy-date"></span></p>
        <div class="prose prose-sm dark:prose-invert max-w-none">
          <p>This site collects minimal anonymized usage data. No clinical inputs are stored. [Content truncated for brevity, preserved from original]</p>
        </div>
      </section>
      
      <section id="view-terms" class="hidden p-6 bg-white dark:bg-primary-900 rounded-2xl shadow-card border border-slate-200 dark:border-primary-800 text-slate-700 dark:text-slate-300">
        <h2 class="text-2xl font-bold text-primary-900 dark:text-white mb-4">Terms of Use</h2>
        <p class="text-sm mb-4">Last updated: <span id="terms-date"></span></p>
        <div class="prose prose-sm dark:prose-invert max-w-none">
          <p>For educational use only. Not medical advice. [Content truncated for brevity, preserved from original]</p>
        </div>
      </section>

      <section id="view-contact" class="hidden animate-in fade-in duration-300">
        <div class="bg-white dark:bg-primary-900 rounded-2xl shadow-card border border-slate-200 dark:border-primary-800 p-6">
          <h2 class="text-2xl font-bold text-primary-900 dark:text-white mb-2">Contact</h2>
          <p class="text-sm text-slate-500 dark:text-slate-400 mb-6">Feedback or feature requests?</p>
          <form id="contact-form" class="grid gap-4">
             <input id="c_name" type="text" placeholder="Name" class="bg-slate-50 dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-3 dark:text-white outline-none focus:ring-2 focus:ring-accent-500">
             <input id="c_email" type="email" placeholder="Email" class="bg-slate-50 dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-3 dark:text-white outline-none focus:ring-2 focus:ring-accent-500">
             <textarea id="c_msg" rows="4" placeholder="Message" class="bg-slate-50 dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-3 dark:text-white outline-none focus:ring-2 focus:ring-accent-500"></textarea>
             <button type="submit" class="bg-primary-600 hover:bg-primary-700 text-white font-medium py-3 rounded-xl transition-colors">Send Message</button>
             <p id="c_status" class="text-center text-sm text-slate-500"></p>
             <a id="c_mailto" href="#" class="hidden"></a>
          </form>
        </div>
      </section>

    </main>
  </div>

  <!-- Footer -->
  <footer class="hidden md:block mt-10 border-t border-slate-200 dark:border-primary-800 bg-white dark:bg-primary-900/90">
    <div class="max-w-7xl mx-auto px-4 py-8 text-sm text-slate-500 dark:text-slate-400 flex flex-col md:flex-row md:items-center md:justify-between gap-3">
      <p>© <span id="year"></span> Perfusion Tools. Educational use for healthcare professionals.</p>
      <nav class="flex gap-4">
        <a href="#/privacy" class="hover:text-accent-500 transition-colors">Privacy</a>
        <a href="#/terms" class="hover:text-accent-500 transition-colors">Terms</a>
        <a href="#/contact" class="hover:text-accent-500 transition-colors">Contact</a>
      </nav>
    </div>
  </footer>

  <!-- Mobile Bottom Navigation (Fixed) -->
  <nav class="md:hidden fixed bottom-0 left-0 w-full bg-white dark:bg-primary-900 border-t border-slate-200 dark:border-primary-800 z-50 flex justify-around items-center h-[var(--bottom-nav-height)] pb-safe">
    <a href="#/do2i" id="mob-do2i" class="flex flex-col items-center justify-center w-full h-full text-slate-400 dark:text-slate-500 hover:text-accent-600 dark:hover:text-accent-400 transition-colors">
      <svg class="w-6 h-6 mb-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
      <span class="text-[10px] font-medium">DO₂i</span>
    </a>
    <a href="#/predicted-hct" id="mob-hct" class="flex flex-col items-center justify-center w-full h-full text-slate-400 dark:text-slate-500 hover:text-accent-600 dark:hover:text-accent-400 transition-colors">
      <svg class="w-6 h-6 mb-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" /></svg>
      <span class="text-[10px] font-medium">Hct</span>
    </a>
    <a href="#/faq" id="mob-faq" class="flex flex-col items-center justify-center w-full h-full text-slate-400 dark:text-slate-500 hover:text-accent-600 dark:hover:text-accent-400 transition-colors">
      <svg class="w-6 h-6 mb-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
      <span class="text-[10px] font-medium">Info</span>
    </a>
  </nav>

  <script>
  'use strict';

  // -----------------------------
  // Theme Management (Dark Mode)
  // -----------------------------
  const html = document.documentElement;
  const themeToggle = document.getElementById('theme-toggle');
  const sunIcon = document.getElementById('icon-sun');
  const moonIcon = document.getElementById('icon-moon');

  function updateThemeUI(isDark) {
    if (isDark) {
      html.classList.add('dark');
      sunIcon.classList.remove('hidden');
      moonIcon.classList.add('hidden');
      localStorage.setItem('theme', 'dark');
    } else {
      html.classList.remove('dark');
      sunIcon.classList.add('hidden');
      moonIcon.classList.remove('hidden');
      localStorage.setItem('theme', 'light');
    }
  }

  // Init theme
  const savedTheme = localStorage.getItem('theme');
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  updateThemeUI(savedTheme === 'dark' || (!savedTheme && prefersDark));

  themeToggle.addEventListener('click', () => {
    const isDark = html.classList.contains('dark');
    updateThemeUI(!isDark);
  });

  // -----------------------------
  // Utilities & Core Formulas (UNCHANGED)
  // -----------------------------
  function clamp(n, min, max) { return Math.min(Math.max(n, min), max); }
  const BSA = {
    Mosteller(h, w) { return Math.sqrt((h * w) / 3600); },
    DuBois(h, w) { return 0.007184 * Math.pow(h, 0.725) * Math.pow(w, 0.425); },
    Haycock(h, w) { return 0.024265 * Math.pow(h, 0.3964) * Math.pow(w, 0.5378); },
    GehanGeorge(h, w) { return 0.0235 * Math.pow(h, 0.42246) * Math.pow(w, 0.51456); },
  };
  function computeBSA(h, w, method) {
    if (!h || !w || h <= 0 || w <= 0) return 0;
    return BSA[method || 'Mosteller'](h, w);
  }
  function calcCaO2(hb, sao2pct, pao2) {
    const s = clamp((sao2pct || 0) / 100, 0, 1);
    return (1.34 * (hb || 0) * s) + (0.0031 * (pao2 || 0));
  }
  function calcDO2i(flowLmin, bsa, cao2) {
    if (!bsa || bsa <= 0) return 0;
    const fi = flowLmin / bsa; 
    return fi * cao2 * 10; 
  }
  function ebvCoef(pttype) {
    switch (pttype) {
      case 'adult_m': return 70; case 'adult_f': return 65; case 'child': return 75; case 'infant': return 80; case 'neonate': return 90; default: return 70;
    }
  }
  function computePredictedHct({ pttype, weight, pre, prime, fluids = 0, removed = 0, rbcUnits = 0, rbcUnitVol = 300, rbcHct = 60 }) {
    const coef = ebvCoef(pttype);
    const ebv = (weight || 0) * coef; 
    const rbcVolAdded = (rbcUnits || 0) * (rbcUnitVol || 0); 
    const rbcVolume = (ebv * ((pre || 0) / 100)) + (rbcVolAdded * ((rbcHct || 0) / 100));
    const totalVol = ebv + (prime || 0) + (fluids || 0) + rbcVolAdded - (removed || 0); 
    const hct = totalVol > 0 ? (rbcVolume / totalVol) * 100 : 0;
    return { ebv, totalVol, hct };
  }

  // -----------------------------
  // DOM Helpers
  // -----------------------------
  function el(id) { return document.getElementById(id); }
  function num(id) { const n = el(id); return n ? (parseFloat(n.value) || 0) : 0; }
  function setText(id, text) { const n = el(id); if (n) n.innerHTML = text; }

  // -----------------------------
  // DO2i Interaction
  // -----------------------------
  const do2iIds = ['h_cm','w_kg','bsa','bsa-method','flow','hb','sao2','pao2'];
  let lastChangedId = null;
  let do2iMode = 'adult'; 

  const THRESHOLDS = {
    adult: { low: 260, borderline: 300, upper: 450, max: 500, legend: 'Target: 280 - 300+' },
    infant:{ low: 340, borderline: 380, upper: 520, max: 600, legend: 'Target: 350+' }
  };

  function applyModeUI(){
    const isAdult = do2iMode === 'adult';
    el('mode-adult').className = 'px-3 py-1.5 text-xs font-medium rounded-md transition-colors ' + (isAdult ? 'bg-white dark:bg-primary-700 shadow-sm text-primary-900 dark:text-white' : 'text-slate-500 dark:text-slate-400 hover:text-primary-900');
    el('mode-infant').className = 'px-3 py-1.5 text-xs font-medium rounded-md transition-colors ' + (!isAdult ? 'bg-white dark:bg-primary-700 shadow-sm text-primary-900 dark:text-white' : 'text-slate-500 dark:text-slate-400 hover:text-primary-900');
    
    setText('do2i-legend', THRESHOLDS[do2iMode].legend);
    
    // Toggle clinical notes visibility
    el('clinical-note-adult').classList.toggle('hidden', !isAdult);
    el('clinical-note-infant').classList.toggle('hidden', isAdult);
  }

  function updateBSA() {
    if (lastChangedId === 'bsa') return; 
    const h = num('h_cm'), w = num('w_kg');
    const method = el('bsa-method').value;
    const v = computeBSA(h, w, method);
    const out = v ? v.toFixed(2) : '';
    el('bsa').value = out;
    setText('bsa-hint', out ? 'calculated' : 'auto-calc');
  }
  function updateDO2i() {
    updateBSA();
    const bsa = num('bsa');
    const flow = num('flow');
    const hb = num('hb');
    const sao2 = num('sao2');
    const pao2 = parseFloat(el('pao2').value) || 0; 
    const cao2 = calcCaO2(hb, sao2, pao2);
    el('cao2').value = cao2 ? cao2.toFixed(2) : '';

    const do2i = calcDO2i(flow, bsa, cao2);
    setText('do2i', do2i ? `${Math.round(do2i)} <span class="text-lg font-normal text-slate-400">mL/min/m²</span>` : '0 <span class="text-lg font-normal text-slate-400">mL/min/m²</span>');

    const t = THRESHOLDS[do2iMode];
    let gaugePct = 0, msg = 'Waiting...', gaugeColor = 'from-accent-600 to-accent-400';
    
    if (do2i) {
      gaugePct = Math.min(Math.max((do2i / t.max) * 100, 0), 100);
      if (do2i < t.low) { msg = 'Low Delivery'; gaugeColor = 'from-red-600 to-red-400'; }
      else if (do2i < t.borderline) { msg = 'Borderline'; gaugeColor = 'from-amber-500 to-amber-300'; }
      else if (do2i <= t.upper) { msg = 'Target Range'; gaugeColor = 'from-emerald-500 to-emerald-300'; }
      else { msg = 'High Delivery'; gaugeColor = 'from-sky-500 to-sky-300'; }
    }
    
    const g = el('do2i-gauge');
    g.style.width = `${gaugePct}%`;
    g.className = `h-full bg-gradient-to-r transition-all duration-700 ease-out shadow-[0_0_10px_rgba(255,255,255,0.3)] ${gaugeColor}`;
    setText('do2i-msg', msg);
    
    // Color text match
    const msgEl = el('do2i-msg');
    if (do2i < t.low) msgEl.className = 'text-sm font-bold text-red-400';
    else if (do2i < t.borderline) msgEl.className = 'text-sm font-bold text-amber-400';
    else if (do2i <= t.upper) msgEl.className = 'text-sm font-bold text-emerald-400';
    else msgEl.className = 'text-sm font-bold text-sky-400';
  }

  function resetDO2i() {
    ['h_cm','w_kg','bsa','flow','hb','sao2','pao2'].forEach(id => { const n = el(id); if (n) n.value = ''; });
    el('cao2').value = '';
    setText('do2i','0 <span class="text-lg font-normal text-slate-400">mL/min/m²</span>');
    el('do2i-gauge').style.width = '0%';
    setText('do2i-msg','Waiting for input...');
    do2iMode = 'adult';
    applyModeUI();
  }

  // -----------------------------
  // Predicted Hct Interaction
  // -----------------------------
  function updateHct() {
    const pttype = el('pttype').value;
    const payload = {
      pttype,
      weight: num('wt_hct'),
      pre: num('pre_hct'),
      prime: num('prime'),
      fluids: num('fluids'),
      removed: num('removed'),
      rbcUnits: num('rbc_units'),
      rbcUnitVol: num('rbc_unit_vol'),
      rbcHct: num('rbc_hct'),
    };
    const r = computePredictedHct(payload);
    setText('ebv', r.ebv ? r.ebv.toFixed(0) : '0');
    setText('total_vol', r.totalVol ? r.totalVol.toFixed(0) : '0');
    setText('pred_hct', r.hct ? r.hct.toFixed(1) + '%' : '0%');
  }

  // -----------------------------
  // Router & Navigation Styling
  // -----------------------------
  function route() {
    const hash = location.hash || '#/do2i';
    
    // View Toggle
    const sections = ['view-do2i', 'view-hct', 'faq', 'view-privacy', 'view-terms', 'view-contact'];
    sections.forEach(sid => {
      el(sid).classList.add('hidden');
    });

    if (hash.includes('do2i')) el('view-do2i').classList.remove('hidden');
    else if (hash.includes('predicted-hct')) el('view-hct').classList.remove('hidden');
    else if (hash.includes('faq')) el('faq').classList.remove('hidden');
    else if (hash.includes('privacy')) el('view-privacy').classList.remove('hidden');
    else if (hash.includes('terms')) el('view-terms').classList.remove('hidden');
    else if (hash.includes('contact')) el('view-contact').classList.remove('hidden');
    else el('view-do2i').classList.remove('hidden'); // Default

    // Nav State (Desktop & Mobile)
    const navMap = {
      'do2i': ['nav-do2i', 'side-do2i', 'mob-do2i'],
      'predicted-hct': ['nav-hct', 'side-hct', 'mob-hct'],
      'faq': ['nav-faq', 'side-faq', 'mob-faq']
    };
    
    // Reset all
    document.querySelectorAll('.nav-link, .sidebar-link').forEach(l => {
      l.classList.remove('bg-primary-800', 'text-accent-400', 'bg-slate-100', 'text-primary-900', 'bg-primary-700');
    });
    document.querySelectorAll('[id^="mob-"]').forEach(l => {
      l.classList.remove('text-accent-600', 'dark:text-accent-400');
      l.classList.add('text-slate-400', 'dark:text-slate-500');
    });

    // Activate current
    let key = null;
    if (hash.includes('do2i')) key = 'do2i';
    else if (hash.includes('predicted-hct')) key = 'predicted-hct';
    else if (hash.includes('faq')) key = 'faq';

    if (key && navMap[key]) {
      // Desktop Header
      const navEl = el(navMap[key][0]);
      if(navEl) navEl.classList.add('bg-primary-800', 'text-accent-400');
      
      // Desktop Sidebar
      const sideEl = el(navMap[key][1]);
      if(sideEl) sideEl.classList.add('bg-slate-100', 'text-primary-900', 'dark:bg-primary-800', 'dark:text-accent-400');
      
      // Mobile Bottom Bar
      const mobEl = el(navMap[key][2]);
      if(mobEl) {
        mobEl.classList.remove('text-slate-400', 'dark:text-slate-500');
        mobEl.classList.add('text-accent-600', 'dark:text-accent-400');
      }
    }
  }

  // -----------------------------
  // Event Wiring
  // -----------------------------
  window.addEventListener('hashchange', route);
  window.addEventListener('DOMContentLoaded', () => {
    const now = new Date();
    document.getElementById('year').textContent = now.getFullYear();
    const iso = now.toISOString().slice(0,10);
    const pdate = document.getElementById('privacy-date'); if (pdate) pdate.textContent = iso;
    const tdate = document.getElementById('terms-date'); if (tdate) tdate.textContent = iso;

    route();

    do2iIds.forEach(id => { 
      const x = el(id); 
      if (x) {
        x.addEventListener('input', () => { lastChangedId = id; updateDO2i(); });
        if (id === 'bsa-method') x.addEventListener('change', () => { lastChangedId = id; updateDO2i(); });
      }
    });

    el('mode-adult').addEventListener('click', () => { do2iMode = 'adult'; applyModeUI(); updateDO2i(); });
    el('mode-infant').addEventListener('click', () => { do2iMode = 'infant'; applyModeUI(); updateDO2i(); });
    el('do2i-reset').addEventListener('click', () => { lastChangedId = null; resetDO2i(); });

    ['pttype','wt_hct','pre_hct','prime','fluids','removed','rbc_units','rbc_unit_vol','rbc_hct'].forEach(id => {
      const x = el(id); if (x) x.addEventListener('input', updateHct);
    });

    // Simple form handler
    const cform = document.getElementById('contact-form');
    if (cform) {
      cform.addEventListener('submit', (e) => {
        e.preventDefault();
        const name = el('c_name').value;
        const status = el('c_status');
        status.textContent = `Thanks ${name || 'user'}, opening mail client...`;
        // Mock send
        setTimeout(() => status.textContent = '', 3000);
      });
    }

    applyModeUI();
    updateDO2i();
    updateHct();
  });
  </script>
</body>
</html>
