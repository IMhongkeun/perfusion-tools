<!doctype html>
<html lang="en" class="scroll-smooth">
<head>
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
      c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)}
      t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
      y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "v9kiiq48nz");
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Perfusion Tools – CPB & ECMO Perfusion Calculators</title>
  <meta name="description" content="Comprehensive perfusion calculators for CPB & ECMO including BSA, Heparin dosing, and more." />
  <meta name="keywords" content="perfusion calculator, GDP calculator, DO2i calculator, predicted Hct, CPB hemodilution, ECMO calculator, cardiac surgery tools, perfusionist, BSA calculator" />
  <meta name="theme-color" content="#0f172a" />

  <link rel="canonical" href="https://perfusiontools.com/" />

  <meta property="og:type" content="website" />
  <meta property="og:title" content="Goal-Directed Perfusion — DO₂ Index (DO₂i) Calculator" />
  <meta property="og:description" content="Calculate indexed oxygen delivery (DO₂i) for adult and pediatric CPB using normothermic GDP targets." />
  <meta property="og:url" content="https://perfusion.pro/" />
  <meta property="og:image" content="https://perfusion.pro/og-image.png" />
  <meta name="twitter:title" content="Goal-Directed Perfusion — DO₂ Index (DO₂i) Calculator" />
  <meta name="twitter:description" content="Calculate indexed oxygen delivery (DO₂i) for adult and pediatric CPB using normothermic GDP targets." />

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2705461910278176" crossorigin="anonymous"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            // Deep Navy Theme
            primary: {
              50: '#f0f4f8',
              100: '#d9e2ec',
              200: '#bcccdc',
              300: '#9fb3c8',
              400: '#829ab1',
              500: '#627d98',
              600: '#486581',
              700: '#334e68',
              800: '#243b53',
              900: '#0f172a', // Main Deep Navy
              950: '#020617',
            },
            // Aqua / Teal Accent
            accent: {
              400: '#22d3ee', // Cyan-400
              500: '#06b6d4', // Cyan-500
              600: '#0891b2',
            }
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
          },
          boxShadow: {
            card: '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
            glow: '0 0 15px rgba(34, 211, 238, 0.3)',
          }
        }
      }
    };
  </script>
  
  <style>
    /* Custom Base Styles */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    :root {
      --header-height: 60px;
      --bottom-nav-height: 64px;
    }

    body {
      font-family: 'Inter', sans-serif;
      -webkit-tap-highlight-color: transparent;
    }

    /* Hide number input arrows */
    input[type=number] { appearance: textfield; }
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

    /* Range Slider Styling */
    input[type=range] {
      -webkit-appearance: none;
      background: transparent;
    }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
    }

    /* Custom Scrollbar for desktop */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    .dark ::-webkit-scrollbar-thumb { background: #334155; }

    /* Logo Animation */
    @keyframes pulse-flow {
      0% { opacity: 0.6; transform: scale(0.95); }
      50% { opacity: 1; transform: scale(1.05); }
      100% { opacity: 0.6; transform: scale(0.95); }
    }
    .animate-pulse-flow {
      animation: pulse-flow 3s infinite ease-in-out;
    }

    /* Accessibility: High contrast focus states for better keyboard navigation */
    summary:focus {
      outline: 2px solid #06b6d4;
      outline-offset: 2px;
    }

    /* Heparin management UI helpers */
    .hep-dose-btn {
      width: 100%;
      border: 1px solid #e2e8f0;
      background: #fff;
      color: #0f172a;
      border-radius: 0.75rem;
      padding: 0.6rem 0.75rem;
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.2s ease;
    }
    .hep-dose-btn:hover { border-color: #06b6d4; color: #0891b2; }
    .dark .hep-dose-btn { background: #0f172a; border-color: #1e293b; color: #e2e8f0; }
    .hep-dose-btn.active-dose {
      border-color: #06b6d4;
      box-shadow: 0 0 0 2px rgba(34, 211, 238, 0.25);
      color: #0891b2;
      background: rgba(6, 182, 212, 0.08);
    }
    .dark .hep-dose-btn.active-dose { background: rgba(8, 145, 178, 0.2); color: #67e8f9; border-color: #0ea5e9; }

    .stat-card {
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 0.75rem;
      padding: 1rem;
      box-shadow: 0 4px 8px -4px rgba(15, 23, 42, 0.25);
    }
    .dark .stat-card { background: #0b1220; border-color: #1e293b; box-shadow: none; }
    .stat-card.highlight { border-color: #0ea5e9; box-shadow: 0 0 0 1px rgba(14, 165, 233, 0.35); }
    .stat-label { font-size: 0.75rem; color: #475569; text-transform: uppercase; letter-spacing: 0.05em; }
    .dark .stat-label { color: #94a3b8; }
    .stat-value { font-size: 1.5rem; font-weight: 700; color: #0f172a; }
    .dark .stat-value { color: #e2e8f0; }
    .stat-unit { font-size: 0.9rem; color: #94a3b8; }

    .badge {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: rgba(234, 179, 8, 0.15);
      color: #ca8a04;
      font-size: 0.7rem;
      padding: 0.15rem 0.5rem;
      border-radius: 9999px;
    }

    .protocol-card, .flow-card {
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 0.9rem;
      padding: 1.25rem;
      box-shadow: 0 4px 10px -6px rgba(15, 23, 42, 0.2);
    }
    .dark .protocol-card, .dark .flow-card { background: #0b1220; border-color: #1e293b; box-shadow: none; }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      border-radius: 9999px;
      padding: 0.25rem 0.6rem;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .pill-warn { background: rgba(234, 179, 8, 0.15); color: #a16207; }
    .pill-alert { background: rgba(248, 113, 113, 0.15); color: #b91c1c; }

    .info-block {
      border-radius: 0.9rem;
      padding: 1rem 1.1rem;
      border: 1px solid transparent;
    }
    .info-block.warn { background: rgba(239, 68, 68, 0.08); border-color: rgba(239, 68, 68, 0.35); }
    .info-block.alert { background: rgba(249, 115, 22, 0.1); border-color: rgba(249, 115, 22, 0.35); }
  </style>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "What is DO₂i (Oxygen Delivery Index) and what target range is used during CPB?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "DO₂i (Oxygen Delivery Index) measures how much oxygen the heart delivers to body tissues per minute per square meter of body surface area, expressed in ml O₂/min/m². During normothermic cardiopulmonary bypass, target DO₂i is typically ≥280–300 ml/min/m² to prevent tissue hypoxia and anaerobic metabolism. Infants and neonates often require higher targets (≥350–380 ml/min/m²) due to elevated metabolic rates."
        }
      },
      {
        "@type": "Question",
        "name": "Does this perfusion calculator store or send patient data?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "No. This is a static HTML-based calculator that runs entirely within your browser—all calculations are performed locally. No patient health information (PHI), clinical inputs, or personal data are saved to a database, sent to external servers, or transmitted over the internet. Your privacy and data security are completely protected."
        }
      },
      {
        "@type": "Question",
        "name": "Is this a medical device or replacement for clinical judgment?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "This perfusion calculator is an educational tool for healthcare professionals and is not a medical device. It does not replace clinical judgment, institutional protocols, or direct patient monitoring. Results are for reference only. Always verify calculations manually and follow your facility's perfusion management guidelines and physician orders when managing oxygen delivery during cardiopulmonary bypass."
        }
      }
    ]
  }
  </script>

  <!-- Google Analytics 4 -->
  <!-- TODO: Replace G-WZYBQ2VC7E with the real measurement ID -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-WZYBQ2VC7E"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-WZYBQ2VC7E');
  </script>

  <script>
    const routeMeta = {
      "/": {
        title: "Perfusion Tools – CPB & ECMO Perfusion Calculators",
        h1: "Perfusion Tools – CPB & ECMO Perfusion Calculators",
        description: "Comprehensive perfusion calculators for CPB & ECMO including BSA, Heparin dosing, and more.",
        headingDescription: "Evidence-based calculators for BSA, cardiac index, heparin dosing, and timekeeping to support goal-directed perfusion.",
        canonicalPath: "/"
      },
      "/home": {
        title: "Perfusion Tools – CPB & ECMO Perfusion Calculators",
        h1: "Perfusion Tools – CPB & ECMO Perfusion Calculators",
        description: "Comprehensive perfusion calculators for CPB & ECMO including BSA, Heparin dosing, and more.",
        headingDescription: "Evidence-based calculators for BSA, cardiac index, heparin dosing, and timekeeping to support goal-directed perfusion.",
        canonicalPath: "/"
      },
      "/bsa": {
        title: "BSA Calculator – Perfusion Tools",
        h1: "BSA Calculator",
        description: "Accurate Body Surface Area (BSA) calculator for perfusionists, supporting multiple formula methods.",
        headingDescription: "Calculate body surface area with Mosteller, DuBois, Haycock, and Boyd options.",
        canonicalPath: "/bsa"
      },
      "/heparin": {
        title: "Heparin Dosing Calculator – Perfusion Tools",
        h1: "Heparin Dosing Calculator",
        description: "Weight-based and resistance-adjusted heparin dosing calculator for CPB operations.",
        headingDescription: "Estimate bolus doses with adjustable resistance and clinical guidance.",
        canonicalPath: "/heparin"
      },
      "/do2i": {
        title: "Goal-Directed Perfusion — DO₂ Index (DO₂i) Calculator",
        h1: "Goal-Directed Perfusion (GDP) Calculator",
        description: "Calculate indexed oxygen delivery (DO₂i) for adult and pediatric CPB with normothermic GDP targets.",
        headingDescription: "Set a DO₂i target and evaluate whether current pump flow is adequate.",
        canonicalPath: "/do2i"
      },
      "/gdp": {
        title: "Oxygen Delivery (DO₂) Calculator – Perfusion Tools",
        h1: "Goal-Directed Perfusion (GDP) Calculator",
        description: "Calculate indexed oxygen delivery (DO₂i) for adult and pediatric CPB with normothermic GDP targets.",
        headingDescription: "Set a DO₂i target and evaluate whether current pump flow is adequate.",
        canonicalPath: "/gdp"
      },
      "/predicted-hct": {
        title: "Predicted Hematocrit on CPB — Hemodilution Calculator",
        h1: "Predicted Hematocrit Calculator",
        description: "Estimate on-pump hematocrit from EBV, prime, ultrafiltration and RBC units.",
        headingDescription: "Forecast CPB hematocrit based on EBV, prime, and transfusion inputs.",
        canonicalPath: "/predicted-hct"
      },
      "/priming-volume": {
        title: "Priming Volume Calculator (Tube ID) – Perfusion Tools",
        h1: "Priming Volume Calculator (Tube ID)",
        description: "Calculate tubing priming volume using standard perfusion tubing IDs and length conversions.",
        headingDescription: "Select a tubing ID and length to compute priming volume with unit conversions.",
        canonicalPath: "/priming-volume"
      },
      "/lbm": {
        title: "Lean Body Mass Calculator for Perfusion (Boer & Hume)",
        h1: "Lean Body Mass Calculator",
        description: "Calculate LBM and Lean BSA for CPB flow management and compare actual vs lean flow rates for obese patients.",
        headingDescription: "Compute lean mass and lean BSA to guide indexed perfusion flows.",
        canonicalPath: "/lbm"
      },
      "/timecalc": {
        title: "Time Calculator — Pump Time & Case Time",
        h1: "Time Calculator",
        description: "Quickly calculate case durations with HH:MM inputs and automatic time formatting.",
        headingDescription: "Track pump and case times with automatic formatting helpers.",
        canonicalPath: "/timecalc"
      },
      "/quick-reference": {
        title: "Quick Reference — Perfusion Tools",
        h1: "Quick Reference",
        description: "Fast intraoperative lookup references for ACP, RCP, and TCA safety time.",
        headingDescription: "Fast intraoperative lookup (reference only)",
        canonicalPath: "/quick-reference"
      },
      "/faq": {
        title: "Perfusionist Calculators — FAQ & Educational Notes",
        h1: "Frequently Asked Questions",
        description: "Common questions about DO₂i, predicted hematocrit, GDP and lean body mass during CPB.",
        headingDescription: "Read common questions and clarifications about perfusion calculators.",
        canonicalPath: "/faq"
      },
      "/info": {
        title: "About Us – Perfusion Tools",
        h1: "About Us",
        description: "About Perfusion Tools, a collection of perfusion calculators for ECMO and CPB clinicians.",
        headingDescription: "Learn about the mission behind Perfusion Tools and how to reach us.",
        canonicalPath: "/info"
      },
      "/privacy": {
        title: "Privacy Policy — Perfusion Tools",
        h1: "Privacy Policy",
        description: "Learn how Perfusion Tools handles browser-based calculations without storing personal data.",
        headingDescription: "Understand how your inputs stay on-device and private.",
        canonicalPath: "/privacy"
      },
      "/terms": {
        title: "Terms of Service — Perfusion Tools",
        h1: "Terms of Service",
        description: "Understand the usage terms and disclaimers for the Perfusion Tools calculators.",
        headingDescription: "Review the educational-use terms for these calculators.",
        canonicalPath: "/terms"
      },
      "/contact": {
        title: "Contact — Perfusion Tools",
        h1: "Contact",
        description: "Get in touch with Perfusion Tools with questions or feedback about CPB calculators.",
        headingDescription: "Reach out with questions or feedback about Perfusion Tools.",
        canonicalPath: "/contact"
      }
    };

    function normalizeRoute(rawRoute) {
      if (!rawRoute) return '/';
      const cleaned = rawRoute.replace('#', '').trim();
      if (!cleaned || cleaned === '/' || cleaned === '/home') return '/';
      return cleaned.startsWith('/') ? cleaned : `/${cleaned}`;
    }

    function applyRouteMeta(rawRoute) {
      const path = normalizeRoute(rawRoute || window.location.pathname || window.location.hash);
      const fallback = {
        title: 'Calculator – Perfusion Tools',
        description: routeMeta['/']?.description || 'Perfusion calculators for CPB and ECMO.',
        h1: routeMeta['/']?.h1 || 'Perfusion Tools'
      };

      const meta = routeMeta[path] || routeMeta['/'] || fallback;

      document.title = meta.title || fallback.title;

      let descTag = document.querySelector('meta[name="description"]');
      if (!descTag) {
        descTag = document.createElement('meta');
        descTag.setAttribute('name', 'description');
        document.head.appendChild(descTag);
      }
      descTag.setAttribute('content', meta.description || fallback.description);

      const headingEl = document.getElementById('page-heading');
      if (headingEl) headingEl.textContent = meta.h1 || meta.title || fallback.h1;

      const subtitleEl = document.getElementById('page-subtitle');
      if (subtitleEl) subtitleEl.textContent = meta.headingDescription || meta.description || '';

      return path;
    }

    window.routeMeta = routeMeta;
    window.normalizeRoute = normalizeRoute;
    window.applyRouteMeta = applyRouteMeta;

    window.addEventListener('popstate', () => applyRouteMeta());
    window.addEventListener('load', () => applyRouteMeta());
  </script>
</head>
<body class="bg-slate-50 text-slate-900 antialiased transition-colors duration-200 dark:bg-primary-950 dark:text-slate-100 pb-[var(--bottom-nav-height)] md:pb-0">

  <header class="fixed top-0 w-full z-40 bg-primary-900/95 backdrop-blur border-b border-primary-800 text-white shadow-md">
    <div class="max-w-7xl mx-auto px-4 h-[var(--header-height)] flex items-center justify-between">
      
     <a href="/" data-route id="brand-home" class="flex items-center gap-3 select-none cursor-pointer hover:opacity-80 transition-opacity">
  <div class="relative w-8 h-8 flex items-center justify-center">
    <div class="absolute inset-0 rounded-full border-2 border-accent-500 opacity-80"></div>
   
    <div class="w-4 h-4 rounded-full bg-gradient-to-br from-accent-400 to-blue-600 shadow-glow animate-pulse-flow"></div>
    <div class="absolute -top-0.5 -right-0.5 w-2 h-2 bg-accent-400 rounded-full animate-ping opacity-75" style="animation-duration: 2s;"></div>
  </div>
  
  <div class="text-lg font-bold tracking-tight">
    Perfusion <span class="text-accent-400">Tools</span>
  </div>
</a>

      <nav class="hidden md:flex items-center gap-1 text-sm font-medium">
        <a href="/" data-route id="nav-home" class="nav-link px-4 py-2 rounded-full hover:bg-primary-800 transition-colors text-slate-300 hover:text-accent-400">Home</a>
        <a href="/bsa" data-route id="nav-bsa" class="nav-link px-4 py-2 rounded-full hover:bg-primary-800 transition-colors text-slate-300 hover:text-accent-400">BSA</a>
        <a href="/gdp" data-route id="nav-do2i" class="nav-link px-4 py-2 rounded-full hover:bg-primary-800 transition-colors text-slate-300 hover:text-accent-400">GDP</a>
        <a href="/heparin" data-route id="nav-heparin" class="nav-link px-4 py-2 rounded-full hover:bg-primary-800 transition-colors text-slate-300 hover:text-accent-400">Heparin</a>
        <a href="/predicted-hct" data-route id="nav-hct" class="nav-link px-4 py-2 rounded-full hover:bg-primary-800 transition-colors text-slate-300 hover:text-accent-400">Predicted Hct</a>
        <a href="/lbm" data-route id="nav-lbm" class="nav-link px-4 py-2 rounded-full hover:bg-primary-800 transition-colors text-slate-300 hover:text-accent-400">LBM</a>
        <a href="/priming-volume" data-route id="nav-priming" class="nav-link px-4 py-2 rounded-full hover:bg-primary-800 transition-colors text-slate-300 hover:text-accent-400">Priming Volume</a>
        <a href="/timecalc" data-route id="nav-time" class="nav-link px-4 py-2 rounded-full hover:bg-primary-800 transition-colors text-slate-300 hover:text-accent-400">Time</a>
        <a href="/quick-reference" data-route id="nav-quick-reference" class="nav-link px-4 py-2 rounded-full hover:bg-primary-800 transition-colors text-slate-300 hover:text-accent-400">Quick Reference</a>
        <a href="/info" data-route id="nav-info" class="nav-link px-4 py-2 rounded-full hover:bg-primary-800 transition-colors text-slate-300 hover:text-accent-400">Info</a>
        <a href="/faq" data-route id="nav-faq" class="nav-link px-4 py-2 rounded-full hover:bg-primary-800 transition-colors text-slate-300 hover:text-accent-400">FAQ</a>
      </nav>

      <button id="theme-toggle" class="p-2 rounded-full hover:bg-primary-800 transition-colors text-slate-300 hover:text-accent-400 focus:outline-none focus:ring-2 focus:ring-accent-500" aria-label="Toggle Dark Mode">
        <svg id="icon-sun" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
        </svg>
        <svg id="icon-moon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" />
        </svg>
      </button>
    </div>
  </header>

  <div class="pt-[var(--header-height)] max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-[260px_1fr] gap-0 min-h-screen">
    
    <aside class="hidden md:block border-r border-slate-200 dark:border-primary-800 bg-white dark:bg-primary-900/50 sticky top-[var(--header-height)] h-[calc(100vh-var(--header-height))] p-4 overflow-y-auto">
      <div class="space-y-1">
        <div class="text-xs font-semibold text-slate-400 dark:text-slate-500 uppercase tracking-wider mb-2 px-3">Calculators</div>
        <a href="/" data-route id="side-home" class="sidebar-link block px-3 py-2.5 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-primary-800 hover:text-primary-900 dark:hover:text-accent-400 transition-all">
          Home
        </a>
        <a href="/bsa" data-route id="side-bsa" class="sidebar-link block px-3 py-2.5 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-primary-800 hover:text-primary-900 dark:hover:text-accent-400 transition-all">
          BSA Calculator
        </a>
        <a href="/gdp" data-route id="side-do2i" class="sidebar-link block px-3 py-2.5 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-primary-800 hover:text-primary-900 dark:hover:text-accent-400 transition-all">
          GDP Calculator
        </a>
        <a href="/heparin" data-route id="side-heparin" class="sidebar-link block px-3 py-2.5 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-primary-800 hover:text-primary-900 dark:hover:text-accent-400 transition-all">
          Heparin Management
        </a>
        <a href="/predicted-hct" data-route id="side-hct" class="sidebar-link block px-3 py-2.5 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-primary-800 hover:text-primary-900 dark:hover:text-accent-400 transition-all">
          Predicted Hematocrit
        </a>
        <a href="/lbm" data-route id="side-lbm" class="sidebar-link block px-3 py-2.5 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-primary-800 hover:text-primary-900 dark:hover:text-accent-400 transition-all">
          Lean Body Mass
        </a>
        <a href="/priming-volume" data-route id="side-priming" class="sidebar-link block px-3 py-2.5 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-primary-800 hover:text-primary-900 dark:hover:text-accent-400 transition-all">
          Priming Volume
        </a>
        <a href="/timecalc" data-route id="side-time" class="sidebar-link block px-3 py-2.5 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-primary-800 hover:text-primary-900 dark:hover:text-accent-400 transition-all">
          Time Calculator
        </a>
        <a href="/quick-reference" data-route id="side-quick-reference" class="sidebar-link block px-3 py-2.5 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-primary-800 hover:text-primary-900 dark:hover:text-accent-400 transition-all">
          Quick Reference
        </a>
      </div>

      <div class="mt-8 space-y-1">
        <div class="text-xs font-semibold text-slate-400 dark:text-slate-500 uppercase tracking-wider mb-2 px-3">Info</div>
        <a href="/info" data-route id="side-info" class="sidebar-link block px-3 py-2.5 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-primary-800 transition-all">About</a>
        <a href="/faq" data-route id="side-faq" class="sidebar-link block px-3 py-2.5 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-primary-800 transition-all">FAQ</a>
      </div>
    </aside>

    <main class="p-4 md:p-8 max-w-3xl mx-auto w-full space-y-8">

      <section class="bg-white dark:bg-primary-900 rounded-2xl shadow-card dark:shadow-none border border-slate-200 dark:border-primary-800 overflow-hidden">
        <div class="p-6 space-y-3">
          <h1 id="page-heading" class="text-2xl font-bold text-primary-900 dark:text-white">Perfusion Tools – CPB &amp; ECMO Perfusion Calculators</h1>
          <p id="page-subtitle" class="text-sm text-slate-600 dark:text-slate-300">Evidence-based calculators for BSA, cardiac index (CI), DO2i, pump flow, and heparin dosing to support goal-directed perfusion during CPB and ECMO.</p>
        </div>
      </section>

      <section id="view-home" class="hidden animate-in fade-in duration-300">
        <div class="bg-white dark:bg-primary-900 rounded-2xl shadow-card dark:shadow-none border border-slate-200 dark:border-primary-800 overflow-hidden">
          <div class="p-6 space-y-4">
            <div class="space-y-2">
              <p class="text-[11px] uppercase tracking-wider text-accent-500 font-semibold">Start here</p>
              <p class="text-sm text-slate-600 dark:text-slate-300">Choose a calculator below or explore our heparin management, BSA, GDP, hematocrit, lean mass, and time tools built for perfusion teams.</p>
            </div>

            <div class="grid md:grid-cols-2 gap-3">
              <a href="/bsa" data-route class="flex items-center justify-between p-4 rounded-xl border border-slate-200 dark:border-primary-800 bg-slate-50 dark:bg-primary-900/50 hover:border-accent-500/40 transition-colors">
                <div>
                  <div class="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400">Calculator</div>
                  <div class="text-base font-semibold text-primary-900 dark:text-white">BSA Calculator</div>
                </div>
                <span class="text-accent-500">→</span>
              </a>
              <a href="/heparin" data-route class="flex items-center justify-between p-4 rounded-xl border border-slate-200 dark:border-primary-800 bg-slate-50 dark:bg-primary-900/50 hover:border-accent-500/40 transition-colors">
                <div>
                  <div class="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400">Calculator</div>
                  <div class="text-base font-semibold text-primary-900 dark:text-white">Heparin Management</div>
                </div>
                <span class="text-accent-500">→</span>
              </a>
              <a href="/gdp" data-route class="flex items-center justify-between p-4 rounded-xl border border-slate-200 dark:border-primary-800 bg-slate-50 dark:bg-primary-900/50 hover:border-accent-500/40 transition-colors">
                <div>
                  <div class="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400">Calculator</div>
                  <div class="text-base font-semibold text-primary-900 dark:text-white">GDP (DO₂i) Calculator</div>
                </div>
                <span class="text-accent-500">→</span>
              </a>
              <a href="/predicted-hct" data-route class="flex items-center justify-between p-4 rounded-xl border border-slate-200 dark:border-primary-800 bg-slate-50 dark:bg-primary-900/50 hover:border-accent-500/40 transition-colors">
                <div>
                  <div class="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400">Calculator</div>
                  <div class="text-base font-semibold text-primary-900 dark:text-white">Predicted Hematocrit</div>
                </div>
                <span class="text-accent-500">→</span>
              </a>
              <a href="/lbm" data-route class="flex items-center justify-between p-4 rounded-xl border border-slate-200 dark:border-primary-800 bg-slate-50 dark:bg-primary-900/50 hover:border-accent-500/40 transition-colors">
                <div>
                  <div class="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400">Calculator</div>
                  <div class="text-base font-semibold text-primary-900 dark:text-white">Lean Body Mass</div>
                </div>
                <span class="text-accent-500">→</span>
              </a>
              <a href="/priming-volume" data-route class="flex items-center justify-between p-4 rounded-xl border border-slate-200 dark:border-primary-800 bg-slate-50 dark:bg-primary-900/50 hover:border-accent-500/40 transition-colors">
                <div>
                  <div class="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400">Calculator</div>
                  <div class="text-base font-semibold text-primary-900 dark:text-white">Priming Volume</div>
                </div>
                <span class="text-accent-500">→</span>
              </a>
              <a href="/timecalc" data-route class="flex items-center justify-between p-4 rounded-xl border border-slate-200 dark:border-primary-800 bg-slate-50 dark:bg-primary-900/50 hover:border-accent-500/40 transition-colors">
                <div>
                  <div class="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400">Calculator</div>
                  <div class="text-base font-semibold text-primary-900 dark:text-white">Time Calculator</div>
                </div>
                <span class="text-accent-500">→</span>
              </a>
            </div>
          </div>
        </div>
      </section>

            <section id="view-do2i" class="hidden animate-in fade-in duration-300">

        <div class="bg-white dark:bg-primary-900 rounded-2xl shadow-card dark:shadow-none border border-slate-200 dark:border-primary-800 overflow-hidden">
          <div class="p-6 border-b border-slate-100 dark:border-primary-800 flex flex-wrap items-center justify-between gap-4 bg-slate-50/50 dark:bg-primary-800/30">
            <div>
              <h2 class="text-xl font-bold text-primary-900 dark:text-white flex items-center gap-2">Goal-Directed Perfusion (GDP) Calculator</h2>
              <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Set a DO₂i target and evaluate whether current pump flow is adequate.</p>
            </div>

            <button id="do2i-reset" class="p-2 text-slate-400 hover:text-primary-900 dark:hover:text-accent-400 transition-colors" title="Reset Inputs">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
              </svg>
            </button>
          </div>

          <div class="p-6 space-y-6">
            <div class="bg-slate-50 dark:bg-primary-800/50 border border-slate-100 dark:border-primary-700/50 rounded-xl p-4 space-y-3">
              <div class="flex items-center justify-between gap-3 flex-wrap">
                <div>
                  <p class="text-[11px] uppercase tracking-wider text-slate-500 dark:text-slate-400 font-semibold">Target DO₂i</p>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Select a preset goal or enter a custom value.</p>
                </div>
                <div id="target-pill-row" class="flex flex-wrap items-center gap-2">
                  <button id="target-260" data-value="260" class="px-3 py-1.5 text-xs font-semibold rounded-full border transition-colors">260 (min)</button>
                  <button id="target-280" data-value="280" class="px-3 py-1.5 text-xs font-semibold rounded-full border transition-colors">280 (standard)</button>
                  <button id="target-300" data-value="300" class="px-3 py-1.5 text-xs font-semibold rounded-full border transition-colors">300 (high-normal)</button>
                  <button id="target-360" data-value="360" class="px-3 py-1.5 text-xs font-semibold rounded-full border transition-colors">360 (pediatric)</button>
                  <div class="flex items-center gap-2 px-3 py-1 rounded-full border text-xs font-semibold transition-colors cursor-pointer bg-white dark:bg-primary-800 border-slate-200 dark:border-primary-700" id="target-custom-pill">
                    <span>Custom</span>
                    <input id="target-custom" type="number" min="1" step="1" placeholder="—" class="w-20 bg-transparent border-0 focus:ring-0 focus:outline-none text-right text-sm" aria-label="Custom DO2i" />
                  </div>
                </div>
              </div>
            </div>

            <div class="grid sm:grid-cols-2 gap-6">
              <div class="space-y-1">
                <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 tracking-wide">Height (cm)</label>
                <input id="h_cm" type="number" step="0.1" placeholder="170" class="w-full bg-slate-50 dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none transition-all dark:text-white" />
              </div>
              <div class="space-y-1">
                <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 tracking-wide">Weight (kg)</label>
                <input id="w_kg" type="number" step="0.1" placeholder="70" class="w-full bg-slate-50 dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none transition-all dark:text-white" />
              </div>

              <div class="sm:col-span-2 grid grid-cols-[1fr_140px] gap-4 items-end bg-slate-50 dark:bg-primary-800/50 p-4 rounded-xl border border-slate-100 dark:border-primary-700/50">
                <div class="space-y-1">
                  <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 tracking-wide flex justify-between items-center">
                    <span class="flex items-center gap-1">BSA (m²) <span class="text-red-500">*</span></span>
                    <span id="bsa-hint" class="text-[10px] font-normal text-slate-400 lowercase">auto-calc</span>
                  </label>
                  <input id="bsa" type="number" step="0.01" placeholder="Auto from H/W or enter" class="w-full bg-white dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 outline-none dark:text-white" />
                </div>
                <div class="space-y-1">
                  <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide">Formula</label>
                  <select id="bsa-method" class="w-full bg-white dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-3 py-2.5 text-sm focus:ring-2 focus:ring-accent-500 outline-none dark:text-white cursor-pointer">
                    <option value="Mosteller">Mosteller</option>
                    <option value="DuBois">DuBois</option>
                    <option value="Haycock">Haycock</option>
                    <option value="Boyd">Boyd</option>
                  </select>
                </div>
              </div>

              <div class="space-y-1">
                <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 tracking-wide">Hemoglobin (g/dL) <span class="text-red-500">*</span></label>
                <input id="hb" type="number" step="0.1" placeholder="10" class="w-full bg-slate-50 dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none transition-all dark:text-white" />
              </div>
              <div class="space-y-1">
                <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 tracking-wide">PaO<sub>2</sub> (mmHg) <span class="text-red-500">*</span></label>
                <input id="pao2" type="number" step="1" placeholder="150" class="w-full bg-slate-50 dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none transition-all dark:text-white" />
              </div>
              <div class="space-y-1">
                <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 tracking-wide">SaO<sub>2</sub> (%) <span class="text-red-500">*</span></label>
                <input id="sao2" type="number" step="0.1" placeholder="100" class="w-full bg-slate-50 dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none transition-all dark:text-white" />
              </div>

              <div class="space-y-1">
                <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 tracking-wide">Current pump flow (L/min)</label>
                <input id="flow" type="number" step="0.01" placeholder="4.6" class="w-full bg-slate-50 dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none transition-all dark:text-white" />
              </div>
              <div class="space-y-1 opacity-80">
                <label class="text-xs font-semibold text-slate-400 dark:text-slate-500 tracking-wide">Calculated CaO<sub>2</sub> (mL/dL)</label>
                <input id="cao2" disabled class="w-full bg-slate-100 dark:bg-primary-950 border-0 rounded-xl px-4 py-2.5 text-slate-600 dark:text-slate-400 font-mono text-sm" />
              </div>
            </div>

            <p class="text-[11px] text-slate-500 dark:text-slate-400">* Required for DO₂i and target flow calculation. Current flow is optional.</p>
            <p id="gdp-warning" class="text-xs text-red-500 hidden">Enter required fields.</p>

            <div class="bg-primary-900 dark:bg-black/20 p-6 text-white rounded-xl relative overflow-hidden">
              <div class="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-accent-500 rounded-full opacity-10 blur-3xl"></div>
              <div class="absolute inset-0 bg-gradient-to-br from-primary-900 via-primary-900 to-primary-800 opacity-70"></div>
              <div class="relative z-10 space-y-5">
                <div class="grid md:grid-cols-3 gap-4">
                  <div class="bg-white/5 rounded-lg p-4 border border-white/10 shadow-sm">
                    <div class="text-[11px] uppercase tracking-wider text-slate-300">Required pump flow</div>
                    <div id="required-flow" class="text-2xl font-bold mt-1">—</div>
                  </div>
                  <div class="bg-white/5 rounded-lg p-4 border border-white/10 shadow-sm">
                    <div class="text-[11px] uppercase tracking-wider text-slate-300">Current DO₂i</div>
                    <div id="current-do2i" class="text-2xl font-bold mt-1">—</div>
                  </div>
                  <div class="bg-white/5 rounded-lg p-4 border border-white/10 shadow-sm">
                    <div class="text-[11px] uppercase tracking-wider text-slate-300">Status</div>
                    <div id="gdp-status-text" class="text-lg font-semibold mt-1">Awaiting data</div>
                    <p id="gdp-status-detail" class="text-xs text-slate-200 mt-1">Provide required inputs to evaluate target vs. current flow.</p>
                  </div>
                </div>

                <div class="space-y-2">
                  <div class="h-3 w-full bg-white/10 rounded-full overflow-hidden shadow-inner">
                    <div id="gdp-gauge" class="h-full bg-gradient-to-r transition-all duration-700 ease-out shadow-[0_0_10px_rgba(255,255,255,0.3)] from-accent-600 to-accent-400" style="width: 0%;"></div>
                  </div>
                  <div id="gdp-gauge-msg" class="text-xs text-slate-200">Enter current flow to visualize DO₂i vs. target</div>
                  <div id="ci-comment" class="text-[11px] text-slate-300"></div>
                </div>
              </div>
            </div>

              <div class="bg-slate-50 dark:bg-primary-900/30 rounded-xl border border-slate-100 dark:border-primary-700/50 p-4 space-y-2 text-xs text-slate-600 dark:text-slate-300">
                <p>This GDP calculator uses standard DO₂i formula: DO₂i = (Flow ÷ BSA) × CaO₂ × 10. Required flow is DO₂i × BSA ÷ (CaO₂ × 10).</p>
                <p>Clinical decisions must follow institutional protocols and consider lactate, SvO₂/ScvO₂, urine output, and perfusion pressures.</p>
              </div>
          </div>

        </div>

        <details class="mt-4 group">
          <summary class="cursor-pointer text-xs font-semibold text-slate-500 dark:text-slate-400 hover:text-accent-500 transition-colors list-none flex items-center gap-2">
            <span class="transform transition-transform group-open:rotate-90">▶</span> Methodology
          </summary>
          <div class="mt-2 p-4 rounded-xl bg-white dark:bg-primary-900 border border-slate-100 dark:border-primary-800 text-xs text-slate-600 dark:text-slate-400 leading-relaxed shadow-sm space-y-3">
            <ol class="list-decimal pl-4 space-y-3">
              <li>
                <p class="font-semibold text-slate-700 dark:text-slate-200">Arterial oxygen content (CaO₂)</p>
                <p>CaO₂ (ml/dl) = 1.34 × Hb (g/dl) × (SaO₂ / 100) + 0.0031 × PaO₂ (mmhg). We assume a Hüfner constant of 1.34 ml O₂ per gram of Hb and a dissolved O₂ coefficient of 0.0031 ml·dl⁻¹·mmhg⁻¹. The contribution of dissolved O₂ is usually small at normal PaO₂.</p>
              </li>
              <li>
                <p class="font-semibold text-slate-700 dark:text-slate-200">Indexed oxygen delivery (DO₂i)</p>
                <p>DO₂i (ml/min/m²) = (Pump flow ÷ BSA) × CaO₂ × 10. Pump flow is entered in l/min and BSA in m². Multiplying by 10 converts CaO₂ from ml/dl to ml/l so that the final unit is ml O₂ per minute per m².</p>
              </li>
              <li>
                <p class="font-semibold text-slate-700 dark:text-slate-200">Target DO₂i bands (Goal-Directed Perfusion)</p>
                <p>At normothermia (≈37 °C) many adult CPB programs aim to maintain DO₂i ≥ 280–300 ml/min/m² to reduce the risk of anaerobic metabolism and postoperative acute kidney injury. The gauge displays “Low / Borderline / Target / High” bands for quick bedside interpretation using normothermic goals.</p>
              </li>
              <li>
                <p class="font-semibold text-slate-700 dark:text-slate-200">Required pump flow for a chosen DO₂i goal</p>
                <p>For a selected DO₂i target, the corresponding pump flow is: Required flow (l/min) = (Target DO₂i × BSA) ÷ (CaO₂ × 10). This is a theoretical value based on current Hb, SaO₂, PaO₂ and BSA. In practice, flow should also respect institutional minimum/maximum flow policies and patient-specific constraints (e.g. cannula size, arterial pressure, ventricular distension).</p>
              </li>
              <li>
                <p class="font-semibold text-slate-700 dark:text-slate-200">Clinical use and limitations</p>
                <p>The calculator is intended to support goal-directed perfusion, not to replace local protocols or clinical judgment. Final flow and DO₂i settings should always be interpreted together with:</p>
                <ul class="list-disc pl-4 space-y-1 mt-1">
                  <li>Mixed or central venous saturation (SvO₂/ScvO₂)</li>
                  <li>Lactate trends</li>
                  <li>Urine output and other organ-perfusion markers</li>
                  <li>Hemodynamics and surgical field conditions</li>
                </ul>
                <p class="mt-1">All formulas assume complete mixing in the CPB circuit and do not account for ongoing blood loss, retransfusion, or major changes in oxygen extraction. Values are approximate and for educational use by trained clinicians only.</p>
              </li>
            </ol>
          </div>
        </details>


      </section>

      <section id="view-bsa" class="hidden animate-in fade-in duration-300">
        <div class="bg-white dark:bg-primary-900 rounded-2xl shadow-card dark:shadow-none border border-slate-200 dark:border-primary-800 overflow-hidden">

          <div class="p-6 border-b border-slate-100 dark:border-primary-800 bg-slate-50/50 dark:bg-primary-800/30 flex items-start justify-between gap-4">
            <div>
              <p class="text-[11px] uppercase tracking-widest text-accent-500 font-semibold">Body Surface Area</p>
              <h2 class="text-xl font-bold text-primary-900 dark:text-white flex items-center gap-2">BSA Calculator</h2>
              <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Enter height and weight to calculate BSA and perfusion flow guidance.</p>
            </div>
            <div class="text-right">
              <div class="text-[10px] uppercase tracking-wider text-slate-400">BSA (m²)</div>
              <div id="bsa-result" class="text-3xl font-bold text-accent-500">0.00</div>
              <div class="text-[11px] text-slate-400">Updates in real time</div>
            </div>
          </div>

          <div class="p-6 space-y-6">
            <div class="grid lg:grid-cols-[1.2fr_0.8fr] gap-6">
              <div class="space-y-4">
                <div class="grid sm:grid-cols-2 gap-4">
                  <div class="space-y-1">
                    <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide">Height (cm)</label>
                    <input id="bsa_height" type="number" step="0.1" placeholder="170" class="w-full bg-slate-50 dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none transition-all dark:text-white" />
                  </div>
                  <div class="space-y-1">
                    <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide">Weight (kg)</label>
                    <input id="bsa_weight" type="number" step="0.1" placeholder="70" class="w-full bg-slate-50 dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none transition-all dark:text-white" />
                  </div>

                  <div class="sm:col-span-2 space-y-2">
                    <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide">Formula</label>
                    <select id="bsa-method-standalone" class="w-full bg-white dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-3 py-2.5 text-sm focus:ring-2 focus:ring-accent-500 outline-none dark:text-white cursor-pointer">
                      <option value="Mosteller">Mosteller</option>
                      <option value="DuBois">DuBois</option>
                      <option value="Haycock">Haycock</option>
                      <option value="Boyd">Boyd</option>
                    </select>
                    <p class="text-[11px] text-slate-500 dark:text-slate-400">Mosteller is the clinical default; switch formulas as needed.</p>
                  </div>
                </div>

                <div class="bg-primary-900 dark:bg-black/30 rounded-2xl text-white p-5 shadow-inner">
                  <div class="flex items-center justify-between">
                    <div>
                      <div class="text-[11px] uppercase tracking-wider text-slate-300 mb-1">BSA Output</div>
                      <div class="text-4xl font-bold" id="bsa-result-display">—</div>
                      <p class="text-[11px] text-slate-300 mt-1">Calculated from height and weight only.</p>
                    </div>
                    <div class="text-right text-xs text-slate-300">
                      <div class="uppercase tracking-wider text-[10px] text-slate-400">Formula</div>
                      <div class="font-semibold" id="bsa-method-active">Mosteller</div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="bg-slate-50 dark:bg-primary-800/60 rounded-2xl border border-slate-100 dark:border-primary-700/60 p-5 flex flex-col lg:col-span-2">
                <div class="flex items-center justify-between mb-3">
                  <div>
                    <h4 class="text-xs font-bold text-primary-900 dark:text-slate-100 uppercase tracking-wider">Blood Flow Rate by Cardiac Index</h4>
                    <p class="text-[11px] text-slate-500 dark:text-slate-400">Scaled from the BSA result below.</p>
                  </div>
                  <span class="text-[10px] text-slate-400">CI 1.0–3.0</span>
                </div>
                <div class="max-h-80 min-h-[18rem] overflow-y-auto pr-1" id="bsa-flow-list"></div>
              </div>
            </div>

              <details class="group">
              <summary class="cursor-pointer text-xs font-semibold text-slate-500 dark:text-slate-400 hover:text-accent-500 transition-colors list-none flex items-center gap-2">
                <span class="transform transition-transform group-open:rotate-90">▶</span> Methodology
              </summary>
              <div class="mt-2 p-4 rounded-xl bg-slate-50 dark:bg-primary-800/60 border border-slate-100 dark:border-primary-700/60 text-xs text-slate-600 dark:text-slate-300 leading-relaxed space-y-4">
                <div class="space-y-1">
                  <h5 class="text-sm font-semibold text-primary-900 dark:text-white">What is BSA and why does it matter?</h5>
                  <p>Body surface area (BSA) is an estimate of a patient’s external body size. In perfusion it is used to index pump flow, DO₂i, drug dosing and heat-exchange settings. All formulas below use Height in cm and Weight in kg and are empiric fits to population data – they are not exact, but close enough for clinical use when applied consistently.</p>
                </div>

                <div class="space-y-2">
                  <h5 class="text-sm font-semibold text-primary-900 dark:text-white">Mosteller formula</h5>
                  <div class="font-semibold">Mosteller:</div>
                  <div class="bg-white/80 dark:bg-primary-900/70 border border-slate-200 dark:border-primary-700 rounded-lg px-4 py-2 font-mono text-[11px] text-primary-900 dark:text-slate-100">
                    BSA = √((Height(cm) × Weight(kg)) / 3600)
                  </div>
                  <ul class="list-disc pl-5 space-y-1">
                    <li>Very simple and fast to calculate (only one square-root).</li>
                    <li>For most adults with BMI 18–35, it gives values very close to more complex formulas.</li>
                    <li>Because of its simplicity, it has become a de-facto clinical default in many CPB and ECMO centers.</li>
                  </ul>
                </div>

                <div class="space-y-2">
                  <h5 class="text-sm font-semibold text-primary-900 dark:text-white">DuBois &amp; DuBois formula</h5>
                  <div class="font-semibold">DuBois:</div>
                  <div class="bg-white/80 dark:bg-primary-900/70 border border-slate-200 dark:border-primary-700 rounded-lg px-4 py-2 font-mono text-[11px] text-primary-900 dark:text-slate-100">
                    BSA = 0.007184 × Height(cm)<sup>0.725</sup> × Weight(kg)<sup>0.425</sup>
                  </div>
                  <ul class="list-disc pl-5 space-y-1">
                    <li>Historical “reference standard” derived from direct body-surface measurements on a small adult cohort.</li>
                    <li>Slightly lower BSA than Mosteller in very light or very heavy patients, but differences are usually &lt;3–5%.</li>
                    <li>Still used in some pharmacology and physiology papers, so it is useful when you want to reproduce values from the literature.</li>
                  </ul>
                </div>

                <div class="space-y-2">
                  <h5 class="text-sm font-semibold text-primary-900 dark:text-white">Haycock formula</h5>
                  <div class="font-semibold">Haycock:</div>
                  <div class="bg-white/80 dark:bg-primary-900/70 border border-slate-200 dark:border-primary-700 rounded-lg px-4 py-2 font-mono text-[11px] text-primary-900 dark:text-slate-100">
                    BSA = 0.024265 × Height(cm)<sup>0.3964</sup> × Weight(kg)<sup>0.5378</sup>
                  </div>
                  <ul class="list-disc pl-5 space-y-1">
                    <li>Developed from a large pediatric dataset.</li>
                    <li>Generally considered to have better accuracy in infants and children, especially in low-weight ranges.</li>
                    <li>Many pediatric cardiac programs prefer Haycock when indexing flow or valve/vascular dimensions.</li>
                  </ul>
                </div>

                <div class="space-y-2">
                  <h5 class="text-sm font-semibold text-primary-900 dark:text-white">Gehan–George / Boyd or other “obesity-friendly” formulas</h5>
                  <ul class="list-disc pl-5 space-y-1">
                    <li>These formulas adjust the exponents or constants to behave more realistically in patients with very high body weight or BMI.</li>
                    <li>They tend to give slightly lower BSA than Mosteller in severe obesity, avoiding extreme indexed values that clearly do not match the patient’s physiologic reserve.</li>
                    <li>Useful when you want to perform sensitivity analysis in obese patients (e.g. compare “standard BSA” vs “obesity-adjusted BSA”).</li>
                  </ul>
                </div>

                <div class="space-y-2">
                  <h5 class="text-sm font-semibold text-primary-900 dark:text-white">Practical tips for perfusionists</h5>
                  <ul class="list-disc pl-5 space-y-1">
                    <li>For general adult CPB/ECMO, using Mosteller as the default is reasonable and widely accepted.</li>
                    <li>For pediatric cases, consider Haycock (or your institutional standard) and keep the same formula throughout the case and across all flow/DO₂i calculations.</li>
                    <li>In obese patients (BMI ≥30), you may compare Mosteller vs an obesity-adjusted formula (e.g. Gehan–George / Boyd) to understand how much BSA – and therefore CI/DO₂i – changes.</li>
                    <li>More important than the “perfect” formula is internal consistency: once your program chooses a BSA formula, use it across perfusion flows, DO₂i targets, drug dosing and documentation.</li>
                    <li>Remember that BSA is only a surrogate for metabolic demand. Always interpret indexed values together with clinical context (temperature, SvO₂/ScvO₂, lactate, urine output, organ function).</li>
                  </ul>
                </div>
              </div>
            </details>
          </div>
        </div>
      </section>

      <section id="view-hct" class="hidden animate-in fade-in duration-300">
        <div class="bg-white dark:bg-primary-900 rounded-2xl shadow-card dark:shadow-none border border-slate-200 dark:border-primary-800 overflow-hidden">
          
          <div class="p-6 border-b border-slate-100 dark:border-primary-800 bg-slate-50/50 dark:bg-primary-800/30">
            <h2 class="text-xl font-bold text-primary-900 dark:text-white">Predicted Hct <span class="text-slate-400 font-normal text-base">on CPB</span></h2>
            <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Dilutional hematocrit calculator</p>
          </div>

          <div class="p-6 grid sm:grid-cols-2 gap-6">
            <div class="sm:col-span-2">
              <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide">Patient Type (EBV Coef)</label>
              <select id="pttype" class="mt-1 w-full bg-white dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 outline-none transition-all dark:text-white cursor-pointer">
                <option value="adult_m">Adult — Male (70 ml/kg)</option>
                <option value="adult_f">Adult — Female (65 ml/kg)</option>
                <option value="child">Child (75 ml/kg)</option>
                <option value="infant">Infant (80 ml/kg)</option>
                <option value="neonate">Neonate (90 ml/kg)</option>
              </select>
            </div>

            <div class="space-y-1">
              <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide">EBV Coef (ml/kg)</label>
              <input id="ebv_coef" type="number" step="1" placeholder="70" class="w-full bg-slate-50 dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none transition-all dark:text-white" />
            </div>

            <div class="space-y-1">
              <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide">Weight (kg)</label>
              <input id="wt_hct" type="number" step="0.1" placeholder="70" class="w-full bg-slate-50 dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none transition-all dark:text-white" />
            </div>
            <div class="space-y-1">
              <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide">Pre-CPB Hct (%)</label>
              <input id="pre_hct" type="number" step="0.1" placeholder="40" class="w-full bg-slate-50 dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none transition-all dark:text-white" />
            </div>

            <div class="bg-slate-50 dark:bg-primary-800/50 p-4 rounded-xl border border-slate-100 dark:border-primary-700/50 sm:col-span-2 grid sm:grid-cols-2 gap-4">
               <div class="sm:col-span-2 text-xs font-bold text-primary-900 dark:text-accent-400 uppercase tracking-wide mb-1">Circuit Volumes</div>
               <div class="space-y-1">
                 <label class="text-xs text-slate-500 dark:text-slate-400">Prime Volume (ml)</label>
                 <input id="prime" type="number" step="1" placeholder="1200" class="w-full bg-white dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-lg px-3 py-2 focus:ring-2 focus:ring-accent-500 outline-none dark:text-white" />
               </div>
               <div class="space-y-1">
                 <label class="text-xs text-slate-500 dark:text-slate-400">Addl. Crystalloid (ml)</label>
                 <input id="fluids" type="number" step="1" value="0" class="w-full bg-white dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-lg px-3 py-2 focus:ring-2 focus:ring-accent-500 outline-none dark:text-white" />
               </div>
               <div class="space-y-1">
                 <label class="text-xs text-slate-500 dark:text-slate-400">Ultrafiltration Removed (ml)</label>
                 <input id="removed" type="number" step="1" value="0" class="w-full bg-white dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-lg px-3 py-2 focus:ring-2 focus:ring-accent-500 outline-none dark:text-white" />
               </div>
            </div>

            <div class="bg-red-50 dark:bg-red-900/10 p-4 rounded-xl border border-red-100 dark:border-red-900/20 sm:col-span-2 grid sm:grid-cols-3 gap-4">
              <div class="sm:col-span-3 text-xs font-bold text-red-800 dark:text-red-400 uppercase tracking-wide mb-1">Blood Products</div>
              <div class="space-y-1">
                 <label class="text-xs text-slate-500 dark:text-slate-400">RBC Units</label>
                 <input id="rbc_units" type="number" step="1" value="0" class="w-full bg-white dark:bg-primary-800 border border-red-200 dark:border-red-900/30 rounded-lg px-3 py-2 focus:ring-2 focus:ring-red-500 outline-none dark:text-white" />
              </div>
              <div class="space-y-1">
                 <label class="text-xs text-slate-500 dark:text-slate-400">Vol/Unit (ml)</label>
                 <input id="rbc_unit_vol" type="number" step="1" value="300" class="w-full bg-white dark:bg-primary-800 border border-red-200 dark:border-red-900/30 rounded-lg px-3 py-2 focus:ring-2 focus:ring-red-500 outline-none dark:text-white" />
              </div>
              <div class="space-y-1">
                 <label class="text-xs text-slate-500 dark:text-slate-400">Unit Hct (%)</label>
                 <input id="rbc_hct" type="number" step="1" value="60" class="w-full bg-white dark:bg-primary-800 border border-red-200 dark:border-red-900/30 rounded-lg px-3 py-2 focus:ring-2 focus:ring-red-500 outline-none dark:text-white" />
              </div>
            </div>
          </div>

          <div class="bg-primary-900 dark:bg-black/20 p-6 text-white grid grid-cols-3 gap-4 divide-x divide-primary-800 dark:divide-white/10 text-center">
            <div>
              <div class="text-[10px] uppercase tracking-wider text-slate-400 mb-1">EBV</div>
              <div id="ebv" class="text-lg font-mono font-medium">0</div>
              <div class="text-[10px] text-slate-500">ml</div>
            </div>
            <div>
              <div class="text-[10px] uppercase tracking-wider text-slate-400 mb-1">Total Vol</div>
              <div id="total_vol" class="text-lg font-mono font-medium">0</div>
              <div class="text-[10px] text-slate-500">ml</div>
            </div>
            <div class="relative">
              <div class="text-[10px] uppercase tracking-wider text-accent-400 mb-1 font-bold">Result Hct</div>
              <div id="pred_hct" class="text-2xl font-bold text-white">0%</div>
            </div>
          </div>

            <div class="bg-slate-50 dark:bg-primary-800/30 border-t border-slate-100 dark:border-primary-700/50 p-4">
             <h4 class="text-xs font-bold text-primary-900 dark:text-slate-200 uppercase tracking-wider mb-2 flex items-center gap-2">
              <svg class="w-4 h-4 text-accent-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
              Clinical Context
             </h4>
             <div class="text-xs text-slate-600 dark:text-slate-400 space-y-1">
              <p>• <strong>Target Hct:</strong> Often 21–25% on bypass. Lower Hct reduces viscosity but also oxygen carrying capacity.</p>
              <p>• <strong>Adjustments:</strong> Reducing prime volume (RAP/VAP) or adding RBCs increases Hct. Adding crystalloid decreases Hct.</p>
              <p>• <strong>Hemoconcentration:</strong> Use Ultrafiltration (UF) to remove plasma water and increase Hct.</p>
             </div>
             <p class="mt-3 text-[10px] text-slate-400 italic">For educational use only.</p>
            </div>
          </div>
        
        <details class="mt-4 group">
          <summary class="cursor-pointer text-xs font-semibold text-slate-500 dark:text-slate-400 hover:text-accent-500 transition-colors list-none flex items-center gap-2">
            <span class="transform transition-transform group-open:rotate-90">▶</span> Methodology
          </summary>
          <div class="mt-2 p-4 rounded-xl bg-white dark:bg-primary-900 border border-slate-100 dark:border-primary-800 text-xs text-slate-600 dark:text-slate-400 leading-relaxed shadow-sm space-y-3">
            <ol class="list-decimal pl-4 space-y-3">
              <li>
                <p class="font-semibold text-slate-700 dark:text-slate-200">Estimated blood volume (EBV)</p>
                <p>This calculator uses a simple weight-based model for circulating blood volume: EBV (mL) = Weight (kg) × EBV coefficient (mL/kg). Typical default coefficients are:</p>
                <ul class="list-disc pl-4 space-y-1 mt-1">
                  <li>Adult male: 70 mL/kg</li>
                  <li>Adult female: 65 mL/kg</li>
                  <li>Child: 75 mL/kg</li>
                  <li>Infant: 80 mL/kg</li>
                  <li>Neonate: 90 mL/kg</li>
                </ul>
                <p class="mt-1">These values are derived from population averages and may be adjusted in this tool when clinical judgment suggests a higher or lower blood volume (e.g. severe obesity, cachexia, fluid overload or dehydration).</p>
              </li>
              <li>
                <p class="font-semibold text-slate-700 dark:text-slate-200">Pre-CPB red cell volume</p>
                <p>Pre-bypass red cell volume is estimated from the patient’s hematocrit (Hct) and EBV: RBC_patient (mL) = EBV × (Pre-CPB Hct ÷ 100). This assumes the pre-CPB Hct is measured after induction and line placement, and that blood is evenly distributed in the circulation.</p>
              </li>
              <li>
                <p class="font-semibold text-slate-700 dark:text-slate-200">Circuit prime and crystalloid / ultrafiltration</p>
                <p>The total intravascular volume at the time of sampling is modeled as:</p>
                <p class="font-mono bg-slate-50 dark:bg-primary-800/60 border border-slate-200 dark:border-primary-700 rounded-lg px-3 py-2 text-[11px] text-primary-900 dark:text-slate-100">V_total (mL) = EBV + Prime volume + Additional crystalloid / colloid + RBC product volume − Ultrafiltration removed.</p>
                <p>“Prime volume” includes the cardiopulmonary bypass circuit prime and any pre-bypass volume added directly to the patient through the circuit. “Additional crystalloid” represents fluids such as cardioplegia carrier solution, albumin, mannitol, or other volume expanders that effectively dilute the circulating red cell mass. “Ultrafiltration removed” accounts for hemoconcentration techniques (UF, MUF, Z-BUF) that remove plasma water and reduce total volume.</p>
              </li>
              <li>
                <p class="font-semibold text-slate-700 dark:text-slate-200">Packed red blood cell (RBC) products</p>
                <p>Red cell volume contributed by transfused RBCs is modeled as:</p>
                <p class="font-mono bg-slate-50 dark:bg-primary-800/60 border border-slate-200 dark:border-primary-700 rounded-lg px-3 py-2 text-[11px] text-primary-900 dark:text-slate-100">RBC_products (mL) = (Number of units × Volume per unit) × (Unit Hct ÷ 100).</p>
                <p>Default values often assume ~300 mL/unit with a unit Hct around 60%, but these may be adjusted to reflect local blood bank characteristics or specific product labels.</p>
              </li>
              <li>
                <p class="font-semibold text-slate-700 dark:text-slate-200">Predicted hematocrit on CPB</p>
                <p>The predicted hematocrit after mixing patient blood, prime, additional fluids and RBC products is:</p>
                <p class="font-mono bg-slate-50 dark:bg-primary-800/60 border border-slate-200 dark:border-primary-700 rounded-lg px-3 py-2 text-[11px] text-primary-900 dark:text-slate-100">Predicted Hct (%) = (RBC_patient + RBC_products) ÷ V_total × 100.</p>
                <p>This represents a simple mixing model at the time of interest (e.g. shortly after going on CPB or after a planned RBC addition). It assumes complete and rapid mixing in the circuit and does not automatically account for ongoing bleeding, cell saver reinfusion, or major changes in plasma volume after the calculation.</p>
              </li>
              <li>
                <p class="font-semibold text-slate-700 dark:text-slate-200">Clinical interpretation and typical targets</p>
                <p>Many adult programs aim for an on-pump Hct around 21–30%, balancing lower viscosity and improved microcirculatory flow against adequate oxygen carrying capacity. Pediatric and neonatal patients often require higher Hct targets because of limited physiologic reserve and higher relative metabolic demand. Hct targets should be individualized according to patient age, comorbidities (e.g. cerebrovascular disease, coronary disease, pulmonary hypertension), procedural complexity, and institutional policy.</p>
                <p>This calculator is intended to support planning of prime composition, ultrafiltration strategy and transfusion timing. Final decisions must be based on real-time laboratory measurements, hemodynamics, organ perfusion markers and local protocols.</p>
              </li>
              <li>
                <p class="font-semibold text-slate-700 dark:text-slate-200">Limitations</p>
                <p>This is an approximate model for educational and decision-support use only. It does not replace actual Hct measurement from arterial or venous blood samples, nor does it account for:</p>
                <ul class="list-disc pl-4 space-y-1 mt-1">
                  <li>Acute intra-operative blood loss not yet replaced,</li>
                  <li>Large volume cardiotomy suction return or cell-saver reinfusion,</li>
                  <li>Rapid shifts between intravascular and extravascular compartments,</li>
                  <li>Changes in temperature-dependent plasma volume or hemoconcentration beyond the entered UF value.</li>
                </ul>
                <p class="mt-1">Always verify predicted values with real laboratory data and use clinical judgment when adjusting CPB flow, prime strategy or transfusion.</p>
              </li>
            </ol>
          </div>
        </details>
      </section>

      <section id="view-lbm" class="hidden animate-in fade-in duration-300">
        <div class="bg-white dark:bg-primary-900 rounded-2xl shadow-card dark:shadow-none border border-slate-200 dark:border-primary-800 overflow-hidden">

          <div class="p-6 border-b border-slate-100 dark:border-primary-800 bg-slate-50/50 dark:bg-primary-800/30">
            <h2 class="text-xl font-bold text-primary-900 dark:text-white flex items-center gap-2">
              Lean Body Mass
              <span class="px-2 py-0.5 rounded text-xs font-bold bg-accent-500/10 text-accent-600 dark:text-accent-400">LBM</span>
            </h2>
            <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Fat-free body mass calculator</p>
          </div>

          <div class="p-6 grid sm:grid-cols-2 gap-6">
            <div class="space-y-1">
              <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide">Height (cm)</label>
              <input id="lbm_h_cm" type="number" step="0.1" placeholder="170" class="w-full bg-slate-50 dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none transition-all dark:text-white" />
            </div>
            <div class="space-y-1">
              <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide">Weight (kg)</label>
              <input id="lbm_w_kg" type="number" step="0.1" placeholder="70" class="w-full bg-slate-50 dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none transition-all dark:text-white" />
            </div>

            <div class="space-y-1">
              <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide">Sex</label>
              <select id="lbm_sex" class="w-full bg-white dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 outline-none transition-all dark:text-white cursor-pointer">
                <option value="male">Male</option>
                <option value="female">Female</option>
              </select>
            </div>
            <div class="space-y-1">
              <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide">Formula</label>
              <select id="lbm_formula" class="w-full bg-white dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 outline-none transition-all dark:text-white cursor-pointer">
                <option value="Boer">Boer</option>
                <option value="Hume">Hume</option>
              </select>
            </div>

            <div class="space-y-1 sm:col-span-2">
              <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide">BSA Formula</label>
              <select id="lbm_bsa_formula" class="w-full bg-white dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-accent-500 outline-none transition-all dark:text-white cursor-pointer">
                <option value="Mosteller">Mosteller (default)</option>
                <option value="DuBois">DuBois</option>
                <option value="Haycock">Haycock</option>
                <option value="GehanGeorge">Gehan–George</option>
              </select>
            </div>
          </div>

          <div class="p-6 pt-0 space-y-6">
            <div class="bg-primary-900 dark:bg-black/20 p-6 text-white relative overflow-hidden rounded-2xl">
              <div class="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-accent-500 rounded-full opacity-10 blur-3xl"></div>

              <div class="relative z-10 flex items-end justify-between">
                <div class="text-slate-300 text-sm font-medium">LBM Result</div>
                <div id="lbm_result" class="text-4xl font-bold tracking-tight text-white">0 <span class="text-lg font-normal text-slate-400">kg</span></div>
              </div>
            </div>

            <div class="grid md:grid-cols-3 gap-4">
              <div class="bg-white dark:bg-primary-900 rounded-2xl shadow-card border border-slate-200 dark:border-primary-800 p-4">
                <div class="text-[11px] uppercase tracking-wide font-semibold text-slate-500 dark:text-slate-400">BMI</div>
                <div id="bmi_value" class="text-3xl font-bold text-primary-900 dark:text-white mt-1">—</div>
                <div id="bmi_badge" class="inline-flex mt-2 px-3 py-1 rounded-full text-[11px] font-semibold bg-slate-100 dark:bg-primary-800 text-slate-600 dark:text-slate-300">—</div>
              </div>

              <div class="bg-white dark:bg-primary-900 rounded-2xl shadow-card border border-slate-200 dark:border-primary-800 p-4">
                <div class="text-[11px] uppercase tracking-wide font-semibold text-slate-500 dark:text-slate-400">BSA (Actual)</div>
                <div id="bsa_actual_value" class="text-3xl font-bold text-primary-900 dark:text-white mt-1">—</div>
                <div id="bsa_actual_note" class="text-xs text-slate-500 dark:text-slate-400">Mosteller formula</div>
              </div>

              <div class="bg-white dark:bg-primary-900 rounded-2xl shadow-card border border-slate-200 dark:border-primary-800 p-4">
                <div class="text-[11px] uppercase tracking-wide font-semibold text-slate-500 dark:text-slate-400">BSA (Lean)</div>
                <div id="bsa_lean_value" class="text-3xl font-bold text-emerald-600 dark:text-emerald-400 mt-1">—</div>
                <div id="bsa_lean_note" class="text-xs text-slate-500 dark:text-slate-400">Boer/Hume LBM — kg</div>
              </div>
            </div>

            <div class="bg-white dark:bg-primary-900 rounded-2xl shadow-card border border-slate-200 dark:border-primary-800">
              <div class="p-4 border-b border-slate-100 dark:border-primary-800">
                <h3 class="text-lg font-semibold text-primary-900 dark:text-white">Flow comparison table (CI 1.0 – 3.0)</h3>
                <p class="text-xs text-slate-500 dark:text-slate-400">BSA actual vs BSA lean flow comparison</p>
              </div>
              <div class="overflow-x-auto max-h-64">
                <table class="min-w-full text-sm">
                  <thead class="bg-slate-50 dark:bg-primary-900/50 text-left text-slate-600 dark:text-slate-300 uppercase text-[11px] tracking-wide">
                    <tr>
                      <th class="px-4 py-2">CI</th>
                      <th class="px-4 py-2">Flow (Actual BSA)</th>
                      <th class="px-4 py-2">Flow (Lean BSA)</th>
                    </tr>
                  </thead>
                  <tbody id="lbm-flow-rows" class="divide-y divide-slate-100 dark:divide-primary-800"></tbody>
                </table>
              </div>
            </div>

            <div class="bg-slate-50 dark:bg-primary-800/30 border border-slate-100 dark:border-primary-700/50 p-4 rounded-2xl">
              <h4 class="text-xs font-bold text-primary-900 dark:text-slate-200 uppercase tracking-wider mb-2 flex items-center gap-2">
                <svg class="w-4 h-4 text-accent-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                Clinical Notes
              </h4>
              <div class="text-xs text-slate-600 dark:text-slate-400 space-y-1">
                <p>• <strong>LBM Definition:</strong> Total body weight minus adipose tissue mass (fat-free mass).</p>
                <p>• <strong>Clinical Use:</strong> Drug dosing, nutritional assessment, and metabolic calculations.</p>
                <p>• <strong>Formulas:</strong> Hume (1966) and Boer (1984) equations are commonly used in clinical practice.</p>
              </div>
              <p class="mt-3 text-[10px] text-slate-400 italic">For educational use only. Not medical advice.</p>
            </div>
          </div>
        </div>

        <details class="mt-4 group">
          <summary class="cursor-pointer text-xs font-semibold text-slate-500 dark:text-slate-400 hover:text-accent-500 transition-colors list-none flex items-center gap-2">
            <span class="transform transition-transform group-open:rotate-90">▶</span> Methodology
          </summary>
          <div class="mt-2 p-4 rounded-xl bg-white dark:bg-primary-900 border border-slate-100 dark:border-primary-800 text-xs text-slate-600 dark:text-slate-400 leading-relaxed shadow-sm space-y-3">
            <div>
              <p class="font-semibold mb-1">1. Definition of Lean Body Mass (LBM)</p>
              <p>Lean body mass represents total body weight minus adipose tissue mass (fat-free mass). In perfusion and anesthesia it is often used as a surrogate for metabolically active tissue, which better reflects drug distribution and oxygen demand than total body weight in obese patients.</p>
            </div>

            <div class="space-y-1">
              <p class="font-semibold mb-1">2. LBM formulas used in this calculator</p>
              <p>Two adult LBM equations are provided. Height is in centimeters and weight in kilograms.</p>
              <p class="font-semibold">Boer (1984) – commonly recommended for adults, including obesity</p>
              <p>Male: LBM (kg) = 0.407 × Weight + 0.267 × Height − 19.2</p>
              <p class="mb-2">Female: LBM (kg) = 0.252 × Weight + 0.473 × Height − 48.3</p>
              <p class="font-semibold">Hume (1966) – earlier reference formula</p>
              <p>Male: LBM (kg) = 0.32810 × Weight + 0.33929 × Height − 29.5336</p>
              <p>Female: LBM (kg) = 0.29569 × Weight + 0.41813 × Height − 43.2933</p>
              <p class="text-slate-500 dark:text-slate-500">The calculator allows switching between Boer and Hume so clinicians can compare results when evaluating very obese or very underweight patients.</p>
            </div>

            <div class="space-y-1">
              <p class="font-semibold mb-1">3. BMI and BSA (actual)</p>
              <p><strong>BMI (kg/m²)</strong> = Weight (kg) ÷ [Height (m)]². BMI is shown for context only (e.g., normal range 18.5–24.9, obesity ≥30).</p>
              <p><strong>Actual Body Surface Area – BSA (Mosteller)</strong></p>
              <p>BSA_actual (m²) = √{ [Height (cm) × Weight (kg)] ÷ 3600 }.</p>
              <p>Mosteller is widely used in clinical practice because it is simple and performs well across a broad range of body sizes.</p>
            </div>

            <div class="space-y-1">
              <p class="font-semibold mb-1">4. Lean BSA based on LBM</p>
              <p>To approximate the body surface area of lean mass only, the calculator first computes LBM (Boer or Hume) and then applies the same Mosteller structure using lean weight:</p>
              <p>BSA_lean (m²) = √{ [Height (cm) × LBM (kg)] ÷ 3600 }.</p>
              <p>This “lean BSA” is not a directly measured parameter, but a derived index that helps visualize how much of the patient’s large BSA is due to fat mass versus lean tissue.</p>
            </div>

            <div class="space-y-1">
              <p class="font-semibold mb-1">5. Flow comparison table (CI 1.0–3.0)</p>
              <p>The flow table shows how perfusion flow requirements change when indexed to actual BSA and lean BSA.</p>
              <p>Flow_actual (l/min) = CI × BSA_actual</p>
              <p>Flow_lean (l/min) = CI × BSA_lean</p>
              <p>This allows quick comparison such as “At CI 2.4 l/min/m², how much flow do I deliver if I index to full BSA?” and “If I index to lean BSA instead, how much lower would the flow be for the same CI?”</p>
              <p>In markedly obese patients, BSA_actual may suggest very high flows that exceed what is needed for metabolically active tissue, while BSA_lean can illustrate a more physiologic lower bound. Final flow selection must still consider SvO₂, lactate, arterial pressure, and institutional protocols.</p>
            </div>

            <div class="space-y-1">
              <p class="font-semibold mb-1">6. Intended use and limitations</p>
              <p>These formulas are validated for adults; they are not intended for pediatric patients. LBM and lean BSA are estimates, not direct measurements. Fluid shifts, edema, sarcopenia and extreme body habitus can all reduce accuracy.</p>
              <p>The flow comparison table is a decision-support aid, not a prescription. Perfusion strategy should always be guided by real-time clinical monitoring and local guidelines.</p>
              <p class="text-slate-500 dark:text-slate-500">For educational use only. Not medical advice or a regulated medical device.</p>
            </div>
          </div>
        </details>
      </section>

      <section id="view-timecalc" class="hidden animate-in fade-in duration-300">
        <div class="rounded-2xl bg-white/95 dark:bg-slate-900/80 shadow-card border border-slate-200/80 dark:border-slate-800 p-6">
          <h2 class="text-xl font-semibold tracking-tight mb-2">Time Calculator</h2>
          <p class="text-xs text-slate-500 dark:text-slate-400 mb-1">Enter 24-hour start/end times to see elapsed minutes and an H:MM readout.</p>
          <p class="text-xs text-slate-500 dark:text-slate-400 mb-4">Tap the clock icon to insert the current time.</p>

          <div class="space-y-4" id="time-rows">
            <div class="time-row rounded-2xl border border-slate-100 dark:border-primary-800/60 bg-white/70 dark:bg-primary-900/40 p-3 space-y-3">
              <div class="flex items-center gap-2">
                <div class="text-[11px] text-slate-500 dark:text-slate-400">#1</div>
                <input id="time-label-1" type="text" inputmode="text" placeholder="Label" class="w-full rounded-xl border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 px-3 py-1.5 text-xs focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none" />
              </div>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <div class="flex flex-col gap-1">
                  <span class="text-[11px] text-slate-500 dark:text-slate-400">Start time</span>
                  <div class="flex items-center gap-2">
                    <input id="time-start-1" type="text" inputmode="numeric" placeholder="hh:mm" class="w-full rounded-xl border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 px-3 py-2 text-sm focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none" />
                    <button id="time-start-now-1" type="button" class="p-2 rounded-lg border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 hover:bg-slate-100 dark:hover:bg-primary-700 text-slate-600 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-accent-500">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l2.5 2.5M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="flex flex-col gap-1">
                  <span class="text-[11px] text-slate-500 dark:text-slate-400">End time</span>
                  <div class="flex items-center gap-2">
                    <input id="time-end-1" type="text" inputmode="numeric" placeholder="hh:mm" class="w-full rounded-xl border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 px-3 py-2 text-sm focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none" />
                    <button id="time-end-now-1" type="button" class="p-2 rounded-lg border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 hover:bg-slate-100 dark:hover:bg-primary-700 text-slate-600 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-accent-500">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l2.5 2.5M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="flex flex-col gap-1">
                  <span class="text-[11px] text-slate-500 dark:text-slate-400">Duration</span>
                  <div id="time-result-1" class="rounded-xl border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 px-3 py-2 text-sm text-slate-700 dark:text-slate-200">-</div>
                </div>
              </div>
            </div>

            <div class="time-row rounded-2xl border border-slate-100 dark:border-primary-800/60 bg-white/70 dark:bg-primary-900/40 p-3 space-y-3">
              <div class="flex items-center gap-2">
                <div class="text-[11px] text-slate-500 dark:text-slate-400">#2</div>
                <input id="time-label-2" type="text" inputmode="text" placeholder="Label" class="w-full rounded-xl border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 px-3 py-1.5 text-xs focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none" />
              </div>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <div class="flex flex-col gap-1">
                  <span class="text-[11px] text-slate-500 dark:text-slate-400">Start time</span>
                  <div class="flex items-center gap-2">
                    <input id="time-start-2" type="text" inputmode="numeric" placeholder="hh:mm" class="w-full rounded-xl border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 px-3 py-2 text-sm focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none" />
                    <button id="time-start-now-2" type="button" class="p-2 rounded-lg border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 hover:bg-slate-100 dark:hover:bg-primary-700 text-slate-600 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-accent-500">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l2.5 2.5M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="flex flex-col gap-1">
                  <span class="text-[11px] text-slate-500 dark:text-slate-400">End time</span>
                  <div class="flex items-center gap-2">
                    <input id="time-end-2" type="text" inputmode="numeric" placeholder="hh:mm" class="w-full rounded-xl border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 px-3 py-2 text-sm focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none" />
                    <button id="time-end-now-2" type="button" class="p-2 rounded-lg border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 hover:bg-slate-100 dark:hover:bg-primary-700 text-slate-600 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-accent-500">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l2.5 2.5M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="flex flex-col gap-1">
                  <span class="text-[11px] text-slate-500 dark:text-slate-400">Duration</span>
                  <div id="time-result-2" class="rounded-xl border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 px-3 py-2 text-sm text-slate-700 dark:text-slate-200">-</div>
                </div>
              </div>
            </div>

            <div class="time-row rounded-2xl border border-slate-100 dark:border-primary-800/60 bg-white/70 dark:bg-primary-900/40 p-3 space-y-3">
              <div class="flex items-center gap-2">
                <div class="text-[11px] text-slate-500 dark:text-slate-400">#3</div>
                <input id="time-label-3" type="text" inputmode="text" placeholder="Label" class="w-full rounded-xl border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 px-3 py-1.5 text-xs focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none" />
              </div>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <div class="flex flex-col gap-1">
                  <span class="text-[11px] text-slate-500 dark:text-slate-400">Start time</span>
                  <div class="flex items-center gap-2">
                    <input id="time-start-3" type="text" inputmode="numeric" placeholder="hh:mm" class="w-full rounded-xl border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 px-3 py-2 text-sm focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none" />
                    <button id="time-start-now-3" type="button" class="p-2 rounded-lg border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 hover:bg-slate-100 dark:hover:bg-primary-700 text-slate-600 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-accent-500">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l2.5 2.5M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="flex flex-col gap-1">
                  <span class="text-[11px] text-slate-500 dark:text-slate-400">End time</span>
                  <div class="flex items-center gap-2">
                    <input id="time-end-3" type="text" inputmode="numeric" placeholder="hh:mm" class="w-full rounded-xl border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 px-3 py-2 text-sm focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none" />
                    <button id="time-end-now-3" type="button" class="p-2 rounded-lg border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 hover:bg-slate-100 dark:hover:bg-primary-700 text-slate-600 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-accent-500">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l2.5 2.5M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="flex flex-col gap-1">
                  <span class="text-[11px] text-slate-500 dark:text-slate-400">Duration</span>
                  <div id="time-result-3" class="rounded-xl border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 px-3 py-2 text-sm text-slate-700 dark:text-slate-200">-</div>
                </div>
              </div>
            </div>

            <div class="time-row rounded-2xl border border-slate-100 dark:border-primary-800/60 bg-white/70 dark:bg-primary-900/40 p-3 space-y-3">
              <div class="flex items-center gap-2">
                <div class="text-[11px] text-slate-500 dark:text-slate-400">#4</div>
                <input id="time-label-4" type="text" inputmode="text" placeholder="Label" class="w-full rounded-xl border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 px-3 py-1.5 text-xs focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none" />
              </div>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <div class="flex flex-col gap-1">
                  <span class="text-[11px] text-slate-500 dark:text-slate-400">Start time</span>
                  <div class="flex items-center gap-2">
                    <input id="time-start-4" type="text" inputmode="numeric" placeholder="hh:mm" class="w-full rounded-xl border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 px-3 py-2 text-sm focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none" />
                    <button id="time-start-now-4" type="button" class="p-2 rounded-lg border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 hover:bg-slate-100 dark:hover:bg-primary-700 text-slate-600 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-accent-500">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l2.5 2.5M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="flex flex-col gap-1">
                  <span class="text-[11px] text-slate-500 dark:text-slate-400">End time</span>
                  <div class="flex items-center gap-2">
                    <input id="time-end-4" type="text" inputmode="numeric" placeholder="hh:mm" class="w-full rounded-xl border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 px-3 py-2 text-sm focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none" />
                    <button id="time-end-now-4" type="button" class="p-2 rounded-lg border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 hover:bg-slate-100 dark:hover:bg-primary-700 text-slate-600 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-accent-500">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l2.5 2.5M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="flex flex-col gap-1">
                  <span class="text-[11px] text-slate-500 dark:text-slate-400">Duration</span>
                  <div id="time-result-4" class="rounded-xl border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 px-3 py-2 text-sm text-slate-700 dark:text-slate-200">-</div>
                </div>
              </div>
            </div>

            <div class="time-row rounded-2xl border border-slate-100 dark:border-primary-800/60 bg-white/70 dark:bg-primary-900/40 p-3 space-y-3">
              <div class="flex items-center gap-2">
                <div class="text-[11px] text-slate-500 dark:text-slate-400">#5</div>
                <input id="time-label-5" type="text" inputmode="text" placeholder="Label" class="w-full rounded-xl border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 px-3 py-1.5 text-xs focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none" />
              </div>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <div class="flex flex-col gap-1">
                  <span class="text-[11px] text-slate-500 dark:text-slate-400">Start time</span>
                  <div class="flex items-center gap-2">
                    <input id="time-start-5" type="text" inputmode="numeric" placeholder="hh:mm" class="w-full rounded-xl border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 px-3 py-2 text-sm focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none" />
                    <button id="time-start-now-5" type="button" class="p-2 rounded-lg border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 hover:bg-slate-100 dark:hover:bg-primary-700 text-slate-600 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-accent-500">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l2.5 2.5M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="flex flex-col gap-1">
                  <span class="text-[11px] text-slate-500 dark:text-slate-400">End time</span>
                  <div class="flex items-center gap-2">
                    <input id="time-end-5" type="text" inputmode="numeric" placeholder="hh:mm" class="w-full rounded-xl border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 px-3 py-2 text-sm focus:ring-2 focus:ring-accent-500 focus:border-accent-500 outline-none" />
                    <button id="time-end-now-5" type="button" class="p-2 rounded-lg border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 hover:bg-slate-100 dark:hover:bg-primary-700 text-slate-600 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-accent-500">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l2.5 2.5M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="flex flex-col gap-1">
                  <span class="text-[11px] text-slate-500 dark:text-slate-400">Duration</span>
                  <div id="time-result-5" class="rounded-xl border border-slate-200 dark:border-primary-700 bg-slate-50 dark:bg-primary-800 px-3 py-2 text-sm text-slate-700 dark:text-slate-200">-</div>
                </div>
              </div>
            </div>
          </div>

          <details class="mt-4 group">
            <summary class="cursor-pointer text-xs font-semibold text-slate-500 dark:text-slate-400 hover:text-accent-500 transition-colors list-none flex items-center gap-2">
              <span class="transform transition-transform group-open:rotate-90">▶</span> Methodology
            </summary>
            <div class="mt-2 p-4 rounded-xl bg-white dark:bg-primary-900 border border-slate-100 dark:border-primary-800 text-xs text-slate-600 dark:text-slate-400 leading-relaxed shadow-sm space-y-3">
              <div class="space-y-1">
                <p class="font-semibold mb-1">1. Purpose</p>
                <p>This time calculator is designed to quickly estimate elapsed time in minutes and H:MM format between two clock times. It is intended for tasks such as documenting CPB time, cross-clamp time, cardioplegia intervals, ECMO procedure time blocks, or other peri-operative events where only start and end times are known.</p>
              </div>

              <div class="space-y-1">
                <p class="font-semibold mb-1">2. Input format</p>
                <p>Times are entered in 24-hour format as HH:MM.</p>
                <p>Valid range: 00:00–23:59.</p>
                <p>Examples: 07:15, 13:40, 21:05.</p>
                <p>The fields accept four digits; after four digits are typed (e.g., 1345), the value is auto-formatted to 13:45.</p>
                <p class="text-slate-500 dark:text-slate-500">Each row is independent and can be labelled (e.g., “CPB on–off”, “Cross-clamp”, “Circulatory arrest”).</p>
              </div>

              <div class="space-y-1">
                <p class="font-semibold mb-1">3. Core calculation</p>
                <p>For each row:</p>
                <p>Convert start and end times to total minutes from midnight:</p>
                <p class="font-mono text-[11px]">totalMinutes = 60 × HH + MM</p>
                <p>If the end time is later or equal to the start time (same day):</p>
                <p class="font-mono text-[11px]">durationMinutes = endMinutes − startMinutes</p>
                <p><strong>If the end time is earlier than the start time, the tool assumes the interval crosses midnight and adds 24 hours:</strong></p>
                <p class="font-mono text-[11px]">durationMinutes = (endMinutes + 24 × 60) − startMinutes</p>
                <p>The result is reported as:</p>
                <ul class="list-disc pl-4 space-y-1">
                  <li>Minutes (integer), and</li>
                  <li>H:MM format, obtained by: <span class="font-mono text-[11px]">hours = floor(durationMinutes ÷ 60)</span> and <span class="font-mono text-[11px]">minutes = durationMinutes mod 60</span>, displayed as H:MM with a leading zero for minutes (e.g., 3:05).</li>
                </ul>
              </div>

              <div class="space-y-1">
                <p class="font-semibold mb-1">4. Validation and rounding</p>
                <p>Inputs outside 00:00–23:59 are rejected.</p>
                <p>Seconds are not supported; any sub-minute timing should be rounded to the nearest minute before entry.</p>
                <p>All durations are exact in minutes; no additional rounding is applied.</p>
              </div>

              <div class="space-y-1">
                <p class="font-semibold mb-1">5. Clinical use &amp; limitations</p>
                <p>Useful for: CPB pump time, cross-clamp time, circulatory arrest time; cardioplegia dosing intervals or ECMO procedure segments; operating room or ICU workflow time stamps.</p>
                <p>The calculator does not store dates and cannot distinguish different calendar days; any interval longer than 24 hours must be split manually.</p>
                <p class="text-slate-500 dark:text-slate-500">Results are for documentation and workflow support only and do not replace clinical records, perfusion charts, or institutional time-keeping systems. For educational use only. Not medical advice or a regulated medical device.</p>
              </div>
            </div>
          </details>
        </div>
      </section>

      <section id="view-heparin" class="hidden animate-in fade-in duration-300">
        <div class="bg-white dark:bg-primary-900 rounded-2xl shadow-card border border-slate-200 dark:border-primary-800 overflow-hidden">
          <div class="p-6 space-y-6">
            <div class="space-y-2">
              <h2 class="text-xl font-bold text-primary-900 dark:text-white">Heparin Management (CPB)</h2>
              <p class="text-sm text-slate-600 dark:text-slate-300">Calculate an initial loading dose with weight strategy safeguards and optional flow targets; toggle resistance cues when ACT response is low.</p>
            </div>

            <div class="space-y-6">
              <div class="space-y-4">
                <div class="bg-slate-50 dark:bg-primary-900/50 border border-slate-200 dark:border-primary-800 rounded-2xl p-4 space-y-4">
                  <div class="flex items-center justify-between">
                    <h3 class="text-sm font-semibold text-primary-900 dark:text-white">Patient parameters</h3>
                    <span class="text-xs text-slate-500 dark:text-slate-400">Adult CPB</span>
                  </div>
                  <div class="grid grid-cols-2 gap-3">
                    <div>
                      <label class="text-xs text-slate-500 dark:text-slate-400 block mb-1">Height (cm)</label>
                      <input id="hep2-height" type="number" min="0" step="0.1" class="w-full rounded-lg border border-slate-200 dark:border-primary-700 bg-white dark:bg-primary-800 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-accent-500" placeholder="170" />
                      <p id="hep2-height-error" class="text-xs text-red-500 mt-1 hidden">Height should be 50–250 cm</p>
                    </div>
                    <div>
                      <label class="text-xs text-slate-500 dark:text-slate-400 block mb-1">Weight (kg)</label>
                      <input id="hep2-weight" type="number" min="0" step="0.1" class="w-full rounded-lg border border-slate-200 dark:border-primary-700 bg-white dark:bg-primary-800 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-accent-500" placeholder="70" />
                      <p id="hep2-weight-error" class="text-xs text-red-500 mt-1 hidden">Weight should be 20–300 kg</p>
                    </div>
                  </div>

                  <div class="grid grid-cols-2 gap-3">
                    <div>
                      <label class="text-xs text-slate-500 dark:text-slate-400 block mb-1">Sex</label>
                      <select id="hep2-sex" class="w-full rounded-lg border border-slate-200 dark:border-primary-700 bg-white dark:bg-primary-800 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-accent-500">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                      </select>
                    </div>
                    <div class="text-xs text-slate-500 dark:text-slate-400 flex items-center">ACT monitoring per protocol</div>
                  </div>

                  <div>
                    <div class="flex items-center gap-2 mb-1">
                      <label class="text-xs text-slate-500 dark:text-slate-400">Weight strategy</label>
                      <button id="hep2-weight-info-toggle" type="button" class="text-[11px] text-accent-600 dark:text-accent-400 underline-offset-2 hover:underline">ⓘ</button>
                    </div>
                    <select id="hep2-weight-strategy" class="w-full rounded-lg border border-slate-200 dark:border-primary-700 bg-white dark:bg-primary-800 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-accent-500">
                      <option value="auto">Auto-detect (Recommended)</option>
                      <option value="tbw">Total body weight (TBW)</option>
                      <option value="abw">Adjusted body weight (ABW)</option>
                      <option value="ibw">Ideal body weight (IBW)</option>
                    </select>
                    <p class="text-[11px] text-slate-500 dark:text-slate-400 mt-1">Auto switches to ABW when BMI ≥ 30 to reduce overdose risk.</p>
                    <p class="text-[11px] text-slate-500 dark:text-slate-400">Auto logic: BMI &lt; 30 → TBW; BMI 30–39 → ABW (0.4 correction); BMI ≥ 40 → ABW (0.3) with obesity safety cues.</p>
                    <div id="hep2-weight-info" class="hidden mt-2 text-[11px] text-slate-600 dark:text-slate-300 leading-relaxed bg-slate-100 dark:bg-primary-800/60 border border-slate-200 dark:border-primary-700 rounded-xl p-3 space-y-1">
                      <p><strong class="text-primary-900 dark:text-white">Devine IBW:</strong> Male = 50 + 0.91 × (cm − 152.4), Female = 45.5 + 0.91 × (cm − 152.4).</p>
                      <p><strong class="text-primary-900 dark:text-white">ABW 0.4 / 0.3 rules:</strong> ABW = IBW + factor × (TBW − IBW); factor 0.4 when BMI 30–39, factor 0.3 when BMI ≥ 40.</p>
                      <p><strong class="text-primary-900 dark:text-white">Safety cap:</strong> Obesity flows/doses use IBW/ABW and may cap BSA to avoid extreme UFH and hemodilution.</p>
                    </div>
                  </div>

                  <div class="space-y-2">
                    <p class="text-xs text-slate-500 dark:text-slate-400">Initial dose (u/kg)</p>
                    <div class="grid grid-cols-4 gap-2" id="hep2-dose-buttons">
                      <button type="button" data-hep-dose="250" class="hep-dose-btn">250</button>
                      <button type="button" data-hep-dose="300" class="hep-dose-btn active-dose">300</button>
                      <button type="button" data-hep-dose="350" class="hep-dose-btn">350</button>
                      <button type="button" data-hep-dose="400" class="hep-dose-btn">400</button>
                    </div>
                  </div>

                  <div class="bg-slate-50 dark:bg-primary-900/50 border border-slate-200 dark:border-primary-800 rounded-xl">
                    <button id="hep2-resistance-toggle" type="button" class="w-full flex items-center justify-between gap-3 px-4 py-3 text-left">
                      <div>
                        <p class="text-sm font-semibold text-primary-900 dark:text-white">Suspect heparin resistance?</p>
                        <p class="text-[11px] text-slate-600 dark:text-slate-300">Reference checklist when ACT response is lower than expected.</p>
                      </div>
                      <svg data-chevron class="h-4 w-4 text-slate-500 transition-transform" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M6 9l6 6 6-6" />
                      </svg>
                    </button>
                    <div id="hep2-resistance-content" class="hidden border-t border-slate-200 dark:border-primary-800 px-4 py-4 space-y-4">
                      <div class="space-y-2">
                        <p class="text-xs font-semibold text-primary-900 dark:text-white">Risk factors (check all)</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-slate-700 dark:text-slate-200">
                          <label class="flex items-start gap-2">
                            <input id="hep2-rf-sirs" type="checkbox" class="mt-1 rounded border-slate-300 text-accent-500 focus:ring-accent-500" />
                            <span>Ongoing sepsis / SIRS</span>
                          </label>
                          <label class="flex items-start gap-2">
                            <input id="hep2-rf-lmwh" type="checkbox" class="mt-1 rounded border-slate-300 text-accent-500 focus:ring-accent-500" />
                            <span>Recent LMWH within 12–24 h</span>
                          </label>
                          <label class="flex items-start gap-2">
                            <input id="hep2-rf-ecmo" type="checkbox" class="mt-1 rounded border-slate-300 text-accent-500 focus:ring-accent-500" />
                            <span>Prolonged pre-CPB ECMO / VAD</span>
                          </label>
                          <label class="flex items-start gap-2">
                            <input id="hep2-rf-at3" type="checkbox" class="mt-1 rounded border-slate-300 text-accent-500 focus:ring-accent-500" />
                            <span>Known AT-III deficiency / cirrhosis</span>
                          </label>
                          <label class="flex items-start gap-2">
                            <input id="hep2-rf-history" type="checkbox" class="mt-1 rounded border-slate-300 text-accent-500 focus:ring-accent-500" />
                            <span>Prior high-dose heparin requirement</span>
                          </label>
                        </div>
                        <p class="text-[11px] text-slate-500 dark:text-slate-400">Selecting risk factors does not automatically change dosing. (Reference only)</p>
                      </div>
                      <div class="space-y-2">
                        <p class="text-xs font-semibold text-primary-900 dark:text-white">Next steps (reference)</p>
                        <ul class="list-disc list-inside text-sm text-slate-700 dark:text-slate-200 space-y-1">
                          <li>Rule out basics: confirm heparin delivery, sampling/ACT device issues, temperature/hemodilution.</li>
                          <li>Recheck ACT at 3–5 min; if below target, consider additional UFH per local protocol.</li>
                          <li>If inadequate response persists, consider checking AT activity and/or anti-Xa (or heparin concentration) and prepare AT supplementation (FFP if AT concentrate not available) per protocol.</li>
                          <li>Special situations (e.g., HIT) → follow institutional DTI protocol.</li>
                        </ul>
                      </div>
                    </div>
                  </div>

                </div>
              </div>

              <div class="space-y-4">
                <div id="hep2-placeholder" class="h-full flex flex-col items-center justify-center text-slate-500 dark:text-slate-400 border-2 border-dashed border-slate-200 dark:border-primary-800 rounded-2xl min-h-[360px]">
                  <p class="text-lg font-semibold">Enter patient parameters to calculate</p>
                  <p class="text-sm">Height, weight, and dose are required.</p>
                </div>

                <div id="hep2-results" class="space-y-4 hidden">
                  <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="stat-card">
                      <p class="stat-label">BMI</p>
                      <p id="hep2-bmi" class="stat-value">-</p>
                    </div>
                    <div class="stat-card">
                      <p class="stat-label">IBW (Devine)</p>
                      <p class="stat-value"><span id="hep2-ibw">-</span> <span class="stat-unit">kg</span></p>
                      <p class="text-[11px] text-slate-500 dark:text-slate-400">Devine formula</p>
                    </div>
                    <div class="stat-card relative">
                      <p class="stat-label">BSA (Mosteller)</p>
                      <p class="stat-value text-accent-500"><span id="hep2-bsa">-</span> <span class="stat-unit">m²</span></p>
                      <span id="hep2-bsa-cap" class="badge hidden">Capped for Safety (Obesity)</span>
                    </div>
                    <div class="stat-card highlight">
                      <p class="stat-label">Dosing weight</p>
                      <p class="stat-value"><span id="hep2-dosing-weight">-</span> <span class="stat-unit">kg</span></p>
                      <p id="hep2-dosing-note" class="text-[11px] text-slate-500 dark:text-slate-400 truncate"></p>
                    </div>
                  </div>

                  <div id="hep2-weight-breakdown" class="hidden text-xs text-slate-600 dark:text-slate-300 bg-slate-50 dark:bg-primary-900/50 border border-slate-200 dark:border-primary-800 rounded-xl p-3 leading-relaxed"></div>

                  <div id="hep2-peds-warning" class="hidden info-block warn">
                    <h4 class="text-sm font-semibold text-red-500 mb-1">Pediatric safety notice</h4>
                    <p class="text-sm text-red-200/80">This calculator is validated for adult CPB only. For patients &lt; 20 kg or height &lt; 120 cm, follow institutional pediatric protocols.</p>
                  </div>

                  <div id="hep2-extreme-obesity" class="hidden info-block alert">
                    <h4 class="text-sm font-semibold text-orange-500 mb-1">Extreme obesity safety notice</h4>
                    <p class="text-sm text-orange-200/80">BMI ≥ 50 kg/m². Dosing weight uses ABW (0.3) to avoid extreme UFH doses. Consider Anti-Xa or heparin concentration monitoring rather than ACT alone.</p>
                  </div>

                  <div class="space-y-4">
                    <div class="protocol-card">
                      <div class="flex items-start mb-4">
                        <div>
                          <p class="text-xs text-slate-500 dark:text-slate-400">Initial bolus</p>
                          <p id="hep2-initial-bolus" class="text-4xl font-mono font-bold text-primary-900 dark:text-white">-</p>
                          <div id="hep2-high-dose" class="pill pill-warn hidden">High dose &gt; 40k U</div>
                        </div>
                      </div>
                      <div id="hep2-diff-note" class="text-xs text-amber-600 dark:text-amber-300 bg-amber-500/10 rounded px-2 py-1 mb-3 hidden"></div>
                      <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                          <span class="text-slate-600 dark:text-slate-400">Additional bolus</span>
                          <span id="hep2-add-bolus" class="font-mono text-primary-900 dark:text-white">-</span>
                        </div>
                      </div>

                      <div id="hep2-sensitivity" class="mt-3 bg-white dark:bg-primary-900 border border-slate-200 dark:border-primary-800 rounded-lg p-3 text-xs text-slate-700 dark:text-slate-200 space-y-2">
                        <p class="font-semibold text-primary-900 dark:text-white">Sensitivity (weight strategy vs dose @300 u/kg)</p>
                        <div class="grid grid-cols-3 text-[11px] font-semibold text-slate-500 dark:text-slate-400">
                          <span>Strategy</span><span>Weight</span><span>Dose / Δ</span>
                        </div>
                        <div class="grid grid-cols-3 text-sm">
                          <span>TBW</span><span id="hep2-sens-tbw-wt">-</span><span id="hep2-sens-tbw-dose">-</span>
                        </div>
                        <div class="grid grid-cols-3 text-sm">
                          <span>ABW (0.4)</span><span id="hep2-sens-abw-wt">-</span><span id="hep2-sens-abw-dose">-</span>
                        </div>
                        <div class="grid grid-cols-3 text-sm">
                          <span>IBW</span><span id="hep2-sens-ibw-wt">-</span><span id="hep2-sens-ibw-dose">-</span>
                        </div>
                        <p class="text-[11px] text-amber-600 dark:text-amber-300">In severe obesity, TBW-based dosing can exceed 40,000 U; reassess dosing when values climb this high.</p>
                      </div>
                    </div>

                    <div id="hep2-quick-card" class="flow-card">
                    <p class="text-sm font-semibold text-green-600 dark:text-green-300 mb-2">Quick protocol</p>
                    <ol class="list-decimal list-inside space-y-1 text-sm text-primary-900 dark:text-slate-200" id="hep2-quick-steps">
                      <li>Bolus -</li>
                        <li>Wait 3–5 min → Check ACT</li>
                        <li>Monitor ACT q30min during CPB</li>
                        <li>If ACT low: + bolus</li>
                      </ol>
                    </div>
                  </div>

                  <div id="hep2-obesity-warning" class="info-block alert hidden">
                    <h4 class="text-sm font-semibold text-orange-500 mb-1">Morbid obesity management</h4>
                    <p class="text-sm text-orange-200/80">Using ABW with 0.3 correction to prevent overdose. Flow capped to reduce hemodilution; monitor SvO₂ and lactate closely.</p>
                  </div>

                  <div class="bg-slate-50 dark:bg-primary-900/40 border border-slate-200 dark:border-primary-800 rounded-2xl p-4 space-y-2">
                    <div class="flex items-start gap-2">
                      <div class="mt-1 h-2 w-2 rounded-full bg-accent-500"></div>
                      <div>
                        <p class="text-sm font-semibold text-primary-900 dark:text-white">Clinical pearls</p>
                        <ul class="list-disc list-inside text-sm text-slate-600 dark:text-slate-300 space-y-1 mt-1">
                          <li>ACT affected by hemodilution, hypothermia, platelet function — consider Anti-Xa in obesity.</li>
                          <li>Fat has limited heparin distribution; TBW dosing in BMI ≥ 35 raises bleeding risk without better anticoagulation.</li>
                          <li>Over 40k U total → reassess. May indicate resistance rather than inadequate bolus.</li>
                        </ul>
                      </div>
                    </div>
                  </div>

                  <div class="bg-white dark:bg-primary-900 border border-slate-200 dark:border-primary-800 rounded-2xl p-4 text-sm text-slate-700 dark:text-slate-200 space-y-2">
                    <p class="text-sm font-semibold text-primary-900 dark:text-white">Guideline anchors (summary)</p>
                    <ul class="list-disc list-inside space-y-1">
                      <li>STS/SCA/AmSECT 2018: Initial bolus 300–400 u/kg with ACT ≥ 400–480 s; consider heparin concentration / Anti-Xa monitoring.</li>
                      <li>2021 update: Early AT-III concentrate in AT-III–mediated resistance to reduce FFP use.</li>
                      <li>2018–2024 obesity/IBW data: IBW/ABW heparin regimens reduce overdose risk without compromising anticoagulation.</li>
                      <li>2025 EACTS/EACTA/EBCP updates: Emphasize Anti-Xa and individualized dosing, especially in obesity/resistance.</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="view-priming-volume" class="hidden animate-in fade-in duration-300">
        <div class="bg-white dark:bg-primary-900 rounded-2xl shadow-card border border-slate-200 dark:border-primary-800 p-6 space-y-6">
          <div class="space-y-2">
            <h2 class="text-xl font-semibold tracking-tight">Priming Volume Calculator (Tube ID)</h2>
            <p class="text-sm text-slate-600 dark:text-slate-300">Select a standard tubing ID and length to calculate priming volume. ID is the inner diameter (wall thickness not included).</p>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="space-y-2">
              <label for="priming-id" class="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400">Tube ID</label>
              <select id="priming-id" class="w-full bg-white dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-3 py-2.5 text-sm focus:ring-2 focus:ring-accent-500 outline-none dark:text-white cursor-pointer">
                <option value="">Select ID</option>
                <option value="1/2">1/2"</option>
                <option value="3/8">3/8"</option>
                <option value="1/4">1/4"</option>
                <option value="3/16">3/16"</option>
                <option value="3/32">3/32"</option>
                <option value="1/16">1/16"</option>
              </select>
              <div class="rounded-xl border border-slate-100 dark:border-primary-800 bg-slate-50 dark:bg-primary-800/60 p-3 text-xs text-slate-600 dark:text-slate-300 space-y-1">
                <div class="flex justify-between">
                  <span>ID (mm)</span>
                  <span id="priming-id-mm" class="font-semibold text-primary-900 dark:text-white">—</span>
                </div>
                <div class="flex justify-between">
                  <span>mL/m</span>
                  <span id="priming-ml-per-m" class="font-semibold text-primary-900 dark:text-white">—</span>
                </div>
                <div class="flex justify-between">
                  <span>mL/cm</span>
                  <span id="priming-ml-per-cm" class="font-semibold text-primary-900 dark:text-white">—</span>
                </div>
              </div>
            </div>

            <div class="space-y-2">
              <label for="priming-length" class="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400">Length</label>
              <div class="grid grid-cols-1 sm:grid-cols-[1fr_auto] gap-2">
                <input id="priming-length" type="number" min="0" step="0.01" placeholder="Enter length" class="w-full bg-white dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-4 py-2.5 text-sm focus:ring-2 focus:ring-accent-500 outline-none dark:text-white" />
                <select id="priming-length-unit" class="w-full sm:w-28 bg-white dark:bg-primary-800 border border-slate-200 dark:border-primary-700 rounded-xl px-3 py-2.5 text-sm focus:ring-2 focus:ring-accent-500 outline-none dark:text-white cursor-pointer">
                  <option value="cm">cm</option>
                  <option value="m" selected>m</option>
                  <option value="ft">ft</option>
                  <option value="in">in</option>
                </select>
              </div>
              <p id="priming-length-error" class="text-xs text-red-500 hidden">Length must be 0 or greater.</p>
              <p class="text-xs text-slate-500 dark:text-slate-400">Length (m): <span id="priming-length-m" class="font-semibold text-slate-700 dark:text-slate-200">—</span></p>
            </div>
          </div>

          <div class="rounded-2xl border border-slate-200 dark:border-primary-800 bg-slate-50 dark:bg-primary-800/50 p-4 text-center space-y-1">
            <div class="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400">Priming Volume</div>
            <div id="priming-volume" class="text-3xl md:text-4xl font-bold text-accent-500">—</div>
            <div class="text-xs text-slate-500 dark:text-slate-400">mL</div>
          </div>

          <div class="text-xs text-slate-500 dark:text-slate-400 space-y-1">
            <p class="font-semibold text-slate-600 dark:text-slate-300">Formula</p>
            <p>V(mL) = (π/4) × ID(mm)<sup>2</sup> × Length(m)</p>
          </div>
        </div>

        <details class="mt-4 group">
          <summary class="cursor-pointer text-xs font-semibold text-slate-500 dark:text-slate-400 hover:text-accent-500 transition-colors list-none flex items-center gap-2">
            <span class="transform transition-transform group-open:rotate-90">▶</span> Methodology
          </summary>
          <div class="mt-2 p-4 rounded-xl bg-white dark:bg-primary-900 border border-slate-100 dark:border-primary-800 text-xs text-slate-600 dark:text-slate-400 leading-relaxed shadow-sm space-y-3">
            <ol class="list-decimal pl-4 space-y-3">
              <li>
                <p class="font-semibold text-slate-700 dark:text-slate-200">Purpose</p>
                <p>This calculator estimates priming volume (internal fluid volume) of perfusion tubing based on tubing inner diameter (ID) and tubing length. It is intended for quick circuit planning and documentation when you need an approximate volume contribution from tubing segments.</p>
              </li>
              <li>
                <p class="font-semibold text-slate-700 dark:text-slate-200">Input format</p>
                <p class="font-semibold text-slate-600 dark:text-slate-300 mt-1">2.1 Tube ID selection (standard perfusion tubing)</p>
                <p>Select one of the common tubing inner diameter (ID) sizes from the dropdown:</p>
                <ul class="list-disc pl-4 space-y-1 mt-1">
                  <li>1/16" (ID 1.5875 mm)</li>
                  <li>3/32" (ID 2.38125 mm)</li>
                  <li>3/16" (ID 4.7625 mm)</li>
                  <li>1/4" (ID 6.35 mm)</li>
                  <li>3/8" (ID 9.525 mm)</li>
                  <li>1/2" (ID 12.7 mm)</li>
                </ul>
                <p class="mt-1">The calculator displays ID in mm and reference volumes (mL/m, mL/cm).</p>
                <p class="font-semibold text-slate-600 dark:text-slate-300 mt-2">2.2 Length entry</p>
                <p>Enter tubing length as a numeric value (decimals allowed) and choose a unit: cm / m / ft / in.</p>
              </li>
              <li>
                <p class="font-semibold text-slate-700 dark:text-slate-200">Core calculation</p>
                <p class="font-semibold text-slate-600 dark:text-slate-300 mt-1">3.1 Unit conversion</p>
                <ul class="list-disc pl-4 space-y-1">
                  <li>cm → m: L(m) = L(cm) / 100</li>
                  <li>m → m: L(m) = L(m)</li>
                  <li>in → m: L(m) = L(in) × 0.0254</li>
                  <li>ft → m: L(m) = L(ft) × 0.3048</li>
                </ul>
                <p class="font-semibold text-slate-600 dark:text-slate-300 mt-2">3.2 Tube internal volume (cylinder model)</p>
                <p>Assuming uniform cylinder geometry with inner diameter ID(mm):</p>
                <p>V(mL) = (π/4) × [ID(mm)]<sup>2</sup> × L(m)</p>
                <p class="mt-1">This works directly in mL because 1 mm³ = 0.001 mL, and the formula is arranged to use ID in mm and length in m.</p>
                <p class="font-semibold text-slate-600 dark:text-slate-300 mt-2">3.3 Reference values shown to the user</p>
                <ul class="list-disc pl-4 space-y-1">
                  <li>mL/m = (π/4) × [ID(mm)]<sup>2</sup></li>
                  <li>mL/cm = (mL/m) / 100</li>
                </ul>
              </li>
              <li>
                <p class="font-semibold text-slate-700 dark:text-slate-200">Validation and rounding</p>
                <ul class="list-disc pl-4 space-y-1">
                  <li>Length must be 0 or greater.</li>
                  <li>If length is blank or invalid, the result is not calculated.</li>
                  <li>Results are displayed in mL and rounded for readability (e.g., 0.1 mL).</li>
                  <li>This tool calculates geometric internal volume only; no clinical correction factors are applied.</li>
                </ul>
              </li>
              <li>
                <p class="font-semibold text-slate-700 dark:text-slate-200">Clinical use &amp; limitations</p>
                <ul class="list-disc pl-4 space-y-1">
                  <li>Internal volume depends on inner diameter and length.</li>
                  <li>Wall thickness does not change internal volume if the ID is already known (wall thickness matters only if deriving ID from an outer diameter spec).</li>
                  <li>Real-world priming volume can differ due to manufacturing tolerances and additional circuit components (connectors, stopcocks, reservoirs/filters/oxygenator volumes), partial collapse/kinks, and measurement conditions.</li>
                </ul>
                <p class="mt-1">This calculator is for workflow support and estimation only and does not replace institutional perfusion records, manufacturer specifications, or regulated medical device calculations.</p>
              </li>
            </ol>
          </div>
        </details>
      </section>

      <section id="view-quick-reference" class="hidden animate-in fade-in duration-300">
        <div class="rounded-2xl bg-white/95 dark:bg-slate-900/80 shadow-card border border-slate-200/80 dark:border-slate-800 p-6 space-y-6">
          <div class="space-y-2">
            <h2 class="text-xl font-semibold tracking-tight text-primary-900 dark:text-white">Quick Reference</h2>
            <p class="text-sm text-slate-600 dark:text-slate-300">Fast intraoperative lookup (reference only)</p>
            <p class="text-xs text-slate-500 dark:text-slate-400">Follow institutional protocols and patient monitoring; educational use only.</p>
          </div>

          <div class="space-y-4">
            <div id="quick-reference-tabs" role="tablist" aria-label="Quick reference tabs" class="flex flex-wrap gap-2"></div>
            <div id="quick-reference-panels"></div>
          </div>

          <details class="mt-4 group">
            <summary class="cursor-pointer text-xs font-semibold text-slate-500 dark:text-slate-400 hover:text-accent-500 transition-colors list-none flex items-center gap-2">
              <span class="transform transition-transform group-open:rotate-90">▶</span> Methodology
            </summary>
            <div class="mt-2 p-4 rounded-xl bg-white dark:bg-primary-900 border border-slate-100 dark:border-primary-800 text-xs text-slate-600 dark:text-slate-400 leading-relaxed shadow-sm space-y-3">
              <div class="space-y-1">
                <p class="font-semibold mb-1">Quick reference guidance</p>
                <ul class="list-disc pl-4 space-y-1">
                  <li>These cards provide rapid lookup values for intraoperative use.</li>
                  <li>Ranges vary by protocol, patient physiology, and monitoring targets.</li>
                  <li>Always integrate pressure, NIRS/EEG, and lab trends when titrating flow.</li>
                  <li>This tool is not a medical device and does not replace clinical judgment.</li>
                  <li>Content is data-driven for easy updates and includes last-reviewed dates.</li>
                  <li>Educational use only; follow institutional and surgeon-directed protocols.</li>
                </ul>
              </div>
              <div class="space-y-1">
                <p class="font-semibold mb-1">ACP detail (adult reference)</p>
                <ul class="list-disc pl-4 space-y-1">
                  <li>Flow rate: 8–12 mL/kg/min (≈0.6 mL/min/g cerebral tissue in some references).</li>
                  <li>Perfusion pressure: 40–60 mmHg (right radial artery reference).</li>
                  <li>Temperature: 23–28°C moderate hypothermia.</li>
                  <li>pH management: Alpha-stat to support cerebral autoregulation.</li>
                  <li>Duration: up to ~80 min (reference, elective cases); &gt;40–50 min consider bilateral ACP.</li>
                  <li>Monitoring: NIRS (rSO₂) and EEG; confirm left-right balance with bilateral NIRS.</li>
                </ul>
              </div>
              <div class="space-y-1">
                <p class="font-semibold mb-1">ACP right radial pressure rationale</p>
                <ul class="list-disc pl-4 space-y-1">
                  <li>Most studies and protocols (Annals of Thoracic Surgery, EJCTS, AmSECT) use right radial artery pressure as a surrogate for cerebral perfusion pressure.</li>
                  <li>Unilateral ACP (often via innominate or right axillary/subclavian) directly supplies the right carotid/right brain.</li>
                  <li>Consensus target: adjust flow to keep right radial pressure ~40–60 mmHg (or 40–70).</li>
                  <li>Left radial artery pressure can be lower due to collateral flow and may under-represent left-sided perfusion during unilateral ACP.</li>
                </ul>
              </div>
              <div class="space-y-1">
                <p class="font-semibold mb-1">ACP detail (pediatric reference)</p>
                <ul class="list-disc pl-4 space-y-1">
                  <li>Flow rate: 40–80 mL/kg/min (reference ~50–64); neonates ~46 ± 6 mL/kg/min.</li>
                  <li>Perfusion pressure: commonly 20–25 mmHg (range depends on protocol/measurement site).</li>
                  <li>Perfusate temp: 18–25°C; many ACP programs favor ~25°C moderate hypothermia.</li>
                  <li>pH management: pH-stat is frequently used for neonatal/infant cerebral protection during hypothermia.</li>
                  <li>Duration: ~20–48 min (reference); prolonged times reported in selected cases—if longer expected, avoid DHCA when possible and plan ACP strategy.</li>
                  <li>Monitoring: Bilateral NIRS (trend-focused) ± EEG; TCD optional (availability dependent).</li>
                  <li>Hct: neonatal/infant arch ACP + hypothermia commonly uses <strong>~30–35%</strong> as a reference range.</li>
                  <li>Higher Hct raises O₂ content but increases viscosity—adjust with pressure/flow plus NIRS/EEG response and follow institutional protocols.</li>
                </ul>
              </div>
              <div class="space-y-1">
                <p class="font-semibold mb-1">RCP detail (reference)</p>
                <ul class="list-disc pl-4 space-y-1">
                  <li>SVC pressure: 20–30 mmHg (target 20–25); excessive pressure risks brain edema.</li>
                  <li>Flow: 100–500 mL/min (prefer 150–300); max 500 with pressure-based adjustment.</li>
                  <li>Monitoring: NIRS rScO₂ &gt;60–70% bilateral; EEG for burst suppression/ischemia detection.</li>
                  <li>TCD can be added to track cerebral blood flow velocity.</li>
                </ul>
              </div>
              <div class="space-y-1">
                <p class="font-semibold mb-1">HCA safety-time notes</p>
                <ul class="list-disc pl-4 space-y-1">
                  <li>Varies by center, patient factors (age, comorbidities), neuromonitoring (NIRS rSO₂ &gt;50–60%, EEG), and use of ACP/RCP.</li>
                  <li>Always minimize circulatory arrest time.</li>
                  <li>Cooling time: at least 20–50 min; Rewarming: ≤0.5°C/min recommended.</li>
                  <li>Reference: 2024 EACTS/EACTAIC/EBCP Guidelines (conservative estimates).</li>
                  <li>Follow institutional protocols and patient monitoring; educational use only.</li>
                </ul>
              </div>
            </div>
          </details>
        </div>
      </section>

      <section id="view-info" class="hidden animate-in fade-in duration-300">
        <div class="bg-white dark:bg-primary-900 rounded-2xl shadow-card dark:shadow-none border border-slate-200 dark:border-primary-800 overflow-hidden">
          <div class="p-6 space-y-3 border-b border-slate-100 dark:border-primary-800 bg-slate-50/50 dark:bg-primary-800/30">
            <p class="text-[11px] uppercase tracking-wider text-accent-500 font-semibold">About Perfusion Tools</p>
            <h2 class="text-xl font-bold text-primary-900 dark:text-white">About Us</h2>
            <p class="text-sm text-slate-600 dark:text-slate-300">Perfusion Tools is a lightweight, browser-based collection of calculators for perfusionists working in CPB and ECMO. We focus on transparent formulas, educational annotations, and privacy-friendly design that keeps all calculations on your device.</p>
          </div>
          <div class="p-6 space-y-4 text-sm text-slate-700 dark:text-slate-300">
            <div class="grid md:grid-cols-2 gap-3">
              <div class="bg-slate-50 dark:bg-primary-800/50 border border-slate-200 dark:border-primary-800 rounded-xl p-4 space-y-1">
                <p class="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400">Mission</p>
                <p>Provide evidence-based perfusion calculators that respect clinician privacy and align with contemporary CPB/ECMO best practices.</p>
              </div>
              <div class="bg-slate-50 dark:bg-primary-800/50 border border-slate-200 dark:border-primary-800 rounded-xl p-4 space-y-1">
                <p class="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400">What we cover</p>
                <p>BSA, GDP/DO₂i, heparin dosing, predicted hemodilution, lean body mass, and case timing tools with concise clinical context.</p>
              </div>
            </div>
            <div class="bg-white dark:bg-primary-900 border border-slate-200 dark:border-primary-800 rounded-xl p-4 space-y-2">
              <p class="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400">Questions or feedback?</p>
              <p>We welcome suggestions from perfusion teams. Visit the FAQ for quick answers or head to the contact form to send a note.</p>
              <div class="flex flex-wrap gap-2">
                <a href="/faq" data-route class="px-4 py-2 rounded-lg bg-primary-900 text-white text-sm font-semibold hover:bg-primary-800 transition-colors dark:bg-accent-600 dark:hover:bg-accent-500">View FAQ</a>
                <a href="/contact" data-route class="px-4 py-2 rounded-lg bg-slate-100 text-primary-900 text-sm font-semibold hover:bg-slate-200 transition-colors dark:bg-primary-800 dark:text-slate-100 dark:hover:bg-primary-700">Contact</a>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="faq" class="hidden animate-in fade-in duration-300">
        <h2 class="text-2xl font-bold text-primary-900 dark:text-white mb-1">Frequently Asked Questions</h2>
        <p class="text-sm text-slate-600 dark:text-slate-400 mb-6">Essential answers about the perfusion calculator and oxygen delivery index.</p>

        <div class="space-y-3">
          <details class="group bg-white dark:bg-primary-900 rounded-xl shadow-sm border border-slate-200 dark:border-primary-800 overflow-hidden hover:border-accent-500/30 dark:hover:border-accent-500/30 transition-colors">
            <summary class="font-medium cursor-pointer text-primary-900 dark:text-white flex items-center justify-between p-4 hover:bg-slate-50 dark:hover:bg-primary-800/50 transition-colors select-none" tabindex="0" aria-expanded="false">
              <span>What is DO₂i (Oxygen Delivery Index) and what target range is used during CPB?</span>
              <span class="text-accent-500 transform group-open:rotate-180 transition-transform ml-4 flex-shrink-0">▼</span>
            </summary>
            <div class="border-t border-slate-100 dark:border-primary-700/50 px-4 py-3 bg-slate-50/50 dark:bg-primary-800/30">
              <p class="text-slate-700 dark:text-slate-300 text-sm leading-relaxed">DO₂i (Oxygen Delivery Index) measures how much oxygen the heart delivers to body tissues per minute per square meter of body surface area, expressed in ml O₂/min/m². During normothermic cardiopulmonary bypass, target DO₂i is typically ≥280–300 ml/min/m² to prevent tissue hypoxia and anaerobic metabolism. Infants and neonates often require higher targets (≥350–380 ml/min/m²) due to elevated metabolic rates.</p>
            </div>
          </details>

          <details class="group bg-white dark:bg-primary-900 rounded-xl shadow-sm border border-slate-200 dark:border-primary-800 overflow-hidden hover:border-accent-500/30 dark:hover:border-accent-500/30 transition-colors">
            <summary class="font-medium cursor-pointer text-primary-900 dark:text-white flex items-center justify-between p-4 hover:bg-slate-50 dark:hover:bg-primary-800/50 transition-colors select-none" tabindex="0" aria-expanded="false">
              <span>Does this perfusion calculator store or send patient data?</span>
              <span class="text-accent-500 transform group-open:rotate-180 transition-transform ml-4 flex-shrink-0">▼</span>
            </summary>
            <div class="border-t border-slate-100 dark:border-primary-700/50 px-4 py-3 bg-slate-50/50 dark:bg-primary-800/30">
              <p class="text-slate-700 dark:text-slate-300 text-sm leading-relaxed">No. This is a static HTML-based calculator that runs entirely within your browser—all calculations are performed locally. No patient health information (PHI), clinical inputs, or personal data are saved to a database, sent to external servers, or transmitted over the internet. Your privacy and data security are completely protected.</p>
            </div>
          </details>

          <details class="group bg-white dark:bg-primary-900 rounded-xl shadow-sm border border-slate-200 dark:border-primary-800 overflow-hidden hover:border-accent-500/30 dark:hover:border-accent-500/30 transition-colors">
            <summary class="font-medium cursor-pointer text-primary-900 dark:text-white flex items-center justify-between p-4 hover:bg-slate-50 dark:hover:bg-primary-800/50 transition-colors select-none" tabindex="0" aria-expanded="false">
              <span>Is this a medical device or replacement for clinical judgment?</span>
              <span class="text-accent-500 transform group-open:rotate-180 transition-transform ml-4 flex-shrink-0">▼</span>
            </summary>
            <div class="border-t border-slate-100 dark:border-primary-700/50 px-4 py-3 bg-slate-50/50 dark:bg-primary-800/30">
              <p class="text-slate-700 dark:text-slate-300 text-sm leading-relaxed">This perfusion calculator is an educational tool for healthcare professionals and is <strong>not a medical device</strong>. It does not replace clinical judgment, institutional protocols, or direct patient monitoring. Results are for reference only. Always verify calculations manually and follow your facility's perfusion management guidelines and physician orders when managing oxygen delivery during cardiopulmonary bypass.</p>
            </div>
          </details>
        </div>
      </section>

      <section id="view-privacy" class="hidden p-6 bg-white dark:bg-primary-900 rounded-2xl shadow-card border border-slate-200 dark:border-primary-800 text-slate-700 dark:text-slate-300">
        <h2 class="text-2xl font-bold text-primary-900 dark:text-white mb-4">Privacy Policy</h2>
        <div class="prose prose-sm dark:prose-invert max-w-none">
          <p>This site is a static calculator that runs entirely in your browser. No clinical inputs, identifiers, or session data are sent to any server.</p>
          <p>Anonymous, aggregate analytics may be used to understand feature usage (page views, button clicks) without logging IP addresses or patient information.</p>
          <p>Inputs remain on-device and disappear when you refresh or close the page. Do not store or print screenshots that contain protected health information (PHI) on shared systems.</p>
          <p>If you have privacy concerns or wish to report a data issue, please reach out via the contact form below. We will respond promptly with remediation steps.</p>
        </div>
      </section>
      
      <section id="view-terms" class="hidden p-6 bg-white dark:bg-primary-900 rounded-2xl shadow-card border border-slate-200 dark:border-primary-800 text-slate-700 dark:text-slate-300">
        <h2 class="text-2xl font-bold text-primary-900 dark:text-white mb-4">Terms of Use</h2>
        <div class="prose prose-sm dark:prose-invert max-w-none">
          <p>This calculator is provided for educational use by healthcare professionals. It is not a medical device and does not replace clinical judgment or institutional protocols.</p>
          <p>Always confirm calculations manually, correlate with patient data, and follow attending physician orders. Use of this tool is at your own risk.</p>
          <p>No warranty is provided, express or implied. The developers are not liable for decisions or outcomes arising from use of the calculator.</p>
          <p>By continuing to use this site, you agree to these terms. If you do not agree, please discontinue use.</p>
        </div>
      </section>

      <section id="view-contact" class="hidden animate-in fade-in duration-300">
        <div class="bg-white dark:bg-primary-900 rounded-2xl shadow-card border border-slate-200 dark:border-primary-800 p-6 flex flex-col gap-4">
          <div class="flex flex-col gap-2">
            <h2 class="text-2xl font-bold text-primary-900 dark:text-white">Contact</h2>
            <p class="text-sm text-slate-600 dark:text-slate-300">We value your feedback. For feature requests or bug reports, please contact us:</p>
          </div>
          <div class="flex flex-col md:flex-row md:items-center gap-3 md:gap-4">
            <address class="not-italic text-lg font-semibold text-primary-900 dark:text-white flex items-center gap-2" aria-label="Contact email address">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-accent-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12H8m8 0V8m0 4v4m4-10v10a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h12a2 2 0 012 2z" />
              </svg>
              <span id="contact-email" class="break-all">perfusiontools@gmail.com</span>
            </address>
            <div class="flex items-center gap-2">
              <a id="contact-mailto" href="mailto:perfusiontools@gmail.com" class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-primary-600 text-white text-sm font-medium shadow-sm hover:bg-primary-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12H8m0 0l4-4m-4 4l4 4" />
                </svg>
                <span>Send Email</span>
              </a>
              <button id="contact-copy" type="button" class="inline-flex items-center gap-2 px-3 py-2 rounded-xl border border-slate-200 dark:border-primary-700 bg-white dark:bg-primary-800 text-sm font-medium text-primary-900 dark:text-white shadow-sm hover:border-accent-500 hover:text-accent-500 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16h8M8 12h8m-5 8h5a2 2 0 002-2V6a2 2 0 00-2-2h-5m-4 4H7a2 2 0 00-2 2v8a2 2 0 002 2h5a2 2 0 002-2v-1" />
                </svg>
                <span>Copy Address</span>
              </button>
            </div>
          </div>
          <div id="contact-toast" class="fixed bottom-24 left-1/2 -translate-x-1/2 bg-primary-900 text-white px-4 py-2 rounded-full shadow-lg text-sm opacity-0 translate-y-2 pointer-events-none transition-all duration-300 hidden">Copied!</div>
        </div>
      </section>

    </main>
  </div>

  <footer class="hidden md:block mt-10 border-t border-slate-200 dark:border-primary-800 bg-white dark:bg-primary-900/90">
    <div class="max-w-7xl mx-auto px-4 py-8 text-sm text-slate-500 dark:text-slate-400 flex flex-col md:flex-row md:items-center md:justify-between gap-3">
      <p>© <span id="year"></span> Perfusion Tools. Educational use for healthcare professionals.</p>
      <nav class="flex gap-4">
        <a href="/quick-reference" data-route class="hover:text-accent-500 transition-colors">Quick Reference</a>
        <a href="/privacy" data-route class="hover:text-accent-500 transition-colors">Privacy</a>
        <a href="/terms" data-route class="hover:text-accent-500 transition-colors">Terms</a>
        <a href="/contact" data-route class="hover:text-accent-500 transition-colors">Contact</a>
      </nav>
    </div>
  </footer>

  <nav class="md:hidden fixed bottom-0 left-0 w-full bg-white dark:bg-primary-900 border-t border-slate-200 dark:border-primary-800 z-50 flex justify-around items-center h-[var(--bottom-nav-height)] pb-safe">
    <a href="/" data-route id="mob-home" class="flex flex-col items-center justify-center w-full h-full text-slate-400 dark:text-slate-500 hover:text-accent-600 dark:hover:text-accent-400 transition-colors">
      <svg class="w-6 h-6 mb-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9.75l9-6 9 6V19.5A1.5 1.5 0 0119.5 21h-15A1.5 1.5 0 013 19.5V9.75z" /></svg>
      <span class="text-[10px] font-medium">Home</span>
    </a>
    <a href="/bsa" data-route id="mob-bsa" class="flex flex-col items-center justify-center w-full h-full text-slate-400 dark:text-slate-500 hover:text-accent-600 dark:hover:text-accent-400 transition-colors">
      <svg class="w-6 h-6 mb-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.5 9.75A2.25 2.25 0 016.75 7.5h10.5A2.25 2.25 0 0119.5 9.75v4.5A2.25 2.25 0 0117.25 16.5H6.75A2.25 2.25 0 014.5 14.25v-4.5z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.25 12h7.5M9 9.75v4.5m6-4.5v4.5" /></svg>
      <span class="text-[10px] font-medium">BSA</span>
    </a>
    <a href="/gdp" data-route id="mob-do2i" class="flex flex-col items-center justify-center w-full h-full text-slate-400 dark:text-slate-500 hover:text-accent-600 dark:hover:text-accent-400 transition-colors">
      <svg class="w-6 h-6 mb-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
      <span class="text-[10px] font-medium">GDP</span>
    </a>
    <a href="/heparin" data-route id="mob-heparin" class="flex flex-col items-center justify-center w-full h-full text-slate-400 dark:text-slate-500 hover:text-accent-600 dark:hover:text-accent-400 transition-colors">
      <svg class="w-6 h-6 mb-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
      <span class="text-[10px] font-medium">Heparin</span>
    </a>
    <a href="/predicted-hct" data-route id="mob-hct" class="flex flex-col items-center justify-center w-full h-full text-slate-400 dark:text-slate-500 hover:text-accent-600 dark:hover:text-accent-400 transition-colors">
      <svg class="w-6 h-6 mb-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" /></svg>
      <span class="text-[10px] font-medium">Hct</span>
    </a>
    <a href="/lbm" data-route id="mob-lbm" class="flex flex-col items-center justify-center w-full h-full text-slate-400 dark:text-slate-500 hover:text-accent-600 dark:hover:text-accent-400 transition-colors">
      <svg class="w-6 h-6 mb-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
      <span class="text-[10px] font-medium">LBM</span>
    </a>
    <a href="/timecalc" data-route id="mob-time" class="flex flex-col items-center justify-center w-full h-full text-slate-400 dark:text-slate-500 hover:text-accent-600 dark:hover:text-accent-400 transition-colors">
      <svg class="w-6 h-6 mb-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
      <span class="text-[10px] font-medium">Time</span>
    </a>
    <a href="/quick-reference" data-route id="mob-quick-reference" class="flex flex-col items-center justify-center w-full h-full text-slate-400 dark:text-slate-500 hover:text-accent-600 dark:hover:text-accent-400 transition-colors">
      <svg class="w-6 h-6 mb-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6.75A2.75 2.75 0 016.75 4h10.5A2.75 2.75 0 0120 6.75v10.5A2.75 2.75 0 0117.25 20H6.75A2.75 2.75 0 014 17.25V6.75z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9h8M8 13h8M8 17h5" /></svg>
      <span class="text-[10px] font-medium">Quick Ref</span>
    </a>
    <a href="/info" data-route id="mob-info" class="flex flex-col items-center justify-center w-full h-full text-slate-400 dark:text-slate-500 hover:text-accent-600 dark:hover:text-accent-400 transition-colors">
      <svg class="w-6 h-6 mb-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
      <span class="text-[10px] font-medium">Info</span>
    </a>
  </nav>

  <script src="quickReferenceData.js"></script>
  <script src="main.js"></script>
</body>
</html>
