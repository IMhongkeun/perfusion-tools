<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Perfusionist Calculators ‚Äî DO‚ÇÇi & Predicted Hct | Perfusion Tools</title>
  <meta name="description" content="Modern perfusionist calculators for DO‚ÇÇ index (DO‚ÇÇi) and predicted hematocrit on CPB. Clean, mobile‚Äëfriendly UI with live BSA formulas for adult and pediatric patients." />
  <meta name="keywords" content="perfusion calculator, DO2i calculator, oxygen delivery index, predicted hematocrit, CPB hemodilution, ECMO calculator, perfusionist tools, cardiac surgery, BSA calculator" />
  <link rel="canonical" href="https://perfusion.pro/" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Perfusionist Calculators ‚Äî DO‚ÇÇi & Predicted Hct" />
  <meta property="og:description" content="Fast, clinically‚Äëfocused perfusion calculators for DO‚ÇÇi and predicted hematocrit with a modern Deep Navy + Aqua UI." />
  <meta property="og:url" content="https://perfusion.pro/" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Perfusionist Calculators ‚Äî DO‚ÇÇi & Predicted Hct" />
  <meta name="twitter:description" content="Perfusion‚Äëfocused DO‚ÇÇi and hemodilution calculators with clean responsive design." />
  <meta name="theme-color" content="#020617" />

  <!-- Tailwind via CDN (no build step) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            brand: {
              50: '#0b1120',
              100: '#020617',
              200: '#020617',
              400: '#0f172a',
              500: '#020617',
              600: '#020617',
              700: '#020617',
              900: '#020617'
            },
            accent: {
              100: '#e0faff',
              200: '#a5f3fc',
              300: '#67e8f9',
              400: '#22d3ee',
              500: '#06b6d4'
            }
          },
          boxShadow: {
            card: '0 14px 40px rgba(15,23,42,0.35)'
          }
        }
      }
    };
  </script>
  <style>
    :root { color-scheme: light; }
    html.dark { color-scheme: dark; }
    input[type=number] { appearance: textfield; }
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .nav-link { transition: background-color 0.15s ease, color 0.15s ease, transform 0.12s ease; }
    .nav-link:hover { transform: translateY(-1px); }
    .nav-link-active { background-color: rgba(15,23,42,0.9); color: #e0f2fe; }
    .nav-link-active-mobile { background-color: rgba(15,23,42,1); color: #e0f2fe; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900 antialiased dark:bg-slate-950 dark:text-slate-50">
  <!-- App Shell -->
  <header class="sticky top-0 z-30 border-b border-slate-800/60 bg-brand-900/95 dark:bg-slate-950/95 backdrop-blur">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <!-- CSS logo: circuit + flow motif -->
        <div class="h-9 w-9 rounded-2xl bg-gradient-to-br from-brand-900 via-slate-900 to-accent-500 border border-accent-400 shadow-md flex items-center justify-center">
          <div class="h-6 w-6 rounded-full border-[2px] border-accent-300 flex items-center justify-center">
            <div class="h-2 w-4 rounded-full bg-accent-400/90"></div>
          </div>
        </div>
        <div class="leading-tight">
          <p class="text-xs uppercase tracking-[0.2em] text-accent-300">Perfusion Tools</p>
          <h1 class="text-sm md:text-base font-semibold tracking-tight text-slate-50">Perfusionist Calculators</h1>
        </div>
      </div>
      <div class="flex items-center gap-4">
        <nav class="hidden md:flex items-center gap-4 text-xs font-medium text-slate-200">
          <a href="#/do2i" data-route="do2i" class="nav-link rounded-full px-3 py-1.5">
            DO‚ÇÇi
          </a>
          <a href="#/predicted-hct" data-route="hct" class="nav-link rounded-full px-3 py-1.5">
            Predicted Hct
          </a>
          <a href="#/faq" data-route="faq" class="nav-link rounded-full px-3 py-1.5">
            FAQ
          </a>
        </nav>
        <button id="theme-toggle" class="ml-2 inline-flex items-center gap-1 rounded-full border border-slate-700/80 bg-slate-900/70 px-3 py-1.5 text-xs text-slate-100 hover:border-accent-400 hover:text-accent-200">
          <span id="theme-icon" aria-hidden="true">üåô</span>
          <span class="hidden sm:inline" id="theme-label">Dark</span>
        </button>
      </div>
    </div>
  </header>

  <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-[260px_1fr] gap-0">
    <!-- Sidebar -->
    <aside class="hidden md:block md:border-r border-slate-800/60 bg-brand-900/95 text-slate-100 md:sticky md:top-[64px] md:h-[calc(100vh-64px)] p-4">
      <div class="mb-4">
        <p class="text-[11px] uppercase tracking-[0.18em] text-slate-400 mb-2">Calculators</p>
        <input placeholder="Search calculators" class="w-full rounded-xl border border-slate-700/80 bg-slate-900/70 px-3 py-2 text-xs placeholder:text-slate-500 focus:outline-none focus:ring-1 focus:ring-accent-400" />
      </div>
      <nav class="space-y-1 text-sm">
        <a href="#/do2i" data-route="do2i" class="nav-link block px-3 py-2 rounded-xl text-slate-100/80">
          DO‚ÇÇ Index (DO‚ÇÇi)
        </a>
        <a href="#/predicted-hct" data-route="hct" class="nav-link block px-3 py-2 rounded-xl text-slate-100/80">
          Predicted Hematocrit
        </a>
        <div class="mt-4 pt-3 border-t border-slate-800/70 text-[11px] text-slate-500 uppercase tracking-[0.18em]">Info</div>
        <a href="#/faq" data-route="faq" class="nav-link block px-3 py-2 rounded-xl text-slate-100/80">
          FAQ & Notes
        </a>
        <a href="#/privacy" data-route="privacy" class="nav-link block px-3 py-2 rounded-xl text-slate-100/80 text-xs">Privacy Policy</a>
        <a href="#/terms" data-route="terms" class="nav-link block px-3 py-2 rounded-xl text-slate-100/80 text-xs">Terms of Use</a>
        <a href="#/contact" data-route="contact" class="nav-link block px-3 py-2 rounded-xl text-slate-100/80 text-xs">Contact</a>
      </nav>
    </aside>

    <!-- Main content -->
    <main class="p-4 md:p-8 space-y-8">
      <!-- DO2i -->
      <section id="view-do2i" class="hidden">
        <div class="rounded-2xl bg-white/95 dark:bg-slate-900/80 shadow-card border border-slate-200/80 dark:border-slate-800 px-5 py-6 sm:px-6 sm:py-7">
          <header class="flex items-center justify-between mb-4 gap-4">
            <div class="flex items-center gap-3">
              <div>
                <h2 class="text-xl md:text-2xl font-semibold tracking-tight text-slate-900 dark:text-slate-50">DO‚ÇÇ Index (DO‚ÇÇi)</h2>
                <span class="text-[11px] uppercase tracking-[0.18em] text-slate-500 dark:text-slate-400">mL O‚ÇÇ / min / m¬≤</span>
              </div>
              <!-- Mode toggle: Adult(default)/Infant -->
              <div class="ml-2 inline-flex rounded-full border border-slate-300 dark:border-slate-700 bg-slate-100/70 dark:bg-slate-900/80 overflow-hidden text-[11px] font-medium">
                <button id="mode-adult" class="px-3 py-1 bg-slate-900/90 text-slate-50">Adult</button>
                <button id="mode-infant" class="px-3 py-1 text-slate-600 dark:text-slate-300">Infant</button>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <button id="do2i-reset" class="text-[11px] uppercase tracking-[0.16em] px-3 py-1.5 rounded-full border border-slate-300 dark:border-slate-700 bg-slate-50/80 dark:bg-slate-900/70 text-slate-600 dark:text-slate-300 hover:border-accent-400">Reset</button>
            </div>
          </header>

          <div class="grid sm:grid-cols-2 gap-4 items-start">
            <div>
              <label class="block text-xs font-medium text-slate-700 dark:text-slate-200">Height (cm)</label>
              <input id="h_cm" type="number" step="0.1" placeholder="170" class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm" />
            </div>
            <div>
              <label class="block text-xs font-medium text-slate-700 dark:text-slate-200">Weight (kg)</label>
              <input id="w_kg" type="number" step="0.1" placeholder="70" class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm" />
            </div>

            <div class="sm:col-span-2 grid grid-cols-[minmax(0,1fr)_auto] gap-2 items-end">
              <div>
                <label class="block text-xs font-medium text-slate-700 dark:text-slate-200">BSA (m¬≤)</label>
                <input id="bsa" type="number" step="0.01" placeholder="Auto from H/W or enter" class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm" />
                <p id="bsa-hint" class="text-[11px] text-slate-500 dark:text-slate-400 mt-1">Auto if height & weight are provided (‚Äî)</p>
              </div>
              <div class="w-[170px] text-sm">
                <label class="block text-[11px] text-slate-500 dark:text-slate-400">BSA formula</label>
                <select id="bsa-method" class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-2 py-2 text-xs">
                  <option value="Mosteller">Mosteller</option>
                  <option value="DuBois">DuBois & DuBois</option>
                  <option value="Haycock">Haycock</option>
                  <option value="GehanGeorge">Gehan‚ÄìGeorge</option>
                </select>
              </div>
            </div>

            <div>
              <label class="block text-xs font-medium text-slate-700 dark:text-slate-200">Pump Flow (L/min)</label>
              <input id="flow" type="number" step="0.01" placeholder="4.6" class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm" />
            </div>
            <div>
              <label class="block text-xs font-medium text-slate-700 dark:text-slate-200">Hemoglobin (g/dL)</label>
              <input id="hb" type="number" step="0.1" placeholder="10" class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm" />
            </div>
            <div>
              <label class="block text-xs font-medium text-slate-700 dark:text-slate-200">SaO‚ÇÇ (%)</label>
              <input id="sao2" type="number" step="0.1" placeholder="100" class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm" />
            </div>
            <div>
              <label class="block text-xs font-medium text-slate-700 dark:text-slate-200">PaO‚ÇÇ (mmHg)</label>
              <input id="pao2" type="number" step="1" placeholder="" class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm" />
            </div>
            <div>
              <label class="block text-xs font-medium text-slate-700 dark:text-slate-200">CaO‚ÇÇ (mL/dL)</label>
              <input id="cao2" disabled class="mt-1 w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/70 px-3 py-2 text-sm text-slate-700 dark:text-slate-200" />
            </div>
          </div>

          <div class="mt-5 p-4 rounded-2xl bg-slate-50/90 dark:bg-slate-900/80 border border-slate-200/80 dark:border-slate-800">
            <div class="flex items-center justify-between gap-4">
              <div class="space-y-1">
                <p class="text-xs font-medium text-slate-600 dark:text-slate-300 flex items-center gap-2">
                  DO‚ÇÇi result
                  <span id="mode-badge" class="ml-1 text-[10px] px-2 py-0.5 rounded-full bg-slate-900 text-slate-50 dark:bg-slate-100 dark:text-slate-900">Adult</span>
                </p>
                <p class="text-[11px] text-slate-500 dark:text-slate-400">Indexed oxygen delivery based on current flow, BSA and CaO‚ÇÇ.</p>
              </div>
              <div class="text-right ml-auto">
                <div id="do2i" class="text-2xl md:text-3xl font-semibold tracking-tight text-slate-900 dark:text-slate-50">‚Äî mL/min/m¬≤</div>
              </div>
            </div>
            <div class="mt-3 h-2 rounded-full bg-slate-200 dark:bg-slate-800 overflow-hidden">
              <div id="do2i-gauge" class="h-2 rounded-full bg-accent-400" style="width:0%"></div>
            </div>
            <p id="do2i-msg" class="mt-2 text-sm font-medium text-slate-700 dark:text-slate-200"></p>
            <div id="do2i-legend" class="mt-1 text-[11px] text-slate-500 dark:text-slate-400"></div>
          </div>

          <div class="mt-4 grid md:grid-cols-2 gap-4">
            <details class="rounded-xl border border-slate-200 dark:border-slate-700 bg-white/90 dark:bg-slate-900/80 p-3">
              <summary class="cursor-pointer text-xs font-semibold text-slate-700 dark:text-slate-100">Methodology</summary>
              <ul class="text-xs text-slate-600 dark:text-slate-300 list-disc pl-4 mt-2 space-y-1">
                <li><strong>CaO‚ÇÇ</strong> (mL/dL) = 1.34 √ó Hb √ó (SaO‚ÇÇ / 100) + 0.0031 √ó PaO‚ÇÇ.</li>
                <li><strong>DO‚ÇÇi</strong> (mL/min/m¬≤) = (Pump Flow √∑ BSA) √ó CaO‚ÇÇ √ó 10.</li>
                <li>Constants: H√ºfner factor 1.34 mL O‚ÇÇ/g Hb; dissolved O‚ÇÇ 0.0031 mL¬∑dL‚Åª¬π¬∑mmHg‚Åª¬π.</li>
              </ul>
            </details>

            <div class="rounded-xl border border-accent-400/50 bg-accent-100/60 dark:bg-slate-900/80 p-3">
              <h3 class="text-xs font-semibold text-slate-800 dark:text-accent-200">Clinical notes (educational only)</h3>
              <ul class="mt-1 text-[11px] text-slate-700 dark:text-slate-200 space-y-1 list-disc pl-4">
                <li><span class="font-medium">Adult:</span> many centers target DO‚ÇÇi ‚â• 280‚Äì300 mL/min/m¬≤ on CPB; values &lt; 260 may be considered low.</li>
                <li><span class="font-medium">Infant/pediatric:</span> higher indexed delivery is typically used; thresholds in this tool are shifted upward (e.g., target ‚â• 380 mL/min/m¬≤).</li>
                <li>Interpret DO‚ÇÇi together with lactate, SvO‚ÇÇ/ScvO‚ÇÇ, urine output, and overall hemodynamics.</li>
                <li>This tool is for education and decision support only and does not replace institutional protocols.</li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- Predicted Hct -->
      <section id="view-hct" class="hidden">
        <div class="rounded-2xl bg-white/95 dark:bg-slate-900/80 shadow-card border border-slate-200/80 dark:border-slate-800 px-5 py-6 sm:px-6 sm:py-7">
          <header class="flex items-center justify-between mb-4">
            <div>
              <h2 class="text-xl md:text-2xl font-semibold tracking-tight text-slate-900 dark:text-slate-50">Predicted Hematocrit on CPB</h2>
              <span class="text-[11px] uppercase tracking-[0.18em] text-slate-500 dark:text-slate-400">CPB hemodilution</span>
            </div>
            <span class="text-xs text-slate-500 dark:text-slate-400">Output in %</span>
          </header>

          <div class="grid sm:grid-cols-2 gap-4">
            <div>
              <label class="block text-xs font-medium text-slate-700 dark:text-slate-200">Patient Type</label>
              <select id="pttype" class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm">
                <option value="adult_m">Adult ‚Äî Male (70 mL/kg)</option>
                <option value="adult_f">Adult ‚Äî Female (65 mL/kg)</option>
                <option value="child">Child (75 mL/kg)</option>
                <option value="infant">Infant (80 mL/kg)</option>
                <option value="neonate">Neonate (90 mL/kg)</option>
              </select>
            </div>
            <div>
              <label class="block text-xs font-medium text-slate-700 dark:text-slate-200">Weight (kg)</label>
              <input id="wt_hct" type="number" step="0.1" placeholder="70" class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm" />
              <p class="text-[11px] text-slate-500 dark:text-slate-400 mt-1">EBV = weight √ó coefficient above.</p>
            </div>
            <div>
              <label class="block text-xs font-medium text-slate-700 dark:text-slate-200">Pre‚ÄëCPB Hct (%)</label>
              <input id="pre_hct" type="number" step="0.1" placeholder="40" class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm" />
            </div>
            <div>
              <label class="block text-xs font-medium text-slate-700 dark:text-slate-200">Circuit Prime (mL)</label>
              <input id="prime" type="number" step="1" placeholder="1200" class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm" />
            </div>
            <div>
              <label class="block text-xs font-medium text-slate-700 dark:text-slate-200">Additional Fluids (mL)</label>
              <input id="fluids" type="number" step="1" value="0" class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm" />
            </div>
            <div>
              <label class="block text-xs font-medium text-slate-700 dark:text-slate-200">Ultrafiltration Removed (mL)</label>
              <input id="removed" type="number" step="1" value="0" class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm" />
            </div>
            <div>
              <label class="block text-xs font-medium text-slate-700 dark:text-slate-200">RBC Units (number)</label>
              <input id="rbc_units" type="number" step="1" value="0" class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm" />
            </div>
            <div>
              <label class="block text-xs font-medium text-slate-700 dark:text-slate-200">Per‚ÄëUnit Volume (mL)</label>
              <input id="rbc_unit_vol" type="number" step="1" value="300" class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm" />
              <p class="text-[11px] text-slate-500 dark:text-slate-400 mt-1">Commonly 250‚Äì350 mL.</p>
            </div>
            <div>
              <label class="block text-xs font-medium text-slate-700 dark:text-slate-200">RBC Hct (%)</label>
              <input id="rbc_hct" type="number" step="1" value="60" class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm" />
            </div>
          </div>

          <div class="mt-5 p-4 rounded-2xl bg-slate-50/90 dark:bg-slate-900/80 border border-slate-200/80 dark:border-slate-800 grid sm:grid-cols-3 gap-4">
            <div>
              <div class="text-xs font-medium text-slate-600 dark:text-slate-300">Estimated Blood Volume (mL)</div>
              <div id="ebv" class="text-2xl font-semibold text-slate-900 dark:text-slate-50">‚Äî</div>
            </div>
            <div>
              <div class="text-xs font-medium text-slate-600 dark:text-slate-300">Total Volume at Sampling (mL)</div>
              <div id="total_vol" class="text-2xl font-semibold text-slate-900 dark:text-slate-50">‚Äî</div>
            </div>
            <div>
              <div class="text-xs font-medium text-slate-600 dark:text-slate-300">Predicted Hct (%)</div>
              <div id="pred_hct" class="text-2xl font-semibold text-slate-900 dark:text-slate-50">‚Äî</div>
            </div>
          </div>

          <div class="mt-4 grid md:grid-cols-2 gap-4">
            <details class="rounded-xl border border-slate-200 dark:border-slate-700 bg-white/90 dark:bg-slate-900/80 p-3">
              <summary class="cursor-pointer text-xs font-semibold text-slate-700 dark:text-slate-100">Methodology</summary>
              <ul class="text-xs text-slate-600 dark:text-slate-300 list-disc pl-4 mt-2 space-y-1">
                <li><strong>EBV</strong> (mL) = Weight √ó coefficient (Adult M 70; F 65; Child 75; Infant 80; Neonate 90 mL/kg).</li>
                <li><strong>RBC volume</strong> (mL) = EBV √ó (Hct_pre / 100) + (RBC_units √ó unit_vol) √ó (RBC_Hct / 100).</li>
                <li><strong>Total volume at sampling</strong> (mL) = EBV + prime + fluids + (RBC_units √ó unit_vol) ‚àí ultrafiltration.</li>
                <li><strong>Predicted Hct</strong> (%) = RBC volume √∑ Total volume √ó 100.</li>
              </ul>
            </details>

            <div class="rounded-xl border border-accent-400/50 bg-accent-100/60 dark:bg-slate-900/80 p-3">
              <h3 class="text-xs font-semibold text-slate-800 dark:text-accent-200">Clinical notes (educational only)</h3>
              <ul class="mt-1 text-[11px] text-slate-700 dark:text-slate-200 space-y-1 list-disc pl-4">
                <li>Many adult programs aim for on‚Äëpump Hct around 22‚Äì30% depending on risk profile and institutional strategy.</li>
                <li>Pediatric and neonatal cases often target higher Hct because of smaller cerebral reserve and different metabolic demands.</li>
                <li>Increasing prime volume or crystalloid/colloid fluids will dilute Hct; ultrafiltration or RBC addition will raise Hct.</li>
                <li>This estimate assumes complete mixing and does not account for intra‚Äëoperative blood loss or retransfusion.</li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- Self-test results panel -->
      <section id="tests" class="hidden">
        <div class="rounded-2xl bg-white/95 dark:bg-slate-900/80 shadow-card border border-slate-200/80 dark:border-slate-800 p-6">
          <h3 class="text-lg font-semibold">Self‚Äëtests</h3>
          <ul id="test-log" class="mt-3 space-y-1 text-sm"></ul>
        </div>
      </section>

      <!-- FAQ / Info -->
      <section id="view-faq" class="hidden">
        <div class="rounded-2xl bg-white/95 dark:bg-slate-900/80 shadow-card border border-slate-200/80 dark:border-slate-800 p-6">
          <h2 class="text-xl font-semibold tracking-tight">FAQ & Educational Notes</h2>

          <details class="mt-4 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50/80 dark:bg-slate-900/80 p-4">
            <summary class="font-medium cursor-pointer text-sm text-slate-800 dark:text-slate-100">What DO‚ÇÇi targets are commonly used?</summary>
            <p class="mt-2 text-sm text-slate-700 dark:text-slate-200">Targets vary by institution and patient risk. Many adult centers aim for DO‚ÇÇi ‚â• 280‚Äì300 mL/min/m¬≤ during CPB, with some using higher thresholds in high‚Äërisk or anemic patients. Pediatric practices often use higher indexed flows and DO‚ÇÇi targets. Always follow your local protocol.</p>
          </details>

          <details class="mt-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50/80 dark:bg-slate-900/80 p-4">
            <summary class="font-medium cursor-pointer text-sm text-slate-800 dark:text-slate-100">How should I interpret predicted Hct?</summary>
            <p class="mt-2 text-sm text-slate-700 dark:text-slate-200">The predicted hematocrit is a mixing model estimate based on circulating volume, prime and RBC additions. It is useful for planning but should be checked against actual laboratory results after CPB initiation and during the case.</p>
          </details>

          <details class="mt-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50/80 dark:bg-slate-900/80 p-4">
            <summary class="font-medium cursor-pointer text-sm text-slate-800 dark:text-slate-100">Is this tool a medical device?</summary>
            <p class="mt-2 text-sm text-slate-700 dark:text-slate-200">No. This site is for educational use by trained healthcare professionals. It does not provide medical advice and is not a regulated medical device. Clinical decisions must follow your institution&rsquo;s guidelines and the judgment of the care team.</p>
          </details>
        </div>
      </section>

      <!-- Legal/Support pages -->
      <section id="view-privacy" class="hidden">
        <div class="rounded-2xl bg-white/95 dark:bg-slate-900/80 shadow-card border border-slate-200/80 dark:border-slate-800 p-6">
          <h2 class="text-2xl font-bold tracking-tight">Privacy Policy</h2>
          <p class="mt-2 text-slate-700 dark:text-slate-300 text-sm">Last updated: <span id="privacy-date"></span></p>
          <div class="prose prose-sm mt-4 max-w-none text-slate-700 dark:text-slate-300">
            <h3>1. Overview</h3>
            <p>We respect your privacy. This site provides educational calculators for healthcare professionals and collects the minimum data necessary to operate and improve the service.</p>
            <h3>2. Data We Collect</h3>
            <ul>
              <li><strong>Usage data</strong>: anonymized analytics (pages visited, basic device info). No clinical inputs you type (height, weight, labs) are persisted to our servers.</li>
              <li><strong>Cookies</strong>: used only for essential functionality and optional analytics/advertising.</li>
              <li><strong>Ads</strong>: if Google AdSense is enabled, third‚Äëparty vendors may use cookies to serve ads. You can opt out of personalized ads via Google&rsquo;s Ads Settings.</li>
            </ul>
            <h3>3. How We Use Data</h3>
            <ul>
              <li>To operate, secure, and improve the calculators</li>
              <li>To understand aggregate usage patterns</li>
              <li>To display non‚Äëintrusive advertising that helps cover hosting costs</li>
            </ul>
            <h3>4. Data Sharing</h3>
            <p>We do not sell personal information. We may share limited usage data with analytics/ads providers (e.g., Google) strictly for measurement and ad delivery as configured.</p>
            <h3>5. International Users</h3>
            <p>Data may be processed in countries different from your own. We apply reasonable safeguards consistent with applicable laws.</p>
            <h3>6. Your Choices</h3>
            <ul>
              <li>Use content blockers or adjust browser settings for cookies</li>
              <li>Opt out of personalized advertising in your Google settings</li>
              <li>Contact us to request removal of any contact messages you sent</li>
            </ul>
            <h3>7. Children</h3>
            <p>This site is intended for professional users. We do not knowingly collect data from children.</p>
            <h3>8. Contact</h3>
            <p>Questions? See <a href="#/contact">Contact</a>.</p>
          </div>
        </div>
      </section>

      <section id="view-terms" class="hidden">
        <div class="rounded-2xl bg-white/95 dark:bg-slate-900/80 shadow-card border border-slate-200/80 dark:border-slate-800 p-6">
          <h2 class="text-2xl font-bold tracking-tight">Terms of Use</h2>
          <p class="mt-2 text-slate-700 dark:text-slate-300 text-sm">Last updated: <span id="terms-date"></span></p>
          <div class="prose prose-sm mt-4 max-w-none text-slate-700 dark:text-slate-300">
            <h3>1. Purpose &amp; Audience</h3>
            <p>These tools are for educational use by trained healthcare professionals. They do not replace clinical judgment, institutional policy, or bedside assessment.</p>
            <h3>2. No Medical Advice</h3>
            <p>Outputs are estimates based on formulas and user inputs. You are responsible for verifying results and making clinical decisions. The site owner is not liable for outcomes arising from the use or misuse of the calculators.</p>
            <h3>3. Acceptable Use</h3>
            <ul>
              <li>Do not attempt to reverse engineer, scrape at scale, or disrupt the service.</li>
              <li>Do not input any patient‚Äëidentifiable information.</li>
              <li>Use the tools in compliance with local laws and hospital policies.</li>
            </ul>
            <h3>4. Availability &amp; Changes</h3>
            <p>We may modify or discontinue features at any time. Content is provided &ldquo;as is&rdquo; without warranties of any kind.</p>
            <h3>5. Intellectual Property</h3>
            <p>Site design, text, and code are owned by the site operator unless otherwise noted. You may link to the site and share screenshots with attribution.</p>
            <h3>6. Third‚ÄëParty Services</h3>
            <p>We may use analytics and advertising services (e.g., Google). Their terms and privacy policies apply in addition to ours.</p>
            <h3>7. Contact</h3>
            <p>For questions about these terms, see <a href="#/contact">Contact</a>.</p>
          </div>
        </div>
      </section>

      <section id="view-contact" class="hidden">
        <div class="rounded-2xl bg-white/95 dark:bg-slate-900/80 shadow-card border border-slate-200/80 dark:border-slate-800 p-6">
          <h2 class="text-2xl font-bold tracking-tight">Contact</h2>
          <p class="mt-2 text-slate-700 dark:text-slate-300 text-sm">Have feedback or found an issue? Send us a message.</p>
          <form id="contact-form" class="mt-4 grid sm:grid-cols-2 gap-4">
            <div class="sm:col-span-1">
              <label class="block text-sm font-medium">Your Name</label>
              <input id="c_name" type="text" placeholder="Jane Doe" class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2" required />
            </div>
            <div class="sm:col-span-1">
              <label class="block text-sm font-medium">Email</label>
              <input id="c_email" type="email" placeholder="you@example.com" class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2" required />
            </div>
            <div class="sm:col-span-2">
              <label class="block text-sm font-medium">Message</label>
              <textarea id="c_msg" rows="5" placeholder="Tell us about a bug, feature idea, or general feedback." class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2"></textarea>
            </div>
            <div class="sm:col-span-2 flex items-center gap-3">
              <button id="c_send" type="submit" class="px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 hover:bg-slate-100 dark:hover:bg-slate-800">Send</button>
              <a id="c_mailto" href="#" class="text-sm underline text-accent-400">Use mail app</a>
              <span id="c_status" class="text-sm text-slate-600 dark:text-slate-300"></span>
            </div>
          </form>
          <p class="mt-4 text-xs text-slate-500 dark:text-slate-400">Note: We do not store calculator inputs. For privacy requests, please specify the email and details you previously sent via this form.</p>
        </div>
      </section>
    </main>
  </div>

  <!-- Mobile bottom nav -->
  <nav class="md:hidden fixed bottom-0 inset-x-0 border-t border-slate-800/80 bg-brand-900/98 text-xs text-slate-200 z-40">
    <div class="max-w-7xl mx-auto flex items-stretch justify-around">
      <a href="#/do2i" data-route="do2i" class="nav-link flex-1 flex flex-col items-center justify-center py-2">
        <span>DO‚ÇÇi</span>
      </a>
      <a href="#/predicted-hct" data-route="hct" class="nav-link flex-1 flex flex-col items-center justify-center py-2">
        <span>Hct</span>
      </a>
      <a href="#/faq" data-route="faq" class="nav-link flex-1 flex flex-col items-center justify-center py-2">
        <span>FAQ</span>
      </a>
    </div>
  </nav>

  <footer class="mt-10 border-t border-slate-800/80 bg-brand-900/95 text-slate-300">
    <div class="max-w-7xl mx-auto px-4 py-6 text-xs flex flex-col md:flex-row md:items-center md:justify-between gap-3">
      <p>¬© <span id="year"></span> Perfusion Tools. Educational use for healthcare professionals only.</p>
      <nav class="flex gap-4 underline-offset-4">
        <a href="#/privacy" data-route="privacy" class="hover:underline">Privacy</a>
        <a href="#/terms" data-route="terms" class="hover:underline">Terms</a>
        <a href="#/contact" data-route="contact" class="hover:underline">Contact</a>
      </nav>
    </div>
  </footer>

  <script>
  'use strict';

  // -----------------------------
  // Utilities & Core Formulas
  // -----------------------------
  function clamp(n, min, max) { return Math.min(Math.max(n, min), max); }
  const BSA = {
    Mosteller(h, w) { return Math.sqrt((h * w) / 3600); },
    DuBois(h, w) { return 0.007184 * Math.pow(h, 0.725) * Math.pow(w, 0.425); },
    Haycock(h, w) { return 0.024265 * Math.pow(h, 0.3964) * Math.pow(w, 0.5378); },
    GehanGeorge(h, w) { return 0.0235 * Math.pow(h, 0.42246) * Math.pow(w, 0.51456); },
  };
  function computeBSA(h, w, method) {
    if (!h || !w || h <= 0 || w <= 0) return 0;
    return BSA[method || 'Mosteller'](h, w);
  }
  function calcCaO2(hb, sao2pct, pao2) {
    const s = clamp((sao2pct || 0) / 100, 0, 1);
    return (1.34 * (hb || 0) * s) + (0.0031 * (pao2 || 0));
  }
  function calcDO2i(flowLmin, bsa, cao2) {
    if (!bsa || bsa <= 0) return 0;
    const fi = flowLmin / bsa; // L/min/m^2
    return fi * cao2 * 10; // mL/min/m^2
  }
  function ebvCoef(pttype) {
    switch (pttype) {
      case 'adult_m': return 70; case 'adult_f': return 65; case 'child': return 75; case 'infant': return 80; case 'neonate': return 90; default: return 70;
    }
  }
  function computePredictedHct({ pttype, weight, pre, prime, fluids = 0, removed = 0, rbcUnits = 0, rbcUnitVol = 300, rbcHct = 60 }) {
    const coef = ebvCoef(pttype);
    const ebv = (weight || 0) * coef; // mL
    const rbcVolAdded = (rbcUnits || 0) * (rbcUnitVol || 0); // mL product
    const rbcVolume = (ebv * ((pre || 0) / 100)) + (rbcVolAdded * ((rbcHct || 0) / 100));
    const totalVol = ebv + (prime || 0) + (fluids || 0) + rbcVolAdded - (removed || 0); // mL
    const hct = totalVol > 0 ? (rbcVolume / totalVol) * 100 : 0;
    return { ebv, totalVol, hct };
  }

  // -----------------------------
  // DOM Helpers
  // -----------------------------
  function el(id) { return document.getElementById(id); }
  function num(id) { const n = el(id); return n ? (parseFloat(n.value) || 0) : 0; }
  function setText(id, text) { const n = el(id); if (n) n.textContent = text; }

  // -----------------------------
  // DO2i Interaction
  // -----------------------------
  const do2iIds = ['h_cm','w_kg','bsa','bsa-method','flow','hb','sao2','pao2'];
  let lastChangedId = null; // track last edited control
  let do2iMode = 'adult'; // 'adult' | 'infant'

  const THRESHOLDS = {
    adult: { low: 260, borderline: 300, upper: 450, max: 500, legend: 'Adult thresholds: <260 Low, 260‚Äì299 Borderline, 300‚Äì450 Target, >450 High' },
    infant:{ low: 340, borderline: 380, upper: 520, max: 600, legend: 'Infant thresholds: <340 Low, 340‚Äì379 Borderline, 380‚Äì520 Target, >520 High' }
  };

  function applyModeUI(){
    setText('mode-badge', do2iMode === 'adult' ? 'Adult' : 'Infant');
    const adultBtn = el('mode-adult');
    const infantBtn = el('mode-infant');
    if (adultBtn && infantBtn) {
      if (do2iMode === 'adult') {
        adultBtn.className = 'px-3 py-1 bg-slate-900/90 text-slate-50';
        infantBtn.className = 'px-3 py-1 text-slate-600 dark:text-slate-300';
      } else {
        adultBtn.className = 'px-3 py-1 text-slate-600 dark:text-slate-300';
        infantBtn.className = 'px-3 py-1 bg-slate-900/90 text-slate-50';
      }
    }
    setText('do2i-legend', THRESHOLDS[do2iMode].legend);
  }

  function updateBSA() {
    // Auto-overwrite policy: always recompute unless user just edited BSA field itself
    if (lastChangedId === 'bsa') return; 
    const h = num('h_cm'), w = num('w_kg');
    const methodSelect = el('bsa-method');
    const method = methodSelect ? methodSelect.value : 'Mosteller';
    const v = computeBSA(h, w, method);
    const out = v ? v.toFixed(2) : '';
    const bsaInput = el('bsa');
    if (bsaInput) bsaInput.value = out;
    setText('bsa-hint', `Auto if height & weight are provided (${out ? 'auto' : '‚Äî'})`);
  }
  function updateDO2i() {
    updateBSA(); // may be no-op if last change was BSA manual edit
    const bsa = num('bsa');
    const flow = num('flow');
    const hb = num('hb');
    const sao2 = num('sao2');
    const pao2Input = el('pao2');
    const pao2 = pao2Input ? (parseFloat(pao2Input.value) || 0) : 0; // allow blank
    const cao2 = calcCaO2(hb, sao2, pao2);
    const cao2El = el('cao2');
    if (cao2El) cao2El.value = cao2 ? cao2.toFixed(2) : '';

    const do2i = calcDO2i(flow, bsa, cao2);
    setText('do2i', do2i ? `${Math.round(do2i)} mL/min/m¬≤` : '‚Äî mL/min/m¬≤');

    // Gauge & message by mode thresholds
    const t = THRESHOLDS[do2iMode];
    let gaugePct = 0, msg = '', gaugeColor = 'bg-accent-400';
    if (do2i) {
      gaugePct = Math.min(Math.max((do2i / t.max) * 100, 0), 100);
      if (do2i < t.low) { msg = 'Low delivery'; gaugeColor = 'bg-red-500'; }
      else if (do2i < t.borderline) { msg = 'Borderline'; gaugeColor = 'bg-amber-500'; }
      else if (do2i <= t.upper) { msg = 'Within targets'; gaugeColor = 'bg-emerald-500'; }
      else { msg = 'Very high ‚Äî verify settings and lab values.'; gaugeColor = 'bg-sky-500'; }
    }
    const g = el('do2i-gauge');
    if (g) {
      g.style.width = `${gaugePct}%`;
      g.className = `h-2 rounded-full ${gaugeColor}`;
    }
    setText('do2i-msg', msg);
  }
  function resetDO2i() {
    ['h_cm','w_kg','bsa','flow','hb','sao2','pao2'].forEach(id => { const n = el(id); if (n) n.value = ''; });
    const cao2El = el('cao2');
    if (cao2El) cao2El.value = '';
    setText('do2i','‚Äî mL/min/m¬≤');
    const g = el('do2i-gauge');
    if (g) {
      g.style.width = '0%';
      g.className = 'h-2 rounded-full bg-accent-400';
    }
    setText('do2i-msg','');
    setText('bsa-hint','Auto if height & weight are provided (‚Äî)');
    do2iMode = 'adult';
    applyModeUI();
  }

  // -----------------------------
  // Predicted Hct Interaction
  // -----------------------------
  function updateHct() {
    const pttypeSelect = el('pttype');
    const pttype = pttypeSelect ? pttypeSelect.value : 'adult_m';
    const payload = {
      pttype,
      weight: num('wt_hct'),
      pre: num('pre_hct'),
      prime: num('prime'),
      fluids: num('fluids'),
      removed: num('removed'),
      rbcUnits: num('rbc_units'),
      rbcUnitVol: num('rbc_unit_vol'),
      rbcHct: num('rbc_hct'),
    };
    const r = computePredictedHct(payload);
    setText('ebv', r.ebv ? r.ebv.toFixed(0) : '‚Äî');
    setText('total_vol', r.totalVol ? r.totalVol.toFixed(0) : '‚Äî');
    setText('pred_hct', r.hct ? r.hct.toFixed(1) + ' %' : '‚Äî');
  }

  // -----------------------------
  // Theme handling
  // -----------------------------
  const THEME_KEY = 'pt-theme';
  function applyTheme(theme, persist) {
    const root = document.documentElement;
    if (theme === 'dark') {
      root.classList.add('dark');
      const themeColor = document.querySelector('meta[name="theme-color"]');
      if (themeColor) themeColor.setAttribute('content', '#020617');
    } else {
      root
